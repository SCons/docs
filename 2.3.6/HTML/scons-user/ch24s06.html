<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>24.6. Minimizing Cache Contention: the --random Option</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 2.3.6"><link rel="up" href="ch24.html" title="Chapter 24. Caching Built Files"><link rel="prev" href="ch24s05.html" title="24.5. Populating a Shared Cache With Already-Built Files"><link rel="next" href="ch25.html" title="Chapter 25. Alias Targets"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.6. Minimizing Cache Contention:  the <code class="literal">--random</code> Option</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch24s05.html">Prev</a> </td><th width="60%" align="center">Chapter 24. Caching Built Files</th><td width="20%" align="right"> <a accesskey="n" href="ch25.html">Next</a></td></tr></table><hr></div><div class="section" title="24.6. Minimizing Cache Contention: the --random Option"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140113675028688"></a>24.6. Minimizing Cache Contention:  the <code class="literal">--random</code> Option</h2></div></div></div><p>

    If you allow multiple builds to update the
    shared cache directory simultaneously,
    two builds that occur at the same time
    can sometimes start "racing"
    with one another to build the same files
    in the same order.
    If, for example,
    you are linking multiple files into an executable program:

    </p><pre class="programlisting">
Program('prog',
        ['f1.c', 'f2.c', 'f3.c', 'f4.c', 'f5.c'])
       </pre><p>

    <span class="application">SCons</span> will normally build the input object files
    on which the program depends in their normal, sorted order:

    </p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
cc -o f2.o -c f2.c
cc -o f4.o -c f4.c
cc -o f3.o -c f3.c
cc -o f5.o -c f5.c
cc -o f1.o -c f1.c
cc -o prog f1.o f2.o f3.o f4.o f5.o
</pre><p>

    But if two such builds take place simultaneously,
    they may each look in the cache at nearly the same
    time and both decide that <code class="filename">f1.o</code>
    must be rebuilt and pushed into the shared cache directory,
    then both decide that <code class="filename">f2.o</code>
    must be rebuilt (and pushed into the shared cache directory),
    then both decide that <code class="filename">f3.o</code>
    must be rebuilt...
    This won't cause any actual build problems--both
    builds will succeed,
    generate correct output files,
    and populate the cache--but
    it does represent wasted effort.

    </p><p>

    To alleviate such contention for the cache,
    you can use the <code class="literal">--random</code> command-line option
    to tell <span class="application">SCons</span> to build dependencies
    in a random order:

    </p><pre class="screen">
  % <strong class="userinput"><code>scons -Q --random</code></strong>
  cc -o f3.o -c f3.c
  cc -o f1.o -c f1.c
  cc -o f5.o -c f5.c
  cc -o f2.o -c f2.c
  cc -o f4.o -c f4.c
  cc -o prog f1.o f2.o f3.o f4.o f5.o
    </pre><p>

    Multiple builds using the <code class="literal">--random</code> option
    will usually build their dependencies in different,
    random orders,
    which minimizes the chances for a lot of
    contention for same-named files
    in the shared cache directory.
    Multiple simultaneous builds might still race to try to build
    the same target file on occasion,
    but long sequences of inefficient contention
    should be rare.

    </p><p>

    Note, of course,
    the <code class="literal">--random</code> option
    will cause the output that <span class="application">SCons</span> prints
    to be inconsistent from invocation to invocation,
    which may be an issue when
    trying to compare output from different build runs.

    </p><p>

    If you want to make sure dependencies will be built
    in a random order without having to specify
    the <code class="literal">--random</code> on very command line,
    you can use the <code class="function">SetOption</code> function to
    set the <code class="literal">random</code> option
    within any <code class="filename">SConscript</code> file:

    </p><pre class="programlisting">
SetOption('random', 1)
Program('prog',
        ['f1.c', 'f2.c', 'f3.c', 'f4.c', 'f5.c'])
       </pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch24s05.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch24.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch25.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">24.5. Populating a Shared Cache With Already-Built Files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 25. Alias Targets</td></tr></table></div></body></html>
