

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCons.Node.FS &#8212; SCons 4.8.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/SCons/Node/FS';</script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search/"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../../">
  
  
  
  
  
  
    <p class="title logo__title">SCons 4.8.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../SCons/">SCons package</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Node/">SCons.Node package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Platform/">SCons.Platform package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Scanner/">SCons.Scanner package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Script/">SCons.Script package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Taskmaster/">SCons.Taskmaster package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Tool/">SCons.Tool package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Util/">SCons.Util package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.Variables/">SCons.Variables package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../SCons.compat/">SCons.compat package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.compat/">SCons.compat package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Node/">SCons.Node package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Platform/">SCons.Platform package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Scanner/">SCons.Scanner package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Script/">SCons.Script package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Taskmaster/">SCons.Taskmaster package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Tool/">SCons.Tool package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Util/">SCons.Util package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../SCons.Variables/">SCons.Variables package</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for SCons.Node.FS</h1><div class="highlight"><pre>
<span></span><span class="c1"># MIT License</span>
<span class="c1">#</span>
<span class="c1"># Copyright The SCons Foundation</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining</span>
<span class="c1"># a copy of this software and associated documentation files (the</span>
<span class="c1"># &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="c1"># without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="c1"># distribute, sublicense, and/or sell copies of the Software, and to</span>
<span class="c1"># permit persons to whom the Software is furnished to do so, subject to</span>
<span class="c1"># the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included</span>
<span class="c1"># in all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY</span>
<span class="c1"># KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE</span>
<span class="c1"># WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="c1"># NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE</span>
<span class="c1"># LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="c1"># OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="c1"># WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="sd">&quot;&quot;&quot;File system nodes.</span>

<span class="sd">These Nodes represent the canonical external objects that people think</span>
<span class="sd">of when they think of building software: files and directories.</span>

<span class="sd">This holds a &quot;default_fs&quot; variable that should be initialized with an FS</span>
<span class="sd">that can be used by scripts or modules looking for the canonical default.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">SCons.Action</span>
<span class="kn">import</span> <span class="nn">SCons.Debug</span>
<span class="kn">import</span> <span class="nn">SCons.Errors</span>
<span class="kn">import</span> <span class="nn">SCons.Memoize</span>
<span class="kn">import</span> <span class="nn">SCons.Node</span>
<span class="kn">import</span> <span class="nn">SCons.Node.Alias</span>
<span class="kn">import</span> <span class="nn">SCons.Subst</span>
<span class="kn">import</span> <span class="nn">SCons.Util</span>
<span class="kn">import</span> <span class="nn">SCons.Warnings</span>
<span class="kn">from</span> <span class="nn">SCons.Debug</span> <span class="kn">import</span> <span class="n">logInstanceCreation</span><span class="p">,</span> <span class="n">Trace</span>
<span class="kn">from</span> <span class="nn">SCons.Util</span> <span class="kn">import</span> <span class="n">hash_signature</span><span class="p">,</span> <span class="n">hash_file_signature</span><span class="p">,</span> <span class="n">hash_collect</span>

<span class="n">print_duplicate</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">MD5_TIMESTAMP_DEBUG</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="sconsign_none"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.sconsign_none">[docs]</a><span class="k">def</span> <span class="nf">sconsign_none</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="sconsign_dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.sconsign_dir">[docs]</a><span class="k">def</span> <span class="nf">sconsign_dir</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the .sconsign file info for this directory,</span>
<span class="sd">    creating it first if necessary.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">_sconsign</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">SCons.SConsign</span>
        <span class="n">node</span><span class="o">.</span><span class="n">_sconsign</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">SConsign</span><span class="o">.</span><span class="n">ForDirectory</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">_sconsign</span></div>

<span class="n">_sconsign_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="n">sconsign_none</span><span class="p">,</span>
                 <span class="mi">1</span> <span class="p">:</span> <span class="n">sconsign_dir</span><span class="p">}</span>

<div class="viewcode-block" id="FileBuildInfoFileToCsigMappingError"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfoFileToCsigMappingError">[docs]</a><span class="k">class</span> <span class="nc">FileBuildInfoFileToCsigMappingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="EntryProxyAttributeError"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.EntryProxyAttributeError">[docs]</a><span class="k">class</span> <span class="nc">EntryProxyAttributeError</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An AttributeError subclass for recording and displaying the name</span>
<span class="sd">    of the underlying Entry involved in an AttributeError exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_proxy</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_proxy</span> <span class="o">=</span> <span class="n">entry_proxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">attribute</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_proxy</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> instance </span><span class="si">%s</span><span class="s2"> has no attribute </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                      <span class="nb">repr</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                      <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute</span><span class="p">))</span></div>

<span class="c1"># The max_drift value:  by default, use a cached signature value for</span>
<span class="c1"># any file that&#39;s been untouched for more than two days.</span>
<span class="n">default_max_drift</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>

<span class="c1">#</span>
<span class="c1"># We stringify these file system Nodes a lot.  Turning a file system Node</span>
<span class="c1"># into a string is non-trivial, because the final string representation</span>
<span class="c1"># can depend on a lot of factors:  whether it&#39;s a derived target or not,</span>
<span class="c1"># whether it&#39;s linked to a repository or source directory, and whether</span>
<span class="c1"># there&#39;s duplication going on.  The normal technique for optimizing</span>
<span class="c1"># calculations like this is to memoize (cache) the string value, so you</span>
<span class="c1"># only have to do the calculation once.</span>
<span class="c1">#</span>
<span class="c1"># A number of the above factors, however, can be set after we&#39;ve already</span>
<span class="c1"># been asked to return a string for a Node, because a Repository() or</span>
<span class="c1"># VariantDir() call or the like may not occur until later in SConscript</span>
<span class="c1"># files.  So this variable controls whether we bother trying to save</span>
<span class="c1"># string values for Nodes.  The wrapper interface can set this whenever</span>
<span class="c1"># they&#39;re done mucking with Repository and VariantDir and the other stuff,</span>
<span class="c1"># to let this module know it can start returning saved string values</span>
<span class="c1"># for Nodes.</span>
<span class="c1">#</span>
<span class="n">Save_Strings</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="save_strings"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.save_strings">[docs]</a><span class="k">def</span> <span class="nf">save_strings</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">Save_Strings</span>
    <span class="n">Save_Strings</span> <span class="o">=</span> <span class="n">val</span></div>


<span class="n">do_splitdrive</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_my_splitdrive</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="initialize_do_splitdrive"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.initialize_do_splitdrive">[docs]</a><span class="k">def</span> <span class="nf">initialize_do_splitdrive</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up splitdrive usage.</span>

<span class="sd">    Avoid unnecessary function calls by recording a flag that tells us whether</span>
<span class="sd">    or not :func:`os.path.splitdrive` actually does anything on this system,</span>
<span class="sd">    and therefore whether we need to bother calling it when looking up path</span>
<span class="sd">    names in various methods below.</span>

<span class="sd">    If :data:`do_splitdrive` is True, :func:`_my_splitdrive` will be a real</span>
<span class="sd">    function which we can call. As all supported Python versions&#39; ntpath module</span>
<span class="sd">    now handle UNC paths correctly, we no longer special-case that.</span>

<span class="sd">    Deferring the setup of ``_my_splitdrive`` also lets unit tests do</span>
<span class="sd">    their thing and test UNC path handling on a POSIX host.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">do_splitdrive</span><span class="p">,</span> <span class="n">_my_splitdrive</span>

    <span class="n">do_splitdrive</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitdrive</span><span class="p">(</span><span class="s1">&#39;X:/foo&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_my_splitdrive</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;//&#39;</span><span class="p">:</span>
                <span class="c1"># Note that we leave a leading slash in the path</span>
                <span class="c1"># because UNC paths are always absolute.</span>
                <span class="k">return</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">p</span>
    <span class="c1"># TODO: the os routine should work and be better debugged than ours,</span>
    <span class="c1">#   but unit test test_unc_path fails on POSIX platforms. Resolve someday.</span>
    <span class="c1"># _my_splitdrive = os.path.splitdrive</span>

    <span class="c1"># Keep some commonly used values in global variables to skip to</span>
    <span class="c1"># module look-up costs.</span>
    <span class="k">global</span> <span class="n">OS_SEP</span>
    <span class="k">global</span> <span class="n">UNC_PREFIX</span>
    <span class="k">global</span> <span class="n">os_sep_is_slash</span>

    <span class="n">OS_SEP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">UNC_PREFIX</span> <span class="o">=</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">OS_SEP</span>
    <span class="n">os_sep_is_slash</span> <span class="o">=</span> <span class="n">OS_SEP</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span></div>

<span class="n">initialize_do_splitdrive</span><span class="p">()</span>

<span class="c1"># Used to avoid invoking os.path.normpath if not necessary.</span>
<span class="n">needs_normpath_check</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      # We need to renormalize the path if it contains any consecutive</span>
<span class="sd">      # &#39;/&#39; characters.</span>
<span class="sd">      .*// |</span>

<span class="sd">      # We need to renormalize the path if it contains a &#39;..&#39; directory.</span>
<span class="sd">      # Note that we check for all the following cases:</span>
<span class="sd">      #</span>
<span class="sd">      #    a) The path is a single &#39;..&#39;</span>
<span class="sd">      #    b) The path starts with &#39;..&#39;. E.g. &#39;../&#39; or &#39;../moredirs&#39;</span>
<span class="sd">      #       but we not match &#39;..abc/&#39;.</span>
<span class="sd">      #    c) The path ends with &#39;..&#39;. E.g. &#39;/..&#39; or &#39;dirs/..&#39;</span>
<span class="sd">      #    d) The path contains a &#39;..&#39; in the middle.</span>
<span class="sd">      #       E.g. dirs/../moredirs</span>

<span class="sd">      (.*/)?\.\.(?:/|$) |</span>

<span class="sd">      # We need to renormalize the path if it contains a &#39;.&#39;</span>
<span class="sd">      # directory, but NOT if it is a single &#39;.&#39;  &#39;/&#39; characters. We</span>
<span class="sd">      # do not want to match a single &#39;.&#39; because this case is checked</span>
<span class="sd">      # for explicitly since this is common enough case.</span>
<span class="sd">      #</span>
<span class="sd">      # Note that we check for all the following cases:</span>
<span class="sd">      #</span>
<span class="sd">      #    a) We don&#39;t match a single &#39;.&#39;</span>
<span class="sd">      #    b) We match if the path starts with &#39;.&#39;. E.g. &#39;./&#39; or</span>
<span class="sd">      #       &#39;./moredirs&#39; but we not match &#39;.abc/&#39;.</span>
<span class="sd">      #    c) We match if the path ends with &#39;.&#39;. E.g. &#39;/.&#39; or</span>
<span class="sd">      #    &#39;dirs/.&#39;</span>
<span class="sd">      #    d) We match if the path contains a &#39;.&#39; in the middle.</span>
<span class="sd">      #       E.g. dirs/./moredirs</span>

<span class="sd">      \./|.*/\.(?:/|$)</span>

<span class="sd">    &#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span>
    <span class="p">)</span>
<span class="n">needs_normpath_match</span> <span class="o">=</span> <span class="n">needs_normpath_check</span><span class="o">.</span><span class="n">match</span>

<span class="c1">#</span>
<span class="c1"># SCons.Action objects for interacting with the outside world.</span>
<span class="c1">#</span>
<span class="c1"># The Node.FS methods in this module should use these actions to</span>
<span class="c1"># create and/or remove files and directories; they should *not* use</span>
<span class="c1"># os.{link,symlink,unlink,mkdir}(), etc., directly.</span>
<span class="c1">#</span>
<span class="c1"># Using these SCons.Action objects ensures that descriptions of these</span>
<span class="c1"># external activities are properly displayed, that the displays are</span>
<span class="c1"># suppressed when the -s (silent) option is used, and (most importantly)</span>
<span class="c1"># the actions are disabled when the the -n option is used, in which case</span>
<span class="c1"># there should be *no* changes to the external file system(s)...</span>
<span class="c1">#</span>

<span class="c1"># For Now disable hard &amp; softlinks for win32</span>
<span class="c1"># PY3 supports them, but the rest of SCons is not ready for this</span>
<span class="c1"># in some cases user permissions may be required.</span>
<span class="c1"># TODO: See if theres a reasonable way to enable using links on win32/64</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
<div class="viewcode-block" id="_hardlink_func"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS._hardlink_func">[docs]</a>    <span class="k">def</span> <span class="nf">_hardlink_func</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If the source is a symlink, we can&#39;t just hard-link to it</span>
        <span class="c1"># because a relative symlink may point somewhere completely</span>
        <span class="c1"># different.  We must disambiguate the symlink and then</span>
        <span class="c1"># hard-link the final destination file.</span>
        <span class="k">while</span> <span class="n">fs</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">link</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_hardlink_func</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;symlink&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
<div class="viewcode-block" id="_softlink_func"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS._softlink_func">[docs]</a>    <span class="k">def</span> <span class="nf">_softlink_func</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_softlink_func</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="_copy_func"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS._copy_func">[docs]</a><span class="k">def</span> <span class="nf">_copy_func</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IMODE</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWRITE</span><span class="p">)</span></div>


<span class="n">Valid_Duplicates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hard-soft-copy&#39;</span><span class="p">,</span> <span class="s1">&#39;soft-hard-copy&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hard-copy&#39;</span><span class="p">,</span> <span class="s1">&#39;soft-copy&#39;</span><span class="p">,</span> <span class="s1">&#39;copy&#39;</span><span class="p">]</span>

<span class="n">Link_Funcs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># contains the callables of the specified duplication style</span>

<div class="viewcode-block" id="set_duplicate"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.set_duplicate">[docs]</a><span class="k">def</span> <span class="nf">set_duplicate</span><span class="p">(</span><span class="n">duplicate</span><span class="p">):</span>
    <span class="c1"># Fill in the Link_Funcs list according to the argument</span>
    <span class="c1"># (discarding those not available on the platform).</span>

    <span class="c1"># Set up the dictionary that maps the argument names to the</span>
    <span class="c1"># underlying implementations.  We do this inside this function,</span>
    <span class="c1"># not in the top-level module code, so that we can remap os.link</span>
    <span class="c1"># and os.symlink for testing purposes.</span>
    <span class="n">link_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;hard&#39;</span> <span class="p">:</span> <span class="n">_hardlink_func</span><span class="p">,</span>
        <span class="s1">&#39;soft&#39;</span> <span class="p">:</span> <span class="n">_softlink_func</span><span class="p">,</span>
        <span class="s1">&#39;copy&#39;</span> <span class="p">:</span> <span class="n">_copy_func</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">duplicate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Valid_Duplicates</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;The argument of set_duplicate &quot;</span>
                                           <span class="s2">&quot;should be in Valid_Duplicates&quot;</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">Link_Funcs</span>
    <span class="n">Link_Funcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">duplicate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">link_dict</span><span class="p">[</span><span class="n">func</span><span class="p">]:</span>
            <span class="n">Link_Funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_dict</span><span class="p">[</span><span class="n">func</span><span class="p">])</span></div>

<div class="viewcode-block" id="LinkFunc"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LinkFunc">[docs]</a><span class="k">def</span> <span class="nf">LinkFunc</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Relative paths cause problems with symbolic links, so</span>
<span class="sd">    we use absolute paths, which may be a problem for people</span>
<span class="sd">    who want to move their soft-linked src-trees around. Those</span>
<span class="sd">    people should use the &#39;hard-copy&#39; mode, softlinks cannot be</span>
<span class="sd">    used for that; at least I have no idea how ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Link_Funcs</span><span class="p">:</span>
        <span class="c1"># Set a default order of link functions.</span>
        <span class="n">set_duplicate</span><span class="p">(</span><span class="s1">&#39;hard-soft-copy&#39;</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span>
    <span class="c1"># Now link the files with the previously specified order.</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">Link_Funcs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c1"># An OSError indicates something happened like a permissions</span>
            <span class="c1"># problem or an attempt to symlink across file-system</span>
            <span class="c1"># boundaries.  An IOError indicates something like the file</span>
            <span class="c1"># not existing.  In either case, keeping trying additional</span>
            <span class="c1"># functions in the list and only raise an error if the last</span>
            <span class="c1"># one failed.</span>
            <span class="k">if</span> <span class="n">func</span> <span class="o">==</span> <span class="n">Link_Funcs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># exception of the last link method (copy) are fatal</span>
                <span class="k">raise</span>
    <span class="k">return</span> <span class="mi">0</span></div>

<span class="n">Link</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">LinkFunc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<div class="viewcode-block" id="LocalString"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalString">[docs]</a><span class="k">def</span> <span class="nf">LocalString</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Local copy of </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<span class="n">LocalCopy</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">LinkFunc</span><span class="p">,</span> <span class="n">LocalString</span><span class="p">)</span>

<div class="viewcode-block" id="UnlinkFunc"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.UnlinkFunc">[docs]</a><span class="k">def</span> <span class="nf">UnlinkFunc</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="mi">0</span></div>

<span class="n">Unlink</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">UnlinkFunc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="MkdirFunc"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.MkdirFunc">[docs]</a><span class="k">def</span> <span class="nf">MkdirFunc</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># - It&#39;s possible when using Install() to install multiple</span>
    <span class="c1">#   dirs outside the source tree to get a case where t.exists()</span>
    <span class="c1">#   is false but the path does already exist.</span>
    <span class="c1"># - It&#39;s also possible for multiple SCons processes to try to create</span>
    <span class="c1">#   multiple build directories when processing SConscript files with</span>
    <span class="c1">#   variant dirs.</span>
    <span class="c1"># Catching OS exceptions and ensuring directory existence prevents</span>
    <span class="c1"># build failures in these cases. See test/Install/multi-dir.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">abs_path</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="mi">0</span></div>

<span class="n">Mkdir</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">MkdirFunc</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">presub</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">MkdirBuilder</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="get_MkdirBuilder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.get_MkdirBuilder">[docs]</a><span class="k">def</span> <span class="nf">get_MkdirBuilder</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">MkdirBuilder</span>
    <span class="k">if</span> <span class="n">MkdirBuilder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">SCons.Builder</span>
        <span class="kn">import</span> <span class="nn">SCons.Defaults</span>
        <span class="c1"># &quot;env&quot; will get filled in by Executor.get_build_env()</span>
        <span class="c1"># calling SCons.Defaults.DefaultEnvironment() when necessary.</span>
        <span class="n">MkdirBuilder</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="n">action</span> <span class="o">=</span> <span class="n">Mkdir</span><span class="p">,</span>
                                             <span class="n">env</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">explain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">is_explicit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">target_scanner</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DirEntryScanner</span><span class="p">,</span>
                                             <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MkdirBuilder&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MkdirBuilder</span></div>

<div class="viewcode-block" id="_Null"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS._Null">[docs]</a><span class="k">class</span> <span class="nc">_Null</span><span class="p">:</span>
    <span class="k">pass</span></div>

<span class="n">_null</span> <span class="o">=</span> <span class="n">_Null</span><span class="p">()</span>

<span class="c1"># Cygwin&#39;s os.path.normcase pretends it&#39;s on a case-sensitive filesystem.</span>
<span class="n">_is_cygwin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;cygwin&quot;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="s2">&quot;TeSt&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="s2">&quot;TeSt&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_cygwin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_my_normcase</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="_my_normcase"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS._my_normcase">[docs]</a>    <span class="k">def</span> <span class="nf">_my_normcase</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>


<div class="viewcode-block" id="DiskChecker"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.DiskChecker">[docs]</a><span class="k">class</span> <span class="nc">DiskChecker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement disk check variation.</span>

<span class="sd">    This Class will hold functions to determine what this particular disk</span>
<span class="sd">    checking implementation should do when enabled or disabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disk_check_type</span><span class="p">,</span> <span class="n">do_check_function</span><span class="p">,</span> <span class="n">ignore_check_function</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk_check_type</span> <span class="o">=</span> <span class="n">disk_check_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_check_function</span> <span class="o">=</span> <span class="n">do_check_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_check_function</span> <span class="o">=</span> <span class="n">ignore_check_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">do_check_function</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="DiskChecker.enable"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.DiskChecker.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disk_check_type_list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the current object&#39;s disk_check_type matches any in the list passed</span>
<span class="sd">        :param disk_check_type_list: List of disk checks to enable</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disk_check_type</span> <span class="ow">in</span> <span class="n">disk_check_type_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_check_function</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_check_function</span></div></div>


<div class="viewcode-block" id="do_diskcheck_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.do_diskcheck_match">[docs]</a><span class="k">def</span> <span class="nf">do_diskcheck_match</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">errorfmt</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">predicate</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># If calling the predicate() cached a None value from stat(),</span>
        <span class="c1"># remove it so it doesn&#39;t interfere with later attempts to</span>
        <span class="c1"># build this Node as we walk the DAG.  (This isn&#39;t a great way</span>
        <span class="c1"># to do this, we&#39;re reaching into an interface that doesn&#39;t</span>
        <span class="c1"># really belong to us, but it&#39;s all about performance, so</span>
        <span class="c1"># for now we&#39;ll just document the dependency...)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errorfmt</span> <span class="o">%</span> <span class="n">node</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span></div>


<div class="viewcode-block" id="ignore_diskcheck_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.ignore_diskcheck_match">[docs]</a><span class="k">def</span> <span class="nf">ignore_diskcheck_match</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">errorfmt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span></div>


<span class="n">diskcheck_match</span> <span class="o">=</span> <span class="n">DiskChecker</span><span class="p">(</span><span class="s1">&#39;match&#39;</span><span class="p">,</span> <span class="n">do_diskcheck_match</span><span class="p">,</span> <span class="n">ignore_diskcheck_match</span><span class="p">)</span>

<span class="n">diskcheckers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">diskcheck_match</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="set_diskcheck"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.set_diskcheck">[docs]</a><span class="k">def</span> <span class="nf">set_diskcheck</span><span class="p">(</span><span class="n">enabled_checkers</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">dc</span> <span class="ow">in</span> <span class="n">diskcheckers</span><span class="p">:</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">enabled_checkers</span><span class="p">)</span></div>


<div class="viewcode-block" id="diskcheck_types"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.diskcheck_types">[docs]</a><span class="k">def</span> <span class="nf">diskcheck_types</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dc</span><span class="o">.</span><span class="n">disk_check_type</span> <span class="k">for</span> <span class="n">dc</span> <span class="ow">in</span> <span class="n">diskcheckers</span><span class="p">]</span></div>


<div class="viewcode-block" id="EntryProxy"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.EntryProxy">[docs]</a><span class="k">class</span> <span class="nc">EntryProxy</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">Proxy</span><span class="p">):</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">Delegate</span><span class="p">(</span><span class="s1">&#39;__str__&#39;</span><span class="p">)</span>

    <span class="c1"># In PY3 if a class defines __eq__, then it must explicitly provide</span>
    <span class="c1"># __hash__.  Since SCons.Util.Proxy provides __eq__ we need the following</span>
    <span class="c1"># see: https://docs.python.org/3/reference/datamodel.html#object.__hash__</span>
    <span class="fm">__hash__</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">Delegate</span><span class="p">(</span><span class="s1">&#39;__hash__&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_abspath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">(),</span>
                                             <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_abspath&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_relpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get_relpath</span><span class="p">(),</span>
                                             <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_relpath&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_filebase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_filebase&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_suffix&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_file&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_base_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the file&#39;s directory and file name, with the</span>
<span class="sd">        suffix stripped.&quot;&quot;&quot;</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get_path</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_base&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_posix_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the path with / as the path separator,</span>
<span class="sd">        regardless of platform.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os_sep_is_slash</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">OS_SEP</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_posix&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_windows_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the path with \ as the path separator,</span>
<span class="sd">        regardless of platform.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">OS_SEP</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">OS_SEP</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SpecialAttrWrapper</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_windows&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_srcnode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">srcnode</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__get_srcdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the directory containing the source node linked to this</span>
<span class="sd">        node via VariantDir(), or the directory of this node if not linked.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_rsrcnode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span><span class="o">.</span><span class="n">rfile</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__get_rsrcdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the directory containing the source node linked to this</span>
<span class="sd">        node via VariantDir(), or the directory of this node if not linked.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>

    <span class="n">dictSpecialAttrs</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;base&quot;</span>     <span class="p">:</span> <span class="n">__get_base_path</span><span class="p">,</span>
                         <span class="s2">&quot;posix&quot;</span>    <span class="p">:</span> <span class="n">__get_posix_path</span><span class="p">,</span>
                         <span class="s2">&quot;windows&quot;</span>  <span class="p">:</span> <span class="n">__get_windows_path</span><span class="p">,</span>
                         <span class="s2">&quot;win32&quot;</span>    <span class="p">:</span> <span class="n">__get_windows_path</span><span class="p">,</span>
                         <span class="s2">&quot;srcpath&quot;</span>  <span class="p">:</span> <span class="n">__get_srcnode</span><span class="p">,</span>
                         <span class="s2">&quot;srcdir&quot;</span>   <span class="p">:</span> <span class="n">__get_srcdir</span><span class="p">,</span>
                         <span class="s2">&quot;dir&quot;</span>      <span class="p">:</span> <span class="n">__get_dir</span><span class="p">,</span>
                         <span class="s2">&quot;abspath&quot;</span>  <span class="p">:</span> <span class="n">__get_abspath</span><span class="p">,</span>
                         <span class="s2">&quot;relpath&quot;</span>  <span class="p">:</span> <span class="n">__get_relpath</span><span class="p">,</span>
                         <span class="s2">&quot;filebase&quot;</span> <span class="p">:</span> <span class="n">__get_filebase</span><span class="p">,</span>
                         <span class="s2">&quot;suffix&quot;</span>   <span class="p">:</span> <span class="n">__get_suffix</span><span class="p">,</span>
                         <span class="s2">&quot;file&quot;</span>     <span class="p">:</span> <span class="n">__get_file</span><span class="p">,</span>
                         <span class="s2">&quot;rsrcpath&quot;</span> <span class="p">:</span> <span class="n">__get_rsrcnode</span><span class="p">,</span>
                         <span class="s2">&quot;rsrcdir&quot;</span>  <span class="p">:</span> <span class="n">__get_rsrcdir</span><span class="p">,</span>
                       <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># This is how we implement the &quot;special&quot; attributes</span>
        <span class="c1"># such as base, posix, srcdir, etc.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">attr_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictSpecialAttrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Raise our own AttributeError subclass with an</span>
                <span class="c1"># overridden __str__() method that identifies the</span>
                <span class="c1"># name of the entry that caused the exception.</span>
                <span class="k">raise</span> <span class="n">EntryProxyAttributeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">attr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Base"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base">[docs]</a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A generic class for file system entries.  This class is for</span>
<span class="sd">    when we don&#39;t know yet whether the entry being looked up is a file</span>
<span class="sd">    or a directory.  Instances of this class can morph into either</span>
<span class="sd">    Dir or File objects by a later, more precise lookup.</span>

<span class="sd">    Note: this class does not define __cmp__ and __hash__ for</span>
<span class="sd">    efficiency reasons.  SCons does a lot of comparing of</span>
<span class="sd">    Node.FS.{Base,Entry,File,Dir} objects, so those operations must be</span>
<span class="sd">    as fast as possible, which means we want to use Python&#39;s built-in</span>
<span class="sd">    object identity comparisons.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;fs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_abspath&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_labspath&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_path&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_tpath&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_path_elements&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;dir&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cwd&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;duplicate&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_local&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;sbuilder&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_proxy&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_func_sconsign&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a generic Node.FS.Base object.</span>

<span class="sd">        Call the superclass initialization, take care of setting up</span>
<span class="sd">        our relative and absolute paths, identify our parent</span>
<span class="sd">        directory, and indicate that this node should use</span>
<span class="sd">        signatures.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Node.FS.Base&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Filenames and paths are probably reused and are intern&#39;ed to save some memory.</span>
        <span class="c1"># Filename with extension as it was specified when the object was</span>
        <span class="c1"># created; to obtain filesystem path, use Python str() function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span> <span class="c1">#: Reference to parent Node.FS object</span>

        <span class="k">assert</span> <span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;A directory must be provided&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will hold the SConscript directory for target nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">duplicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_sconsign</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_rexists</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_target_from_source</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store_info</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Base.str_for_display"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.str_for_display">[docs]</a>    <span class="k">def</span> <span class="nf">str_for_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span></div>

<div class="viewcode-block" id="Base.must_be_same"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.must_be_same">[docs]</a>    <span class="k">def</span> <span class="nf">must_be_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This node, which already existed, is being looked up as the</span>
<span class="sd">        specified klass.  Raise an exception if it isn&#39;t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span> <span class="ow">or</span> <span class="n">klass</span> <span class="ow">is</span> <span class="n">Entry</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Tried to lookup </span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39; as a </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span>\
              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">(),</span> <span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.get_dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span></div>

<div class="viewcode-block" id="Base.get_suffix"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_suffix">[docs]</a>    <span class="k">def</span> <span class="nf">get_suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Base.rfile"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.rfile">[docs]</a>    <span class="k">def</span> <span class="nf">rfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Base.__getattr__"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.__getattr__">[docs]</a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Together with the node_bwcomp dict defined below,</span>
<span class="sd">            this method provides a simple backward compatibility</span>
<span class="sd">            layer for the Node attributes &#39;abspath&#39;, &#39;labspath&#39;,</span>
<span class="sd">            &#39;path&#39;, &#39;tpath&#39;, &#39;suffix&#39; and &#39;path_elements&#39;. These Node</span>
<span class="sd">            attributes used to be directly available in v2.3 and earlier, but</span>
<span class="sd">            have been replaced by getter methods that initialize the</span>
<span class="sd">            single variables lazily when required, in order to save memory.</span>
<span class="sd">            The redirection to the getters lets older Tools and</span>
<span class="sd">            SConstruct continue to work without any additional changes,</span>
<span class="sd">            fully transparent to the user.</span>
<span class="sd">            Note, that __getattr__ is only called as fallback when the</span>
<span class="sd">            requested attribute can&#39;t be found, so there should be no</span>
<span class="sd">            speed performance penalty involved for standard builds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">node_bwcomp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node_bwcomp</span><span class="p">[</span><span class="n">attr</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> object has no attribute </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.__str__"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A Node.FS.Base object&#39;s string representation is its path</span>
<span class="sd">        name.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">Save_Strings</span>
        <span class="k">if</span> <span class="n">Save_Strings</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_str</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_str</span><span class="p">()</span></div>

<div class="viewcode-block" id="Base.__lt__"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.__lt__">[docs]</a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; less than operator used by sorting on py3&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._save_str"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base._save_str">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">_save_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;_save_str&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_str</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;_save_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base._get_str"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base._get_str">[docs]</a>    <span class="k">def</span> <span class="nf">_get_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">Save_Strings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="n">srcnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">srcnode</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">srcnode</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Save_Strings</span><span class="p">:</span>
            <span class="c1"># We&#39;re not at the point where we&#39;re saving the string</span>
            <span class="c1"># representations of FS Nodes (because we haven&#39;t finished</span>
            <span class="c1"># reading the SConscript files and need to have str() return</span>
            <span class="c1"># things relative to them).  That also means we can&#39;t yet</span>
            <span class="c1"># cache values returned (or not returned) by stat(), since</span>
            <span class="c1"># Python code in the SConscript files might still create</span>
            <span class="c1"># or otherwise affect the on-disk file.  So get rid of the</span>
            <span class="c1"># values that the underlying stat() method saved.</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">srcnode</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="k">del</span> <span class="n">srcnode</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="n">rstr</span> <span class="o">=</span> <span class="fm">__str__</span>

<div class="viewcode-block" id="Base.stat"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.stat">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.lstat"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.lstat">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">lstat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;lstat&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">lstat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;lstat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.exists"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_exists_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.rexists"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.rexists">[docs]</a>    <span class="k">def</span> <span class="nf">rexists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_rexists_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_rexists</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.getmtime"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.getmtime">[docs]</a>    <span class="k">def</span> <span class="nf">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">st</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">st</span><span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_MTIME</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Base.getsize"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.getsize">[docs]</a>    <span class="k">def</span> <span class="nf">getsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">st</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">st_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Base.isdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.isdir">[docs]</a>    <span class="k">def</span> <span class="nf">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">st</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.isfile"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.isfile">[docs]</a>    <span class="k">def</span> <span class="nf">isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">st</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)</span></div>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;symlink&#39;</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">islink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstat</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">st</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_ISLNK</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="Base.islink"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.islink">[docs]</a>        <span class="k">def</span> <span class="nf">islink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>                    <span class="c1"># no symlinks</span></div>

<div class="viewcode-block" id="Base.is_under"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.is_under">[docs]</a>    <span class="k">def</span> <span class="nf">is_under</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">is_under</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.set_local"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.set_local">[docs]</a>    <span class="k">def</span> <span class="nf">set_local</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Base.srcnode"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.srcnode">[docs]</a>    <span class="k">def</span> <span class="nf">srcnode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If this node is in a build path, return the node</span>
<span class="sd">        corresponding to its source file.  Otherwise, return</span>
<span class="sd">        ourself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">srcdir_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">srcdir_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">srcdir_list</span><span class="p">:</span>
            <span class="n">srcnode</span> <span class="o">=</span> <span class="n">srcdir_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">srcnode</span><span class="o">.</span><span class="n">must_be_same</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">srcnode</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Base.get_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return path relative to the current working directory of the</span>
<span class="sd">        Node.FS.Base object that owns us.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;.&#39;</span>
        <span class="n">path_elems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path_elements</span><span class="p">()</span>
        <span class="n">pathname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="n">path_elems</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path_elems</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">pathname</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">dirname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path_elems</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">pathname</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">dirname</span>
        <span class="k">return</span> <span class="n">pathname</span> <span class="o">+</span> <span class="n">path_elems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="Base.set_src_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.set_src_builder">[docs]</a>    <span class="k">def</span> <span class="nf">set_src_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the source code builder for this node.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbuilder</span> <span class="o">=</span> <span class="n">builder</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_builder</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder_set</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.src_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.src_builder">[docs]</a>    <span class="k">def</span> <span class="nf">src_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch the source code builder for this node.</span>

<span class="sd">        If there isn&#39;t one, we cache the source code builder specified</span>
<span class="sd">        for the directory (which in turn will cache the value from its</span>
<span class="sd">        parent directory, and so on up to the file system root).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbuilder</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">scb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">src_builder</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbuilder</span> <span class="o">=</span> <span class="n">scb</span>
        <span class="k">return</span> <span class="n">scb</span></div>

<div class="viewcode-block" id="Base.get_abspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_abspath">[docs]</a>    <span class="k">def</span> <span class="nf">get_abspath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path of the file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.get_labspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_labspath">[docs]</a>    <span class="k">def</span> <span class="nf">get_labspath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path of the file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_labspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.get_relpath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_relpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_relpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the path of the file relative to the root SConstruct file&#39;s directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">SConstruct_dir</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span></div>

<div class="viewcode-block" id="Base.get_internal_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_internal_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_internal_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_path</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.get_tpath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_tpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_tpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.get_path_elements"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_path_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_path_elements</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span></div>

<div class="viewcode-block" id="Base.for_signature"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.for_signature">[docs]</a>    <span class="k">def</span> <span class="nf">for_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Return just our name.  Even an absolute path would not work,</span>
        <span class="c1"># because that can change thanks to symlinks or remapped network</span>
        <span class="c1"># paths.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="Base.get_subst_proxy"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.get_subst_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">get_subst_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proxy</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">EntryProxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proxy</span> <span class="o">=</span> <span class="n">ret</span>
            <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Base.target_from_source"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.target_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">target_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">splitext</span><span class="o">=</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">splitext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Generates a target entry that corresponds to this entry (usually</span>
<span class="sd">        a source file) with the specified prefix and suffix.</span>

<span class="sd">        Note that this method can be overridden dynamically for generated</span>
<span class="sd">        files that need different behavior.  See Tool/swig.py for</span>
<span class="sd">        an example.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_target_from_source_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_target_from_source</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">splitext</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._Rfindalldirs_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base._Rfindalldirs_key">[docs]</a>    <span class="k">def</span> <span class="nf">_Rfindalldirs_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathlist</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pathlist</span></div>

<div class="viewcode-block" id="Base.Rfindalldirs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.Rfindalldirs">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountDictCall</span><span class="p">(</span><span class="n">_Rfindalldirs_key</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">Rfindalldirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathlist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all of the directories for a given path list, including</span>
<span class="sd">        corresponding &quot;backing&quot; directories in any repositories.</span>

<span class="sd">        The Node lookups are relative to this Node (typically a</span>
<span class="sd">        directory), so memoizing result saves cycles from looking</span>
<span class="sd">        up the same path for each target in a given directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;Rfindalldirs&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;Rfindalldirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">memo_dict</span><span class="p">[</span><span class="n">pathlist</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">create_dir_relative_to_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">dir</span> <span class="o">=</span> <span class="n">create_dir_relative_to_self</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">())</span>

        <span class="n">memo_dict</span><span class="p">[</span><span class="n">pathlist</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.RDirs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.RDirs">[docs]</a>    <span class="k">def</span> <span class="nf">RDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathlist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for a list of directories in the Repository list.&quot;&quot;&quot;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">_cwd</span>
        <span class="k">return</span> <span class="n">cwd</span><span class="o">.</span><span class="n">Rfindalldirs</span><span class="p">(</span><span class="n">pathlist</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.rentry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base.rentry">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">rentry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rentry&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rentry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base._glob1"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Base._glob1">[docs]</a>    <span class="k">def</span> <span class="nf">_glob1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div></div>

<span class="c1"># Dict that provides a simple backward compatibility</span>
<span class="c1"># layer for the Node attributes &#39;abspath&#39;, &#39;labspath&#39;,</span>
<span class="c1"># &#39;relpath&#39;, &#39;path&#39;, &#39;tpath&#39; and &#39;path_elements&#39;.</span>
<span class="c1"># @see Base.__getattr__ above</span>
<span class="n">node_bwcomp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;abspath&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">,</span>
               <span class="s1">&#39;labspath&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">,</span>
               <span class="s1">&#39;relpath&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_relpath</span><span class="p">,</span>
               <span class="s1">&#39;path&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">,</span>
               <span class="s1">&#39;tpath&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_tpath</span><span class="p">,</span>
               <span class="s1">&#39;path_elements&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_path_elements</span><span class="p">,</span>
               <span class="s1">&#39;suffix&#39;</span> <span class="p">:</span> <span class="n">Base</span><span class="o">.</span><span class="n">get_suffix</span><span class="p">}</span>

<div class="viewcode-block" id="Entry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry">[docs]</a><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the class for generic Node.FS entries--that is, things</span>
<span class="sd">    that could be a File or a Dir, but we&#39;re just not sure yet.</span>
<span class="sd">    Consequently, the methods in this class really exist just to</span>
<span class="sd">    transform their associated object into the right class when the</span>
<span class="sd">    time comes, and then call the same-named method in the transformed</span>
<span class="sd">    class.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scanner_paths&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachedir_csig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachesig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;repositories&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;srcdir&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;searched&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_sconsign&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;variant_dirs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;dirname&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;on_disk_entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;released_target_info&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;contentsig&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Entry.diskcheck_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.diskcheck_match">[docs]</a>    <span class="k">def</span> <span class="nf">diskcheck_match</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Entry.disambiguate"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.disambiguate">[docs]</a>    <span class="k">def</span> <span class="nf">disambiguate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isfile</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">File</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdir</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">Dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There was nothing on-disk at this location, so look in</span>
            <span class="c1"># the src directory.</span>
            <span class="c1">#</span>
            <span class="c1"># We can&#39;t just use self.srcnode() straight away because</span>
            <span class="c1"># that would create an actual Node for this file in the src</span>
            <span class="c1"># directory, and there might not be one.  Instead, use the</span>
            <span class="c1"># dir_on_disk() method to see if there&#39;s something on-disk</span>
            <span class="c1"># with that name, in which case we can go ahead and call</span>
            <span class="c1"># self.srcnode() to create the right type of entry.</span>
            <span class="n">srcdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">srcdir</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="ow">and</span> \
               <span class="n">srcdir</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span><span class="o">.</span><span class="n">isdir</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">Dir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">must_exist</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No such file or directory: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">File</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Entry.rfile"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.rfile">[docs]</a>    <span class="k">def</span> <span class="nf">rfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;We&#39;re a generic Entry, but the caller is actually looking for</span>
<span class="sd">        a File at this point, so morph into one.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">File</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">File</span><span class="o">.</span><span class="n">rfile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entry.scanner_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.scanner_key">[docs]</a>    <span class="k">def</span> <span class="nf">scanner_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_suffix</span><span class="p">()</span></div>

<div class="viewcode-block" id="Entry.get_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.get_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch the contents of the entry.  Returns the exact binary</span>
<span class="sd">        contents of the file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_get_contents_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entry.get_text_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.get_text_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_text_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch the decoded text contents of a Unicode encoded Entry.</span>

<span class="sd">        Since this should return the text contents from the file</span>
<span class="sd">        system, we check to see into what sort of subclass we should</span>
<span class="sd">        morph this Entry.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">(</span><span class="n">must_exist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">:</span>
            <span class="c1"># There was nothing on disk with which to disambiguate</span>
            <span class="c1"># this entry.  Leave it as an Entry, but return a null</span>
            <span class="c1"># string so calls to get_text_contents() in emitters and</span>
            <span class="c1"># the like (e.g. in qt.py) don&#39;t have to disambiguate by</span>
            <span class="c1"># hand or catch the exception.</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># now we&#39;re a different node type, call its method to get the text.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text_contents</span><span class="p">()</span></div>

<div class="viewcode-block" id="Entry.must_be_same"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.must_be_same">[docs]</a>    <span class="k">def</span> <span class="nf">must_be_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called to make sure a Node is a Dir.  Since we&#39;re an</span>
<span class="sd">        Entry, we can morph into one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">klass</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">klass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    <span class="c1"># The following methods can get called before the Taskmaster has</span>
    <span class="c1"># had a chance to call disambiguate() directly to see if this Entry</span>
    <span class="c1"># should really be a Dir or a File.  We therefore use these to call</span>
    <span class="c1"># disambiguate() transparently (from our caller&#39;s point of view).</span>
    <span class="c1">#</span>
    <span class="c1"># Right now, this minimal set of methods has been derived by just</span>
    <span class="c1"># looking at some of the methods that will obviously be called early</span>
    <span class="c1"># in any of the various Taskmasters&#39; calling sequences, and then</span>
    <span class="c1"># empirically figuring out which additional methods are necessary</span>
    <span class="c1"># to make various tests pass.</span>

<div class="viewcode-block" id="Entry.exists"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_exists_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entry.rel_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.rel_path">[docs]</a>    <span class="k">def</span> <span class="nf">rel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">Entry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;rel_path() could not disambiguate File/Dir&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">rel_path</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entry.new_ninfo"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.new_ninfo">[docs]</a>    <span class="k">def</span> <span class="nf">new_ninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span><span class="o">.</span><span class="n">new_ninfo</span><span class="p">()</span></div>

<div class="viewcode-block" id="Entry._glob1"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry._glob1">[docs]</a>    <span class="k">def</span> <span class="nf">_glob1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span><span class="o">.</span><span class="n">_glob1</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entry.get_subst_proxy"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Entry.get_subst_proxy">[docs]</a>    <span class="k">def</span> <span class="nf">get_subst_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span><span class="o">.</span><span class="n">get_subst_proxy</span><span class="p">()</span></div></div>

<span class="c1"># This is for later so we can differentiate between Entry the class and Entry</span>
<span class="c1"># the method of the FS class.</span>
<span class="n">_classEntry</span> <span class="o">=</span> <span class="n">Entry</span>


<div class="viewcode-block" id="LocalFS"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS">[docs]</a><span class="k">class</span> <span class="nc">LocalFS</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class implements an abstraction layer for operations involving</span>
<span class="sd">    a local file system.  Essentially, this wraps any function in</span>
<span class="sd">    the os, os.path or shutil modules that we use to actually go do</span>
<span class="sd">    anything with or to the local file system.</span>

<span class="sd">    Note that there&#39;s a very good chance we&#39;ll refactor this part of</span>
<span class="sd">    the architecture in some way as we really implement the interface(s)</span>
<span class="sd">    for remote file system Nodes.  For example, the right architecture</span>
<span class="sd">    might be to have this be a subclass instead of a base class.</span>
<span class="sd">    Nevertheless, we&#39;re using this as a first step in that direction.</span>

<span class="sd">    We&#39;re not using chdir() yet because the calling subclass method</span>
<span class="sd">    needs to use os.chdir() directly to avoid recursion.  Will we</span>
<span class="sd">    really need this one?</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LocalFS.chmod"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.chmod">[docs]</a>    <span class="k">def</span> <span class="nf">chmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.copy"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.copy2"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.copy2">[docs]</a>    <span class="k">def</span> <span class="nf">copy2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.exists"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.getmtime"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.getmtime">[docs]</a>    <span class="k">def</span> <span class="nf">getmtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.getsize"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.getsize">[docs]</a>    <span class="k">def</span> <span class="nf">getsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.isdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.isdir">[docs]</a>    <span class="k">def</span> <span class="nf">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.isfile"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.isfile">[docs]</a>    <span class="k">def</span> <span class="nf">isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.link"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.link">[docs]</a>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.lstat"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.lstat">[docs]</a>    <span class="k">def</span> <span class="nf">lstat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">lstat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.listdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.listdir">[docs]</a>    <span class="k">def</span> <span class="nf">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.scandir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.scandir">[docs]</a>    <span class="k">def</span> <span class="nf">scandir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.makedirs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.makedirs">[docs]</a>    <span class="k">def</span> <span class="nf">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mo">0o777</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">exist_ok</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.mkdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.mkdir">[docs]</a>    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mo">0o777</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.rename"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.stat"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.stat">[docs]</a>    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.symlink"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.symlink">[docs]</a>    <span class="k">def</span> <span class="nf">symlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.open"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="LocalFS.unlink"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.unlink">[docs]</a>    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;symlink&#39;</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">islink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

<div class="viewcode-block" id="LocalFS.islink"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.islink">[docs]</a>        <span class="k">def</span> <span class="nf">islink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># no symlinks</span></div>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;readlink&#39;</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">readlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

<div class="viewcode-block" id="LocalFS.readlink"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.LocalFS.readlink">[docs]</a>        <span class="k">def</span> <span class="nf">readlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span></div></div>


<div class="viewcode-block" id="FS"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS">[docs]</a><span class="k">class</span> <span class="nc">FS</span><span class="p">(</span><span class="n">LocalFS</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Node.FS subsystem.</span>

<span class="sd">        The supplied path is the top of the source tree, where we</span>
<span class="sd">        expect to find the top-level build file.  If no path is</span>
<span class="sd">        supplied, the current directory is the default.</span>

<span class="sd">        The path argument must be a valid absolute path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Node.FS&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Root</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SConstruct_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_drift</span> <span class="o">=</span> <span class="n">default_max_drift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Top</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathTop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathTop</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultDrive</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">_my_splitdrive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathTop</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultDrive</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathTop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span>

        <span class="n">DirNodeInfo</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">FileNodeInfo</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="FS.set_SConstruct_dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.set_SConstruct_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_SConstruct_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SConstruct_dir</span> <span class="o">=</span> <span class="nb">dir</span></div>

<div class="viewcode-block" id="FS.get_max_drift"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.get_max_drift">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_drift</span></div>

<div class="viewcode-block" id="FS.set_max_drift"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.set_max_drift">[docs]</a>    <span class="k">def</span> <span class="nf">set_max_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_drift</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_drift</span> <span class="o">=</span> <span class="n">max_drift</span></div>

<div class="viewcode-block" id="FS.getcwd"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.getcwd">[docs]</a>    <span class="k">def</span> <span class="nf">getcwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_cwd&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;no cwd&gt;&quot;</span></div>

<div class="viewcode-block" id="FS.chdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.chdir">[docs]</a>    <span class="k">def</span> <span class="nf">chdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">change_os_dir</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the current working directory for lookups.</span>
<span class="sd">        If change_os_dir is true, we will also change the &quot;real&quot; cwd</span>
<span class="sd">        to match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">curr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="nb">dir</span>
                <span class="k">if</span> <span class="n">change_os_dir</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">curr</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="FS.get_root"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.get_root">[docs]</a>    <span class="k">def</span> <span class="nf">get_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drive</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the root directory for the specified drive, creating</span>
<span class="sd">        it if necessary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">drive</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Root</span><span class="p">[</span><span class="n">drive</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">RootDir</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Root</span><span class="p">[</span><span class="n">drive</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">drive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Root</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultDrive</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="k">elif</span> <span class="n">drive</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultDrive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Root</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="k">return</span> <span class="n">root</span></div>

<div class="viewcode-block" id="FS._lookup"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS._lookup">[docs]</a>    <span class="k">def</span> <span class="nf">_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fsclass</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The generic entry point for Node lookup with user-supplied data.</span>

<span class="sd">        This translates arbitrary input into a canonical Node.FS object</span>
<span class="sd">        of the specified fsclass.  The general approach for strings is</span>
<span class="sd">        to turn it into a fully normalized absolute path and then call</span>
<span class="sd">        the root directory&#39;s lookup_abs() method for the heavy lifting.</span>

<span class="sd">        If the path name begins with &#39;#&#39;, it is unconditionally</span>
<span class="sd">        interpreted relative to the top-level directory of this FS.  &#39;#&#39;</span>
<span class="sd">        is treated as a synonym for the top-level SConstruct directory,</span>
<span class="sd">        much like &#39;~&#39; is treated as a synonym for the user&#39;s home</span>
<span class="sd">        directory in a UNIX shell.  So both &#39;#foo&#39; and &#39;#/foo&#39; refer</span>
<span class="sd">        to the &#39;foo&#39; subdirectory underneath the top-level SConstruct</span>
<span class="sd">        directory.</span>

<span class="sd">        If the path name is relative, then the path is looked up relative</span>
<span class="sd">        to the specified directory, or the current directory (self._cwd,</span>
<span class="sd">        typically the SConscript directory) if the specified directory</span>
<span class="sd">        is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
            <span class="c1"># It&#39;s already a Node.FS object.  Make sure it&#39;s the right</span>
            <span class="c1"># class and return.</span>
            <span class="n">p</span><span class="o">.</span><span class="n">must_be_same</span><span class="p">(</span><span class="n">fsclass</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="c1"># str(p) in case it&#39;s something like a proxy object</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os_sep_is_slash</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">OS_SEP</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="c1"># There was an initial &#39;#&#39;, so we strip it and override</span>
            <span class="c1"># whatever directory they may have specified with the</span>
            <span class="c1"># top-level SConstruct directory.</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Top</span>

            <span class="c1"># There might be a drive letter following the</span>
            <span class="c1"># &#39;#&#39;. Although it is not described in the SCons man page,</span>
            <span class="c1"># the regression test suite explicitly tests for that</span>
            <span class="c1"># syntax. It seems to mean the following thing:</span>
            <span class="c1">#</span>
            <span class="c1">#   Assuming the the SCons top dir is in C:/xxx/yyy,</span>
            <span class="c1">#   &#39;#X:/toto&#39; means X:/xxx/yyy/toto.</span>
            <span class="c1">#</span>
            <span class="c1"># i.e. it assumes that the X: drive has a directory</span>
            <span class="c1"># structure similar to the one found on drive C:.</span>
            <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
                <span class="n">drive</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">_my_splitdrive</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">drive</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">root</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">root</span>

            <span class="c1"># We can only strip trailing after splitting the drive</span>
            <span class="c1"># since the drive might the UNC &#39;//&#39; prefix.</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

            <span class="n">needs_normpath</span> <span class="o">=</span> <span class="n">needs_normpath_match</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="c1"># The path is relative to the top-level SCons directory.</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
                <span class="n">drive</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">_my_splitdrive</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">drive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                    <span class="c1"># This causes a naked drive letter to be treated</span>
                    <span class="c1"># as a synonym for the root directory on that</span>
                    <span class="c1"># drive.</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">drive</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># We can only strip trailing &#39;/&#39; since the drive might the</span>
            <span class="c1"># UNC &#39;//&#39; prefix.</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

            <span class="n">needs_normpath</span> <span class="o">=</span> <span class="n">needs_normpath_match</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                <span class="c1"># Absolute path</span>
                <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This is a relative lookup or to the current directory</span>
                <span class="c1"># (the path name is not absolute).  Add the string to the</span>
                <span class="c1"># appropriate directory lookup path, after which the whole</span>
                <span class="c1"># thing gets normalized.</span>
                <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">Dir</span><span class="p">):</span>
                        <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span>

                <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">p</span>

                <span class="k">if</span> <span class="n">drive</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="n">root</span>

        <span class="k">if</span> <span class="n">needs_normpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Normalize a pathname. Will return the same result for</span>
            <span class="c1"># equivalent paths.</span>
            <span class="c1">#</span>
            <span class="c1"># We take advantage of the fact that we have an absolute</span>
            <span class="c1"># path here for sure. In addition, we know that the</span>
            <span class="c1"># components of lookup path are separated by slashes at</span>
            <span class="c1"># this point. Because of this, this code is about 2X</span>
            <span class="c1"># faster than calling os.path.normpath() followed by</span>
            <span class="c1"># replacing os.sep with &#39;/&#39; again.</span>
            <span class="n">ins</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">outs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">outs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">outs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">_lookup_abs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fsclass</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.Entry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.Entry">[docs]</a>    <span class="k">def</span> <span class="nf">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up or create a generic Entry node with the specified name.</span>
<span class="sd">        If the name is a relative path (begins with ./, ../, or a file</span>
<span class="sd">        name), then it is looked up relative to the supplied directory</span>
<span class="sd">        node, or to the top level directory of the FS (supplied at</span>
<span class="sd">        construction time) if no directory is supplied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.File"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.File">[docs]</a>    <span class="k">def</span> <span class="nf">File</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up or create a File node with the specified name.  If</span>
<span class="sd">        the name is a relative path (begins with ./, ../, or a file name),</span>
<span class="sd">        then it is looked up relative to the supplied directory node,</span>
<span class="sd">        or to the top level directory of the FS (supplied at construction</span>
<span class="sd">        time) if no directory is supplied.</span>

<span class="sd">        This method will raise TypeError if a directory is found at the</span>
<span class="sd">        specified path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.Dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.Dir">[docs]</a>    <span class="k">def</span> <span class="nf">Dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Look up or create a Dir node with the specified name.  If</span>
<span class="sd">        the name is a relative path (begins with ./, ../, or a file name),</span>
<span class="sd">        then it is looked up relative to the supplied directory node,</span>
<span class="sd">        or to the top level directory of the FS (supplied at construction</span>
<span class="sd">        time) if no directory is supplied.</span>

<span class="sd">        This method will raise TypeError if a normal file is found at the</span>
<span class="sd">        specified path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.VariantDir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.VariantDir">[docs]</a>    <span class="k">def</span> <span class="nf">VariantDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant_dir</span><span class="p">,</span> <span class="n">src_dir</span><span class="p">,</span> <span class="n">duplicate</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Link the supplied variant directory to the source directory</span>
<span class="sd">        for purposes of building files.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
            <span class="n">src_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">src_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
            <span class="n">variant_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">src_dir</span><span class="o">.</span><span class="n">is_under</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Source directory cannot be under variant directory.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variant_dir</span><span class="o">.</span><span class="n">srcdir</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">variant_dir</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">==</span> <span class="n">src_dir</span><span class="p">:</span>
                <span class="k">return</span> <span class="c1"># We already did this.</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; already has a source directory: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">,</span> <span class="n">variant_dir</span><span class="o">.</span><span class="n">srcdir</span><span class="p">))</span>
        <span class="n">variant_dir</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">duplicate</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.Repository"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.Repository">[docs]</a>    <span class="k">def</span> <span class="nf">Repository</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">dirs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Specify Repository directories to search.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Top</span><span class="o">.</span><span class="n">addRepository</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="FS.PyPackageDir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.PyPackageDir">[docs]</a>    <span class="k">def</span> <span class="nf">PyPackageDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modulename</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dir</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Locate the directory of Python module *modulename*.</span>

<span class="sd">        For example &#39;SCons&#39; might resolve to</span>
<span class="sd">        Windows: C:\Python311\Lib\site-packages\SCons</span>
<span class="sd">        Linux: /usr/lib64/python3.11/site-packages/SCons</span>

<span class="sd">        Can be used to determine a toolpath based on a Python module name.</span>

<span class="sd">        This is the backend called by the public API function</span>
<span class="sd">        :meth:`~Environment.Base.PyPackageDir`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modspec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">modulename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modspec</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">modspec</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fsclass</span><span class="o">=</span><span class="n">Dir</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="FS.variant_dir_target_climb"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.variant_dir_target_climb">[docs]</a>    <span class="k">def</span> <span class="nf">variant_dir_target_climb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">tail</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create targets in corresponding variant directories</span>

<span class="sd">        Climb the directory tree, and look up path names</span>
<span class="sd">        relative to any linked variant directories we find.</span>

<span class="sd">        Even though this loops and walks up the tree, we don&#39;t memoize</span>
<span class="sd">        the return value because this is really only used to process</span>
<span class="sd">        the command-line targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;building associated VariantDir targets: </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="n">start_dir</span> <span class="o">=</span> <span class="nb">dir</span>
        <span class="k">while</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bd</span> <span class="ow">in</span> <span class="nb">dir</span><span class="o">.</span><span class="n">variant_dirs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">start_dir</span><span class="o">.</span><span class="n">is_under</span><span class="p">(</span><span class="n">bd</span><span class="p">):</span>
                    <span class="c1"># If already in the build-dir location, don&#39;t reflect</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">orig</span><span class="p">],</span> <span class="n">fmt</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bd</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span><span class="p">)</span>
                <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dir</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">tail</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">fmt</span> <span class="o">%</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">targets</span><span class="p">,</span> <span class="n">message</span></div>

<div class="viewcode-block" id="FS.Glob"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FS.Glob">[docs]</a>    <span class="k">def</span> <span class="nf">Glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Globs</span>

<span class="sd">        This is mainly a shim layer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cwd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cwd</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DirNodeInfo"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.DirNodeInfo">[docs]</a><span class="k">class</span> <span class="nc">DirNodeInfo</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">NodeInfoBase</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="c1"># This should get reset by the FS initialization.</span>
    <span class="n">current_version_id</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DirNodeInfo.str_to_node"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.DirNodeInfo.str_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">str_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Top</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">root</span>
        <span class="c1"># Python 3.13/Win changed isabs() - after you split C:/foo/bar,</span>
        <span class="c1"># the path part is no longer considerd absolute. Save the passed</span>
        <span class="c1"># path for the isabs check so we can get the right answer.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
            <span class="n">drive</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_my_splitdrive</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drive</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">_lookup_abs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Entry</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DirBuildInfo"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.DirBuildInfo">[docs]</a><span class="k">class</span> <span class="nc">DirBuildInfo</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">BuildInfoBase</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">current_version_id</span> <span class="o">=</span> <span class="mi">2</span></div>

<span class="n">glob_magic_check</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[*?[]&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="has_glob_magic"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.has_glob_magic">[docs]</a><span class="k">def</span> <span class="nf">has_glob_magic</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">glob_magic_check</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir">[docs]</a><span class="k">class</span> <span class="nc">Dir</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for directories in a file system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scanner_paths&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachedir_csig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachesig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;repositories&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;srcdir&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;searched&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_sconsign&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;variant_dirs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;dirname&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;on_disk_entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;released_target_info&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;contentsig&#39;</span><span class="p">]</span>

    <span class="n">NodeInfo</span> <span class="o">=</span> <span class="n">DirNodeInfo</span>
    <span class="n">BuildInfo</span> <span class="o">=</span> <span class="n">DirBuildInfo</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Node.FS.Dir&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>

<div class="viewcode-block" id="Dir._morph"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir._morph">[docs]</a>    <span class="k">def</span> <span class="nf">_morph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn a file system Node (either a freshly initialized directory</span>
<span class="sd">        object or a separate Entry object) into a proper directory object.</span>

<span class="sd">        Set up this directory&#39;s entries and hook it into the file</span>
<span class="sd">        system tree.  Specify that directories (this Node) don&#39;t use</span>
<span class="sd">        signatures for calculating whether they&#39;re current.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">searched</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sconsign</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variant_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_sconsign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_labspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_path</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">entry_tpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_path_elements</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>

        <span class="c1"># For directories, we make a difference between the directory</span>
        <span class="c1"># &#39;name&#39; and the directory &#39;dirname&#39;. The &#39;name&#39; attribute is</span>
        <span class="c1"># used when we need to print the &#39;name&#39; of the directory or</span>
        <span class="c1"># when we it is used as the last part of a path. The &#39;dirname&#39;</span>
        <span class="c1"># is used when the directory is not the last element of the</span>
        <span class="c1"># path. The main reason for making that distinction is that</span>
        <span class="c1"># for RoorDir&#39;s the dirname can not be easily inferred from</span>
        <span class="c1"># the name. For example, we have to add a &#39;/&#39; after a drive</span>
        <span class="c1"># letter but not after a UNC path prefix (&#39;//&#39;).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">OS_SEP</span>

        <span class="c1"># Don&#39;t just reset the executor, replace its action list,</span>
        <span class="c1"># because it might have some pre-or post-actions that need to</span>
        <span class="c1"># be preserved.</span>
        <span class="c1">#</span>
        <span class="c1"># But don&#39;t reset the executor if there is a non-null executor</span>
        <span class="c1"># attached already. The existing executor might have other</span>
        <span class="c1"># targets, in which case replacing the action list with a</span>
        <span class="c1"># Mkdir action is a big mistake.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;executor&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="o">=</span> <span class="n">get_MkdirBuilder</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">set_action_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Prepend MkdirBuilder action to existing action list</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">action_list</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">get_MkdirBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">action</span>
            <span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">set_action_list</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.diskcheck_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.diskcheck_match">[docs]</a>    <span class="k">def</span> <span class="nf">diskcheck_match</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">diskcheck_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isfile</span><span class="p">,</span>
                        <span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> found where directory expected.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__clearRepositoryCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duplicate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when we change the repository(ies) for a directory.</span>
<span class="sd">        This clears any cached information that is invalidated by changing</span>
<span class="sd">        the repository.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span> <span class="o">!=</span> <span class="bp">self</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Dir</span><span class="p">):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">__clearRepositoryCache</span><span class="p">(</span><span class="n">duplicate</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">_srcreps</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">if</span> <span class="n">duplicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">duplicate</span> <span class="o">=</span> <span class="n">duplicate</span>

    <span class="k">def</span> <span class="nf">__resetDuplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">duplicate</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_dir</span><span class="p">()</span><span class="o">.</span><span class="n">duplicate</span>

<div class="viewcode-block" id="Dir.Entry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.Entry">[docs]</a>    <span class="k">def</span> <span class="nf">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up or creates an entry node named &#39;name&#39; relative to</span>
<span class="sd">        this directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.Dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.Dir">[docs]</a>    <span class="k">def</span> <span class="nf">Dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up or creates a directory node named &#39;name&#39; relative to</span>
<span class="sd">        this directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.File"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.File">[docs]</a>    <span class="k">def</span> <span class="nf">File</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Looks up or creates a file node named &#39;name&#39; relative to</span>
<span class="sd">        this directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.link"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.link">[docs]</a>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srcdir</span><span class="p">,</span> <span class="n">duplicate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set this directory as the variant directory for the</span>
<span class="sd">        supplied source directory.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">=</span> <span class="n">srcdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span> <span class="o">=</span> <span class="n">duplicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__clearRepositoryCache</span><span class="p">(</span><span class="n">duplicate</span><span class="p">)</span>
        <span class="n">srcdir</span><span class="o">.</span><span class="n">variant_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.getRepositories"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.getRepositories">[docs]</a>    <span class="k">def</span> <span class="nf">getRepositories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of repositories for this directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span></div>

<div class="viewcode-block" id="Dir.get_all_rdirs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_all_rdirs">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">get_all_rdirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_all_rdirs&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">dir</span><span class="o">.</span><span class="n">getRepositories</span><span class="p">():</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rep</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">fname</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_all_rdirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dir.addRepository"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.addRepository">[docs]</a>    <span class="k">def</span> <span class="nf">addRepository</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">dir</span> <span class="o">!=</span> <span class="bp">self</span> <span class="ow">and</span> <span class="nb">dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
            <span class="nb">dir</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__clearRepositoryCache</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dir.up"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.up">[docs]</a>    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span></div>

<div class="viewcode-block" id="Dir._rel_path_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir._rel_path_key">[docs]</a>    <span class="k">def</span> <span class="nf">_rel_path_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.rel_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.rel_path">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountDictCall</span><span class="p">(</span><span class="n">_rel_path_key</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a path to &quot;other&quot; relative to this directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This complicated and expensive method, which constructs relative</span>
        <span class="c1"># paths between arbitrary Node.FS objects, is no longer used</span>
        <span class="c1"># by SCons itself.  It was introduced to store dependency paths</span>
        <span class="c1"># in .sconsign files relative to the target, but that ended up</span>
        <span class="c1"># being significantly inefficient.</span>
        <span class="c1">#</span>
        <span class="c1"># We&#39;re continuing to support the method because some SConstruct</span>
        <span class="c1"># files out there started using it when it was available, and</span>
        <span class="c1"># we&#39;re all about backwards compatibility..</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rel_path&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rel_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">memo_dict</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>

        <span class="k">elif</span> <span class="n">other</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other_dir</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_dir</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">other_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dir_rel_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_path</span><span class="p">(</span><span class="n">other_dir</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dir_rel_path</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">dir_rel_path</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">path_elems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;..&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> \
                         <span class="o">+</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">_path_elements</span><span class="p">[</span><span class="n">i</span><span class="p">:]]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">OS_SEP</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_elems</span><span class="p">)</span>

        <span class="n">memo_dict</span><span class="p">[</span><span class="n">other</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dir.get_env_scanner"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_env_scanner">[docs]</a>    <span class="k">def</span> <span class="nf">get_env_scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="p">{}):</span>
        <span class="kn">import</span> <span class="nn">SCons.Defaults</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DirEntryScanner</span></div>

<div class="viewcode-block" id="Dir.get_target_scanner"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_target_scanner">[docs]</a>    <span class="k">def</span> <span class="nf">get_target_scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">SCons.Defaults</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DirEntryScanner</span></div>

<div class="viewcode-block" id="Dir.get_found_includes"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_found_includes">[docs]</a>    <span class="k">def</span> <span class="nf">get_found_includes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">scanner</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return this directory&#39;s implicit dependencies.</span>

<span class="sd">        We don&#39;t bother caching the results because the scan typically</span>
<span class="sd">        shouldn&#39;t be requested more than once (as opposed to scanning</span>
<span class="sd">        .h file contents, which can be requested as many times as the</span>
<span class="sd">        files is #included by other files).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scanner</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># Clear cached info for this Dir.  If we already visited this</span>
        <span class="c1"># directory on our walk down the tree (because we didn&#39;t know at</span>
        <span class="c1"># that point it was being used as the source for another Node)</span>
        <span class="c1"># then we may have calculated build signature before realizing</span>
        <span class="c1"># we had to scan the disk.  Now that we have to, though, we need</span>
        <span class="c1"># to invalidate the old calculated signature so that any node</span>
        <span class="c1"># dependent on our directory structure gets one that includes</span>
        <span class="c1"># info about everything on disk.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

    <span class="c1">#</span>
    <span class="c1"># Taskmaster interface subsystem</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Dir.prepare"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Dir.build"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A null &quot;builder&quot; for directories.&quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">MkdirBuilder</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MkdirBuilder</span><span class="p">:</span>
            <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Dir._create"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir._create">[docs]</a>    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create this directory, silently and without worrying about</span>
<span class="sd">        whether the builder is the default or not.&quot;&quot;&quot;</span>
        <span class="n">listDirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="n">listDirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Don&#39;t use while: - else: for this condition because</span>
                <span class="c1"># if so, then parent is None and has no .path attribute.</span>
                <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">StopError</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">listDirs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dirnode</span> <span class="ow">in</span> <span class="n">listDirs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Don&#39;t call dirnode.build(), call the base Node method</span>
                <span class="c1"># directly because we definitely *must* create this</span>
                <span class="c1"># directory.  The dirnode.build() method will suppress</span>
                <span class="c1"># the build if it&#39;s the default builder.</span>
                <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">dirnode</span><span class="p">)</span>
                <span class="n">dirnode</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">nullify</span><span class="p">()</span>
                <span class="c1"># The build() action may or may not have actually</span>
                <span class="c1"># created the directory, depending on whether the -n</span>
                <span class="c1"># option was used or not.  Delete the _exists and</span>
                <span class="c1"># _rexists attributes so they can be reevaluated.</span>
                <span class="n">dirnode</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="Dir.multiple_side_effect_has_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.multiple_side_effect_has_builder">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_side_effect_has_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">MkdirBuilder</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MkdirBuilder</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_builder</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dir.alter_targets"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.alter_targets">[docs]</a>    <span class="k">def</span> <span class="nf">alter_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return any corresponding targets in a variant directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">variant_dir_target_climb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Dir.scanner_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.scanner_key">[docs]</a>    <span class="k">def</span> <span class="nf">scanner_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A directory does not get scanned.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dir.get_text_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_text_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_text_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;We already emit things in text, so just return the binary</span>
<span class="sd">        version.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dir.get_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return content signatures and names of all our children</span>
<span class="sd">        separated by new-lines. Ensure that the nodes are sorted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_get_contents_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.get_csig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_csig">[docs]</a>    <span class="k">def</span> <span class="nf">get_csig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the content signature for Directory nodes. In</span>
<span class="sd">        general, this is not needed and the content signature is not</span>
<span class="sd">        stored in the DirNodeInfo. However, if get_contents on a Dir</span>
<span class="sd">        node is called which has a child directory, the child</span>
<span class="sd">        directory should return the hash of its contents.&quot;&quot;&quot;</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hash_signature</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.do_duplicate"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.do_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">do_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Dir.is_up_to_date"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.is_up_to_date">[docs]</a>    <span class="k">def</span> <span class="nf">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If any child is not up-to-date, then this directory isn&#39;t, either.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MkdirBuilder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">up_to_date</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">up_to_date</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kid</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">up_to_date</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Dir.rdir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.rdir">[docs]</a>    <span class="k">def</span> <span class="nf">rdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">dir_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">Dir</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">Entry</span><span class="p">)):</span>
                        <span class="k">return</span> <span class="n">node</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dir.sconsign"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.sconsign">[docs]</a>    <span class="k">def</span> <span class="nf">sconsign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the .sconsign file info for this directory. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_sconsign_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_sconsign</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.srcnode"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.srcnode">[docs]</a>    <span class="k">def</span> <span class="nf">srcnode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dir has a special need for srcnode()...if we</span>
<span class="sd">        have a srcdir attribute set, then that *is* our srcnode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span>
        <span class="k">return</span> <span class="n">Base</span><span class="o">.</span><span class="n">srcnode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.get_timestamp"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_timestamp">[docs]</a>    <span class="k">def</span> <span class="nf">get_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the latest timestamp from among our children&quot;&quot;&quot;</span>
        <span class="n">stamp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kid</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">stamp</span><span class="p">:</span>
                <span class="n">stamp</span> <span class="o">=</span> <span class="n">kid</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stamp</span></div>

<div class="viewcode-block" id="Dir.get_abspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_abspath">[docs]</a>    <span class="k">def</span> <span class="nf">get_abspath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path of the file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span></div>

<div class="viewcode-block" id="Dir.get_labspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_labspath">[docs]</a>    <span class="k">def</span> <span class="nf">get_labspath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the absolute path of the file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span></div>

<div class="viewcode-block" id="Dir.get_internal_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_internal_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_internal_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span></div>

<div class="viewcode-block" id="Dir.get_tpath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_tpath">[docs]</a>    <span class="k">def</span> <span class="nf">get_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span></div>

<div class="viewcode-block" id="Dir.get_path_elements"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.get_path_elements">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span></div>

<div class="viewcode-block" id="Dir.entry_abspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.entry_abspath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_abspath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Dir.entry_labspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.entry_labspath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_labspath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Dir.entry_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.entry_path">[docs]</a>    <span class="k">def</span> <span class="nf">entry_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Dir.entry_tpath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.entry_tpath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Dir.entry_exists_on_disk"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.entry_exists_on_disk">[docs]</a>    <span class="k">def</span> <span class="nf">entry_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Searches through the file/dir entries of the current</span>
<span class="sd">            directory, and returns True if a physical entry with the given</span>
<span class="sd">            name could be found.</span>

<span class="sd">            @see rentry_exists_on_disk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_disk_entries</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">_my_normcase</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_disk_entries</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;cygwin&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Belt-and-suspenders for Windows:  check directly for</span>
                <span class="c1"># 8.3 file names that don&#39;t show up in os.listdir().</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">d</span></div>

<div class="viewcode-block" id="Dir.rentry_exists_on_disk"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.rentry_exists_on_disk">[docs]</a>    <span class="k">def</span> <span class="nf">rentry_exists_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Searches through the file/dir entries of the current</span>
<span class="sd">            *and* all its remote directories (repos), and returns</span>
<span class="sd">            True if a physical entry with the given name could be found.</span>
<span class="sd">            The local directory (self) gets searched first, so</span>
<span class="sd">            repositories take a lower precedence regarding the</span>
<span class="sd">            searching order.</span>

<span class="sd">            @see entry_exists_on_disk</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rentry_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rentry_exists</span><span class="p">:</span>
            <span class="c1"># Search through the repository folders</span>
            <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">rdir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                        <span class="n">rentry_exists</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rdir</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">rentry_exists</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">rentry_exists</span></div>

<div class="viewcode-block" id="Dir.srcdir_list"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.srcdir_list">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">srcdir_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;srcdir_list&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">srcdir</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">srcdir</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">dirname</span><span class="p">))</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">OS_SEP</span> <span class="o">+</span> <span class="n">dirname</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;srcdir_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dir.srcdir_duplicate"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.srcdir_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">srcdir_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir_list</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_under</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
                <span class="c1"># We shouldn&#39;t source from something in the build path;</span>
                <span class="c1"># variant_dir is probably under src_dir, in which case</span>
                <span class="c1"># we are reflecting.</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">dir</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">srcnode</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">do_duplicate</span><span class="p">(</span><span class="n">srcnode</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">node</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">srcnode</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dir._srcdir_find_file_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir._srcdir_find_file_key">[docs]</a>    <span class="k">def</span> <span class="nf">_srcdir_find_file_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="Dir.srcdir_find_file"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.srcdir_find_file">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountDictCall</span><span class="p">(</span><span class="n">_srcdir_find_file_key</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">srcdir_find_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;srcdir_find_file&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;srcdir_find_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">memo_dict</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">File</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Entry</span><span class="p">))</span> <span class="ow">and</span> \
               <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_derived</span><span class="p">()</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
                    <span class="k">return</span> <span class="n">node</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">rdir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">rdir</span><span class="o">.</span><span class="n">file_on_disk</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="n">memo_dict</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
                <span class="k">return</span> <span class="n">result</span>

        <span class="k">for</span> <span class="n">srcdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir_list</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rdir</span> <span class="ow">in</span> <span class="n">srcdir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">rdir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">rdir</span><span class="o">.</span><span class="n">file_on_disk</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">),</span> <span class="n">srcdir</span><span class="p">)</span>
                    <span class="n">memo_dict</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">memo_dict</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dir.dir_on_disk"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.dir_on_disk">[docs]</a>    <span class="k">def</span> <span class="nf">dir_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir_duplicate</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">File</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="Dir.file_on_disk"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.file_on_disk">[docs]</a>    <span class="k">def</span> <span class="nf">file_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_exists_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir_duplicate</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Dir</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="Dir.walk"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.walk">[docs]</a>    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Walk this directory tree by calling the specified function</span>
<span class="sd">        for each directory in the tree.</span>

<span class="sd">        This behaves like the os.path.walk() function, but for in-memory</span>
<span class="sd">        Node.FS.Dir objects.  The function takes the same arguments as</span>
<span class="sd">        the functions passed to os.path.walk():</span>

<span class="sd">                func(arg, dirname, fnames)</span>

<span class="sd">        Except that &quot;dirname&quot; will actually be the directory *Node*,</span>
<span class="sd">        not the string.  The &#39;.&#39; and &#39;..&#39; entries are excluded from</span>
<span class="sd">        fnames.  The fnames list may be modified in-place to filter the</span>
<span class="sd">        subdirectories visited or otherwise impose a specific order.</span>
<span class="sd">        The &quot;arg&quot; argument is always passed to func() and may be used</span>
<span class="sd">        in any way (or ignored, passing None is common).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">entries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">Dir</span><span class="p">)]:</span>
            <span class="n">entries</span><span class="p">[</span><span class="n">dirname</span><span class="p">]</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dir.glob"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir.glob">[docs]</a>    <span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of Nodes (or strings) matching a pathname pattern.</span>

<span class="sd">        Pathname patterns follow POSIX shell syntax::</span>

<span class="sd">          *      matches everything</span>
<span class="sd">          ?      matches any single character</span>
<span class="sd">          [seq]  matches any character in seq (ranges allowed)</span>
<span class="sd">          [!seq] matches any char not in seq</span>

<span class="sd">        The wildcard characters can be escaped by enclosing in brackets.</span>
<span class="sd">        A leading dot is not matched by a wildcard, and needs to be</span>
<span class="sd">        explicitly included in the pattern to be matched.  Matches also</span>
<span class="sd">        do not span directory separators.</span>

<span class="sd">        The matches take into account Repositories, returning a local</span>
<span class="sd">        Node if a corresponding entry exists in a Repository (either</span>
<span class="sd">        an in-memory Node or something on disk).</span>

<span class="sd">        The underlying algorithm is adapted from a rather old version</span>
<span class="sd">        of :func:`glob.glob` function in the Python standard library</span>
<span class="sd">        (heavily modified), and uses :func:`fnmatch.fnmatch` under the covers.</span>

<span class="sd">        This is the internal implementation of the external Glob API.</span>

<span class="sd">        Args:</span>
<span class="sd">          pattern: pathname pattern to match.</span>
<span class="sd">          ondisk: if false, restricts matches to in-memory Nodes.</span>
<span class="sd">            By defafult, matches entries that exist on-disk in addition</span>
<span class="sd">            to in-memory Nodes.</span>
<span class="sd">          source: if true, corresponding source Nodes are returned if</span>
<span class="sd">            globbing in a variant directory.  The default behavior</span>
<span class="sd">            is to return Nodes local to the variant directory.</span>
<span class="sd">          strings: if true, returns the matches as strings instead of</span>
<span class="sd">            Nodes. The strings are path names relative to this directory.</span>
<span class="sd">          exclude: if not ``None``, must be a pattern or a list of patterns</span>
<span class="sd">            following the same POSIX shell semantics.  Elements matching at</span>
<span class="sd">            least one pattern from *exclude* will be excluded from the result.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dirname</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dirname</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_glob1</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">has_glob_magic</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">_glob1</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">strings</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">excludes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">excludeList</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">excludeList</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">)</span>
                <span class="n">excludes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">excludes</span><span class="p">))]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span></div>

<div class="viewcode-block" id="Dir._glob1"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.Dir._glob1">[docs]</a>    <span class="k">def</span> <span class="nf">_glob1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ondisk</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Globs for and returns a list of entry names matching a single</span>
<span class="sd">        pattern in this directory.</span>

<span class="sd">        This searches any repositories and source directories for</span>
<span class="sd">        corresponding entries and returns a Node (or string) relative</span>
<span class="sd">        to the current directory if an entry is found anywhere.</span>

<span class="sd">        TODO: handle pattern with no wildcard. Python&#39;s glob.glob uses</span>
<span class="sd">        a separate _glob0 function to do this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">search_dir_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">srcdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">srcdir_list</span><span class="p">():</span>
            <span class="n">search_dir_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">srcdir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">())</span>

        <span class="n">selfEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Entry</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">search_dir_list</span><span class="p">:</span>
            <span class="c1"># We use the .name attribute from the Node because the keys of</span>
            <span class="c1"># the dir.entries dictionary are normalized (that is, all upper</span>
            <span class="c1"># case) on case-insensitive systems like Windows.</span>
            <span class="n">node_names</span> <span class="o">=</span> <span class="p">[</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dir</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                           <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="p">]</span>
            <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">strings</span><span class="p">:</span>
                <span class="c1"># Make sure the working directory (self) actually has</span>
                <span class="c1"># entries for all Nodes in repositories or variant dirs.</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">node_names</span><span class="p">:</span> <span class="n">selfEntry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ondisk</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">disk_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">_abspath</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">disk_names</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">strings</span><span class="p">:</span>
                    <span class="c1"># We&#39;re going to return corresponding Nodes in</span>
                    <span class="c1"># the local directory, so we need to make sure</span>
                    <span class="c1"># those Nodes exist.  We only want to create</span>
                    <span class="c1"># Nodes for the entries that will match the</span>
                    <span class="c1"># specified pattern, though, which means we</span>
                    <span class="c1"># need to filter the list here, even though</span>
                    <span class="c1"># the overall list will also be filtered later,</span>
                    <span class="c1"># after we exit this loop.</span>
                    <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                        <span class="n">disk_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">disk_names</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
                    <span class="n">disk_names</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">disk_names</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
                    <span class="n">dirEntry</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">Entry</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">disk_names</span><span class="p">:</span>
                        <span class="c1"># Add &#39;./&#39; before disk filename so that &#39;#&#39; at</span>
                        <span class="c1"># beginning of filename isn&#39;t interpreted.</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span> <span class="o">+</span> <span class="n">name</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">dirEntry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">selfEntry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
                            <span class="n">n</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__class__</span>
                            <span class="n">n</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>

        <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">strings</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">names</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">_my_normcase</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="RootDir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir">[docs]</a><span class="k">class</span> <span class="nc">RootDir</span><span class="p">(</span><span class="n">Dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for the root directory of a file system.</span>

<span class="sd">    This is the same as a Dir class, except that the path separator</span>
<span class="sd">    (&#39;/&#39; or &#39;\\&#39;) is actually part of the name, so we don&#39;t need to</span>
<span class="sd">    add a separator when creating the path names of entries within</span>
<span class="sd">    this directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_lookupDict&#39;</span><span class="p">,</span> <span class="s1">&#39;abspath&#39;</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drive</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Node.FS.RootDir&#39;</span><span class="p">)</span>
        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Handle all the types of drives:</span>
        <span class="k">if</span> <span class="n">drive</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># No drive, regular UNIX root or Windows default drive.</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">OS_SEP</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">OS_SEP</span>
        <span class="k">elif</span> <span class="n">drive</span> <span class="o">==</span> <span class="s1">&#39;//&#39;</span><span class="p">:</span>
            <span class="c1"># UNC path</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">UNC_PREFIX</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">UNC_PREFIX</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Windows drive letter</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">drive</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">drive</span> <span class="o">+</span> <span class="n">OS_SEP</span>

        <span class="c1"># Filename with extension as it was specified when the object was</span>
        <span class="c1"># created; to obtain filesystem path, use Python str() function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">silent_intern</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span> <span class="c1">#: Reference to parent Node.FS object</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path_elements</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_rexists</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_target_from_source</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store_info</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Now set our paths to what we really want them to be. The</span>
        <span class="c1"># name should already contain any necessary separators, such</span>
        <span class="c1"># as the initial drive letter (the name) plus the directory</span>
        <span class="c1"># separator, except for the &quot;lookup abspath,&quot; which does not</span>
        <span class="c1"># have the drive letter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">=</span> <span class="n">dirname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dirname</span>

        <span class="c1"># EntryProxy interferes with this class and turns drive paths on</span>
        <span class="c1"># Windows such as &quot;C:&quot; into &quot;C:\C:&quot;. Avoid this problem by setting</span>
        <span class="c1"># commonly-accessed attributes directly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abspath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">duplicate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lookupDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># The // entry is necessary because os.path.normpath()</span>
        <span class="c1"># preserves double slashes at the beginning of a path on Posix</span>
        <span class="c1"># platforms.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_splitdrive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lookupDict</span><span class="p">[</span><span class="s1">&#39;//&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="RootDir._morph"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir._morph">[docs]</a>    <span class="k">def</span> <span class="nf">_morph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn a file system Node (either a freshly initialized directory</span>
<span class="sd">        object or a separate Entry object) into a proper directory object.</span>

<span class="sd">        Set up this directory&#39;s entries and hook it into the file</span>
<span class="sd">        system tree.  Specify that directories (this Node) don&#39;t use</span>
<span class="sd">        signatures for calculating whether they&#39;re current.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repositories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcdir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">searched</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sconsign</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variant_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_sconsign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># Don&#39;t just reset the executor, replace its action list,</span>
        <span class="c1"># because it might have some pre-or post-actions that need to</span>
        <span class="c1"># be preserved.</span>
        <span class="c1">#</span>
        <span class="c1"># But don&#39;t reset the executor if there is a non-null executor</span>
        <span class="c1"># attached already. The existing executor might have other</span>
        <span class="c1"># targets, in which case replacing the action list with a</span>
        <span class="c1"># Mkdir action is a big mistake.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;executor&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builder</span> <span class="o">=</span> <span class="n">get_MkdirBuilder</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">set_action_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Prepend MkdirBuilder action to existing action list</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">action_list</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">get_MkdirBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">action</span>
            <span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span><span class="o">.</span><span class="n">set_action_list</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>


<div class="viewcode-block" id="RootDir.must_be_same"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.must_be_same">[docs]</a>    <span class="k">def</span> <span class="nf">must_be_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">klass</span> <span class="ow">is</span> <span class="n">Dir</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">must_be_same</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span></div>

<div class="viewcode-block" id="RootDir._lookup_abs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir._lookup_abs">[docs]</a>    <span class="k">def</span> <span class="nf">_lookup_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fast (?) lookup of a *normalized* absolute path.</span>

<span class="sd">        This method is intended for use by internal lookups with</span>
<span class="sd">        already-normalized path data.  For general-purpose lookups,</span>
<span class="sd">        use the FS.Entry(), FS.Dir() or FS.File() methods.</span>

<span class="sd">        The caller is responsible for making sure we&#39;re passed a</span>
<span class="sd">        normalized absolute path; we merely let Python&#39;s dictionary look</span>
<span class="sd">        up and return the One True Node.FS object for the path.</span>

<span class="sd">        If a Node for the specified &quot;p&quot; doesn&#39;t already exist, and</span>
<span class="sd">        &quot;create&quot; is specified, the Node may be created after recursive</span>
<span class="sd">        invocation to find or create the parent directory or directories.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookupDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">create</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No such file or directory: &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39; (and create is False)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># There is no Node for this path name, and we&#39;re allowed</span>
            <span class="c1"># to create it.</span>
            <span class="n">dir_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dir_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_abs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">Dir</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dir_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>

            <span class="c1"># Double-check on disk (as configured) that the Node we</span>
            <span class="c1"># created matches whatever is out there in the real world.</span>
            <span class="n">result</span><span class="o">.</span><span class="n">diskcheck_match</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_lookupDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">dir_node</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">_my_normcase</span><span class="p">(</span><span class="n">file_name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">dir_node</span><span class="o">.</span><span class="n">implicit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># There is already a Node for this path name.  Allow it to</span>
            <span class="c1"># complain if we were looking for an inappropriate type.</span>
            <span class="n">result</span><span class="o">.</span><span class="n">must_be_same</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span>

<div class="viewcode-block" id="RootDir.entry_abspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.entry_abspath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_abspath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abspath</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="RootDir.entry_labspath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.entry_labspath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_labspath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="RootDir.entry_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.entry_path">[docs]</a>    <span class="k">def</span> <span class="nf">entry_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="RootDir.entry_tpath"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.entry_tpath">[docs]</a>    <span class="k">def</span> <span class="nf">entry_tpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tpath</span> <span class="o">+</span> <span class="n">name</span></div>

<div class="viewcode-block" id="RootDir.is_under"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.is_under">[docs]</a>    <span class="k">def</span> <span class="nf">is_under</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="nb">dir</span> <span class="k">else</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RootDir.up"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.up">[docs]</a>    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RootDir.get_dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.get_dir">[docs]</a>    <span class="k">def</span> <span class="nf">get_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RootDir.src_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.RootDir.src_builder">[docs]</a>    <span class="k">def</span> <span class="nf">src_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_null</span></div></div>


<div class="viewcode-block" id="FileNodeInfo"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileNodeInfo">[docs]</a><span class="k">class</span> <span class="nc">FileNodeInfo</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">NodeInfoBase</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;csig&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">)</span>
    <span class="n">current_version_id</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">field_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;csig&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">]</span>

    <span class="c1"># This should get reset by the FS initialization.</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FileNodeInfo.str_to_node"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileNodeInfo.str_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">str_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Top</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">root</span>
        <span class="c1"># Python 3.13/Win changed isabs() - after you split C:/foo/bar,</span>
        <span class="c1"># the path part is no longer considerd absolute. Save the passed</span>
        <span class="c1"># path for the isabs check so we can get the right answer.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
            <span class="n">drive</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_my_splitdrive</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drive</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">get_labspath</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="n">_lookup_abs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Entry</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">csig</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">csig</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">timestamp</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileBuildInfo"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfo">[docs]</a><span class="k">class</span> <span class="nc">FileBuildInfo</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">BuildInfoBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is info loaded from sconsign.</span>

<span class="sd">    Attributes unique to FileBuildInfo:</span>
<span class="sd">        dependency_map : Caches file-&gt;csig mapping</span>
<span class="sd">            for all dependencies.  Currently this is only used when using</span>
<span class="sd">            MD5-timestamp decider.</span>
<span class="sd">            It&#39;s used to ensure that we copy the correct csig from the</span>
<span class="sd">            previous build to be written to .sconsign when current build</span>
<span class="sd">            is done. Previously the matching of csig to file was strictly</span>
<span class="sd">            by order they appeared in bdepends, bsources, or bimplicit,</span>
<span class="sd">            and so a change in order or count of any of these could</span>
<span class="sd">            yield writing wrong csig, and then false positive rebuilds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dependency_map&#39;</span><span class="p">,</span> <span class="p">]</span>
    <span class="n">current_version_id</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="c1"># If any attributes are changed in FileBuildInfo, we need to</span>
        <span class="c1"># invalidate the cached map of file name to content signature</span>
        <span class="c1"># heald in dependency_map. Currently only used with</span>
        <span class="c1"># MD5-timestamp decider</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;dependency_map&#39;</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dependency_map&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependency_map</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="FileBuildInfo.convert_to_sconsign"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfo.convert_to_sconsign">[docs]</a>    <span class="k">def</span> <span class="nf">convert_to_sconsign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts this FileBuildInfo object for writing to a .sconsign file</span>

<span class="sd">        This replaces each Node in our various dependency lists with its</span>
<span class="sd">        usual string representation: relative to the top-level SConstruct</span>
<span class="sd">        directory, or an absolute path if it&#39;s outside.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os_sep_is_slash</span><span class="p">:</span>
            <span class="n">node_to_str</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">node_to_str</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">OS_SEP</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">s</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bsources&#39;</span><span class="p">,</span> <span class="s1">&#39;bdepends&#39;</span><span class="p">,</span> <span class="s1">&#39;bimplicit&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">node_to_str</span><span class="p">,</span> <span class="n">val</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FileBuildInfo.convert_from_sconsign"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfo.convert_from_sconsign">[docs]</a>    <span class="k">def</span> <span class="nf">convert_from_sconsign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a newly-read FileBuildInfo object for in-SCons use</span>

<span class="sd">        For normal up-to-date checking, we don&#39;t have any conversion to</span>
<span class="sd">        perform--but we&#39;re leaving this method here to make that clear.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FileBuildInfo.prepare_dependencies"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfo.prepare_dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares a FileBuildInfo object for explaining what changed</span>

<span class="sd">        The bsources, bdepends and bimplicit lists have all been</span>
<span class="sd">        stored on disk as paths relative to the top-level SConstruct</span>
<span class="sd">        directory.  Convert the strings to actual Nodes (for use by the</span>
<span class="sd">        --debug=explain code and --implicit-cache).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;bsources&#39;</span><span class="p">,</span> <span class="s1">&#39;bsourcesigs&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;bdepends&#39;</span><span class="p">,</span> <span class="s1">&#39;bdependsigs&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;bimplicit&#39;</span><span class="p">,</span> <span class="s1">&#39;bimplicitsigs&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">nattr</span><span class="p">,</span> <span class="n">sattr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nattr</span><span class="p">)</span>
                <span class="n">nodeinfos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sattr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">strings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">nodeinfos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ni</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">nodeinfos</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">ni</span><span class="o">.</span><span class="n">str_to_node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nattr</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileBuildInfo.format"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileBuildInfo.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bkids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsources</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdepends</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bimplicit</span>
        <span class="n">bkidsigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bsourcesigs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bdependsigs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bimplicitsigs</span>
        <span class="k">for</span> <span class="n">bkid</span><span class="p">,</span> <span class="n">bkidsig</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bkids</span><span class="p">,</span> <span class="n">bkidsigs</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bkid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bkidsig</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;bact&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bact</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bactsig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bact</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="File"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File">[docs]</a><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for files in a file system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scanner_paths&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachedir_csig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cachesig&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;repositories&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;srcdir&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;searched&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_sconsign&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;variant_dirs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;dirname&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;on_disk_entries&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;released_target_info&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;contentsig&#39;</span><span class="p">]</span>

    <span class="n">NodeInfo</span> <span class="o">=</span> <span class="n">FileNodeInfo</span>
    <span class="n">BuildInfo</span> <span class="o">=</span> <span class="n">FileBuildInfo</span>

    <span class="c1"># Although the command-line argument is in kilobytes, this is in bytes.</span>
    <span class="n">hash_chunksize</span> <span class="o">=</span> <span class="mi">65536</span>

<div class="viewcode-block" id="File.diskcheck_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.diskcheck_match">[docs]</a>    <span class="k">def</span> <span class="nf">diskcheck_match</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">diskcheck_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdir</span><span class="p">,</span>
                        <span class="s2">&quot;Directory </span><span class="si">%s</span><span class="s2"> found where file expected.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Node.FS.File&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_morph</span><span class="p">()</span>

<div class="viewcode-block" id="File.Entry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.Entry">[docs]</a>    <span class="k">def</span> <span class="nf">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an entry node named &#39;name&#39; relative to</span>
<span class="sd">        the directory of this file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.Dir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.Dir">[docs]</a>    <span class="k">def</span> <span class="nf">Dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a directory node named &#39;name&#39; relative to</span>
<span class="sd">        the directory of this file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.Dirs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.Dirs">[docs]</a>    <span class="k">def</span> <span class="nf">Dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathlist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a list of directories relative to the SConscript</span>
<span class="sd">        directory of this file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pathlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="File.File"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.File">[docs]</a>    <span class="k">def</span> <span class="nf">File</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a file node named &#39;name&#39; relative to</span>
<span class="sd">        the directory of this file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="File._morph"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._morph">[docs]</a>    <span class="k">def</span> <span class="nf">_morph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn a file system node into a File object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_local&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;released_target_info&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">released_target_info</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">store_info</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># Initialize this Node&#39;s decider function to decide_source() because</span>
        <span class="c1"># every file is a source file until it has a Builder attached...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># If there was already a Builder set on this entry, then</span>
        <span class="c1"># we need to make sure we call the target-decider function,</span>
        <span class="c1"># not the source-decider.  Reaching in and doing this by hand</span>
        <span class="c1"># is a little bogus.  We&#39;d prefer to handle this by adding</span>
        <span class="c1"># an Entry.builder_set() method that disambiguates like the</span>
        <span class="c1"># other methods, but that starts running into problems with the</span>
        <span class="c1"># fragile way we initialize Dir Nodes with their Mkdir builders,</span>
        <span class="c1"># yet still allow them to be overridden by the user.  Since it&#39;s</span>
        <span class="c1"># not clear right now how to fix that, stick with what works</span>
        <span class="c1"># until it becomes clear...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_builder</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">5</span></div>

<div class="viewcode-block" id="File.scanner_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.scanner_key">[docs]</a>    <span class="k">def</span> <span class="nf">scanner_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_suffix</span><span class="p">()</span></div>

<div class="viewcode-block" id="File.get_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the contents of the file as bytes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_get_contents_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_get_contents</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.get_text_contents"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_text_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_text_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the contents of the file as text.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">())</span></div>

<div class="viewcode-block" id="File.get_content_hash"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_content_hash">[docs]</a>    <span class="k">def</span> <span class="nf">get_content_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute and return the hash for this file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rexists</span><span class="p">():</span>
            <span class="c1"># special marker to help distinguish from empty file</span>
            <span class="k">return</span> <span class="n">hash_signature</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">NOFILE</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">hash_file_signature</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">File</span><span class="o">.</span><span class="n">hash_chunksize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">cs</span></div>

<div class="viewcode-block" id="File.get_size"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_size">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_size&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rexists</span><span class="p">():</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span><span class="o">.</span><span class="n">getsize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># sentinel value for doesn&#39;t exist, even in repository</span>
            <span class="n">size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="File.get_timestamp"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_timestamp">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">get_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_timestamp&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rexists</span><span class="p">():</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span><span class="o">.</span><span class="n">getmtime</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="k">return</span> <span class="n">timestamp</span></div>

    <span class="n">convert_copy_attrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;bsources&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bimplicit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bdepends&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bact&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bactsig&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ninfo&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">convert_sig_attrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;bsourcesigs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bimplicitsigs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bdependsigs&#39;</span><span class="p">,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="File.convert_old_entry"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.convert_old_entry">[docs]</a>    <span class="k">def</span> <span class="nf">convert_old_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_entry</span><span class="p">):</span>
        <span class="c1"># Convert a .sconsign entry from before the Big Signature</span>
        <span class="c1"># Refactoring, doing what we can to convert its information</span>
        <span class="c1"># to the new .sconsign entry format.</span>
        <span class="c1">#</span>
        <span class="c1"># The old format looked essentially like this:</span>
        <span class="c1">#</span>
        <span class="c1">#   BuildInfo</span>
        <span class="c1">#       .ninfo (NodeInfo)</span>
        <span class="c1">#           .bsig</span>
        <span class="c1">#           .csig</span>
        <span class="c1">#           .timestamp</span>
        <span class="c1">#           .size</span>
        <span class="c1">#       .bsources</span>
        <span class="c1">#       .bsourcesigs (&quot;signature&quot; list)</span>
        <span class="c1">#       .bdepends</span>
        <span class="c1">#       .bdependsigs (&quot;signature&quot; list)</span>
        <span class="c1">#       .bimplicit</span>
        <span class="c1">#       .bimplicitsigs (&quot;signature&quot; list)</span>
        <span class="c1">#       .bact</span>
        <span class="c1">#       .bactsig</span>
        <span class="c1">#</span>
        <span class="c1"># The new format looks like this:</span>
        <span class="c1">#</span>
        <span class="c1">#   .ninfo (NodeInfo)</span>
        <span class="c1">#       .bsig</span>
        <span class="c1">#       .csig</span>
        <span class="c1">#       .timestamp</span>
        <span class="c1">#       .size</span>
        <span class="c1">#   .binfo (BuildInfo)</span>
        <span class="c1">#       .bsources</span>
        <span class="c1">#       .bsourcesigs (NodeInfo list)</span>
        <span class="c1">#           .bsig</span>
        <span class="c1">#           .csig</span>
        <span class="c1">#           .timestamp</span>
        <span class="c1">#           .size</span>
        <span class="c1">#       .bdepends</span>
        <span class="c1">#       .bdependsigs (NodeInfo list)</span>
        <span class="c1">#           .bsig</span>
        <span class="c1">#           .csig</span>
        <span class="c1">#           .timestamp</span>
        <span class="c1">#           .size</span>
        <span class="c1">#       .bimplicit</span>
        <span class="c1">#       .bimplicitsigs (NodeInfo list)</span>
        <span class="c1">#           .bsig</span>
        <span class="c1">#           .csig</span>
        <span class="c1">#           .timestamp</span>
        <span class="c1">#           .size</span>
        <span class="c1">#       .bact</span>
        <span class="c1">#       .bactsig</span>
        <span class="c1">#</span>
        <span class="c1"># The basic idea of the new structure is that a NodeInfo always</span>
        <span class="c1"># holds all available information about the state of a given Node</span>
        <span class="c1"># at a certain point in time.  The various .b*sigs lists can just</span>
        <span class="c1"># be a list of pointers to the .ninfo attributes of the different</span>
        <span class="c1"># dependent nodes, without any copying of information until it&#39;s</span>
        <span class="c1"># time to pickle it for writing out to a .sconsign file.</span>
        <span class="c1">#</span>
        <span class="c1"># The complicating issue is that the *old* format only stored one</span>
        <span class="c1"># &quot;signature&quot; per dependency, based on however the *last* build</span>
        <span class="c1"># was configured.  We don&#39;t know from just looking at it whether</span>
        <span class="c1"># it was a build signature, a content signature, or a timestamp</span>
        <span class="c1"># &quot;signature&quot;.  Since we no longer use build signatures, the</span>
        <span class="c1"># best we can do is look at the length and if it&#39;s thirty two,</span>
        <span class="c1"># assume that it was (or might have been) a content signature.</span>
        <span class="c1"># If it was actually a build signature, then it will cause a</span>
        <span class="c1"># rebuild anyway when it doesn&#39;t match the new content signature,</span>
        <span class="c1"># but that&#39;s probably the best we can do.</span>
        <span class="kn">import</span> <span class="nn">SCons.SConsign</span>
        <span class="n">new_entry</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">SConsign</span><span class="o">.</span><span class="n">SConsignEntry</span><span class="p">()</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">binfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_binfo</span><span class="p">()</span>
        <span class="n">binfo</span> <span class="o">=</span> <span class="n">new_entry</span><span class="o">.</span><span class="n">binfo</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_copy_attrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_entry</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">binfo</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">old_entry</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_sig_attrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sig_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_entry</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">sig_list</span><span class="p">:</span>
                <span class="n">ninfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_ninfo</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
                    <span class="n">ninfo</span><span class="o">.</span><span class="n">csig</span> <span class="o">=</span> <span class="n">sig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ninfo</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">sig</span>
                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ninfo</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">binfo</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">old_entry</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_entry</span></div>

<div class="viewcode-block" id="File.get_stored_info"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_stored_info">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">get_stored_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_stored_info&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sconsign_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">sconsign</span><span class="p">()</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">SCons.SConsign</span>
            <span class="n">sconsign_entry</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">SConsign</span><span class="o">.</span><span class="n">SConsignEntry</span><span class="p">()</span>
            <span class="n">sconsign_entry</span><span class="o">.</span><span class="n">binfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_binfo</span><span class="p">()</span>
            <span class="n">sconsign_entry</span><span class="o">.</span><span class="n">ninfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_ninfo</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sconsign_entry</span><span class="p">,</span> <span class="n">FileBuildInfo</span><span class="p">):</span>
                <span class="c1"># This is a .sconsign file from before the Big Signature</span>
                <span class="c1"># Refactoring; convert it as best we can.</span>
                <span class="n">sconsign_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_old_entry</span><span class="p">(</span><span class="n">sconsign_entry</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">sconsign_entry</span><span class="o">.</span><span class="n">ninfo</span><span class="p">,</span> <span class="s1">&#39;bsig&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_stored_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sconsign_entry</span>

        <span class="k">return</span> <span class="n">sconsign_entry</span></div>

<div class="viewcode-block" id="File.get_stored_implicit"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_stored_implicit">[docs]</a>    <span class="k">def</span> <span class="nf">get_stored_implicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">binfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stored_info</span><span class="p">()</span><span class="o">.</span><span class="n">binfo</span>
        <span class="n">binfo</span><span class="o">.</span><span class="n">prepare_dependencies</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">binfo</span><span class="o">.</span><span class="n">bimplicit</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="File.rel_path"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.rel_path">[docs]</a>    <span class="k">def</span> <span class="nf">rel_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">rel_path</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="File._get_found_includes_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._get_found_includes_key">[docs]</a>    <span class="k">def</span> <span class="nf">_get_found_includes_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">scanner</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">env</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">scanner</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.get_found_includes"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_found_includes">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountDictCall</span><span class="p">(</span><span class="n">_get_found_includes_key</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_found_includes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">scanner</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the included implicit dependencies in this file.</span>
<span class="sd">        Cache results so we only scan the file once per path</span>
<span class="sd">        regardless of how many times this information is requested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">memo_key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">env</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">scanner</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_found_includes&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;get_found_includes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">memo_dict</span><span class="p">[</span><span class="n">memo_key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">scanner</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">path</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">memo_dict</span><span class="p">[</span><span class="n">memo_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="File._createDir"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._createDir">[docs]</a>    <span class="k">def</span> <span class="nf">_createDir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># ensure that the directories for this node are</span>
        <span class="c1"># created.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_create</span><span class="p">()</span></div>

<div class="viewcode-block" id="File.push_to_cache"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.push_to_cache">[docs]</a>    <span class="k">def</span> <span class="nf">push_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to push the node into a cache</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This should get called before the Nodes&#39; .built() method is</span>
        <span class="c1"># called, which would clear the build signature if the file has</span>
        <span class="c1"># a source scanner.</span>
        <span class="c1">#</span>
        <span class="c1"># We have to clear the local memoized values *before* we push</span>
        <span class="c1"># the node to cache so that the memoization of the self.exists()</span>
        <span class="c1"># return value doesn&#39;t interfere.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nocache</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_memoized_values</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span><span class="o">.</span><span class="n">get_CacheDir</span><span class="p">()</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.retrieve_from_cache"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.retrieve_from_cache">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to retrieve the node&#39;s content from a cache</span>

<span class="sd">        This method is called from multiple threads in a parallel build,</span>
<span class="sd">        so only do thread safe stuff here. Do thread unsafe stuff in</span>
<span class="sd">        built().</span>

<span class="sd">        Returns True if the node was successfully retrieved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nocache</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span><span class="o">.</span><span class="n">get_CacheDir</span><span class="p">()</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.visited"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.visited">[docs]</a>    <span class="k">def</span> <span class="nf">visited</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span><span class="o">.</span><span class="n">get_CacheDir</span><span class="p">()</span><span class="o">.</span><span class="n">push_if_forced</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">ninfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ninfo</span><span class="p">()</span>

        <span class="n">csig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_drift_csig</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">csig</span><span class="p">:</span>
            <span class="n">ninfo</span><span class="o">.</span><span class="n">csig</span> <span class="o">=</span> <span class="n">csig</span>

        <span class="n">ninfo</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span>
        <span class="n">ninfo</span><span class="o">.</span><span class="n">size</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_builder</span><span class="p">():</span>
            <span class="c1"># This is a source file, but it might have been a target file</span>
            <span class="c1"># in another build that included more of the DAG.  Copy</span>
            <span class="c1"># any build information that&#39;s stored in the .sconsign file</span>
            <span class="c1"># into our binfo object so it doesn&#39;t get lost.</span>
            <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stored_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_binfo</span><span class="p">()</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">binfo</span><span class="p">)</span>

        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">store_info_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">store_info</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.release_target_info"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.release_target_info">[docs]</a>    <span class="k">def</span> <span class="nf">release_target_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called just after this node has been marked</span>
<span class="sd">         up-to-date or was built completely.</span>

<span class="sd">         This is where we try to release as many target node infos</span>
<span class="sd">         as possible for clean builds and update runs, in order</span>
<span class="sd">         to minimize the overall memory consumption.</span>

<span class="sd">         We&#39;d like to remove a lot more attributes like self.sources</span>
<span class="sd">         and self.sources_set, but they might get used</span>
<span class="sd">         in a next build step. For example, during configuration</span>
<span class="sd">         the source files for a built E{*}.o file are used to figure out</span>
<span class="sd">         which linker to use for the resulting Program (gcc vs. g++)!</span>
<span class="sd">         That&#39;s why we check for the &#39;keep_targetinfo&#39; attribute,</span>
<span class="sd">         config Nodes and the Interactive mode just don&#39;t allow</span>
<span class="sd">         an early release of most variables.</span>

<span class="sd">         In the same manner, we can&#39;t simply remove the self.attributes</span>
<span class="sd">         here. The smart linking relies on the shared flag, and some</span>
<span class="sd">         parts of the java Tool use it to transport information</span>
<span class="sd">         about nodes...</span>

<span class="sd">         @see: built() and Node.release_target_info()</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">released_target_info</span> <span class="ow">or</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="s1">&#39;keep_targetinfo&#39;</span><span class="p">):</span>
            <span class="c1"># Cache some required values, before releasing</span>
            <span class="c1"># stuff like env, executor and builder...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="n">allowcache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_contents_sig</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span>
            <span class="c1"># Now purge unneeded stuff to free memory...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Cleanup lists, but only if they&#39;re empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_set</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ignore_set</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">implicit_set</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">implicit_set</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depends_set</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depends_set</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depends</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depends</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Mark this node as done, we only have to release</span>
            <span class="c1"># the memory once...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">released_target_info</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="File.find_src_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.find_src_builder">[docs]</a>    <span class="k">def</span> <span class="nf">find_src_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rexists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">scb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">src_builder</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scb</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">scb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">scb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">builder</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">builder_set</span><span class="p">(</span><span class="n">scb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scb</span></div>

<div class="viewcode-block" id="File.has_src_builder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.has_src_builder">[docs]</a>    <span class="k">def</span> <span class="nf">has_src_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether this Node has a source builder or not.</span>

<span class="sd">        If this Node doesn&#39;t have an explicit source code builder, this</span>
<span class="sd">        is where we figure out, on the fly, if there&#39;s a transparent</span>
<span class="sd">        source code builder for it.</span>

<span class="sd">        Note that if we found a source builder, we also set the</span>
<span class="sd">        self.builder attribute, so that all of the methods that actually</span>
<span class="sd">        *build* this file don&#39;t have to do anything different.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbuilder</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">scb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbuilder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_src_builder</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">scb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="File.alter_targets"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.alter_targets">[docs]</a>    <span class="k">def</span> <span class="nf">alter_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return any corresponding targets in a variant directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">variant_dir_target_climb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span></div>

<div class="viewcode-block" id="File._rmv_existing"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._rmv_existing">[docs]</a>    <span class="k">def</span> <span class="nf">_rmv_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_memoized_values</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">print_duplicate</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dup: removing existing target </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">e</span></div>

    <span class="c1">#</span>
    <span class="c1"># Taskmaster interface subsystem</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="File.make_ready"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.make_ready">[docs]</a>    <span class="k">def</span> <span class="nf">make_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_src_builder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_binfo</span><span class="p">()</span></div>

<div class="viewcode-block" id="File.prepare"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare for this file to be created.&quot;&quot;&quot;</span>
        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">!=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">up_to_date</span><span class="p">:</span>
            <span class="c1"># Exists will report False for dangling symlinks so if it</span>
            <span class="c1"># exists or is a link (which would mean it&#39;s a dangling</span>
            <span class="c1"># link) then we should remove it as appropriate.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">islink</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">precious</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rmv_existing</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_createDir</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">StopError</span> <span class="k">as</span> <span class="n">drive</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">StopError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No drive `</span><span class="si">{</span><span class="n">drive</span><span class="si">}</span><span class="s2">&#39; for target `</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></div>

    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="File.remove"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove this file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">islink</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">())</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="File.do_duplicate"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.do_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">do_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a duplicate of this file from the specified source.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createDir</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">print_duplicate</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dup: relinking variant &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; from &#39;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">Unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">StopError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot duplicate `</span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; in `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">errstr</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linked</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># The Link() action may or may not have actually</span>
        <span class="c1"># created the file, depending on whether the -n</span>
        <span class="c1"># option was used or not.  Delete the _exists and</span>
        <span class="c1"># _rexists attributes so they can be reevaluated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="File.exists"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.exists">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;exists&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">_exists_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_func_exists</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;exists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="c1">#</span>
    <span class="c1"># SIGNATURE SUBSYSTEM</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="File.get_max_drift_csig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_max_drift_csig">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_drift_csig</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the content signature currently stored for this node</span>
<span class="sd">        if it&#39;s been unmodified longer than the max_drift value, or the</span>
<span class="sd">        max_drift value is 0.  Returns None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stored_info</span><span class="p">()</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span>

        <span class="n">max_drift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">max_drift</span>
        <span class="k">if</span> <span class="n">max_drift</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">mtime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_drift</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">ninfo</span>
                    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">timestamp</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">csig</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">==</span> <span class="n">mtime</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">csig</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">max_drift</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">old</span><span class="o">.</span><span class="n">ninfo</span><span class="o">.</span><span class="n">csig</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="File.get_csig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_csig">[docs]</a>    <span class="k">def</span> <span class="nf">get_csig</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a node&#39;s content signature.&quot;&quot;&quot;</span>
        <span class="n">ninfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ninfo</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ninfo</span><span class="o">.</span><span class="n">csig</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">csig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_max_drift_csig</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">csig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">NOFILE</span>
                <span class="k">elif</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="n">File</span><span class="o">.</span><span class="n">hash_chunksize</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contents</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">csig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_hash</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># This can happen if there&#39;s actually a directory on-disk,</span>
                <span class="c1"># which can be the case if they&#39;ve disabled disk checks,</span>
                <span class="c1"># or if an action with a File target actually happens to</span>
                <span class="c1"># create a same-named directory by mistake.</span>
                <span class="n">csig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">csig</span><span class="p">:</span>
                    <span class="n">csig</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">hash_signature</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">ninfo</span><span class="o">.</span><span class="n">csig</span> <span class="o">=</span> <span class="n">csig</span>

        <span class="k">return</span> <span class="n">csig</span></div>

    <span class="c1">#</span>
    <span class="c1"># DECISION SUBSYSTEM</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="File.builder_set"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.builder_set">[docs]</a>    <span class="k">def</span> <span class="nf">builder_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">builder_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_since_last_build</span> <span class="o">=</span> <span class="mi">5</span></div>

<div class="viewcode-block" id="File.built"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.built">[docs]</a>    <span class="k">def</span> <span class="nf">built</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called just after this File node is successfully built.</span>

<span class="sd">         Just like for &#39;release_target_info&#39; we try to release</span>
<span class="sd">         some more target node attributes in order to minimize the</span>
<span class="sd">         overall memory consumption.</span>

<span class="sd">         @see: release_target_info</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">built</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">interactive</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="s1">&#39;keep_targetinfo&#39;</span><span class="p">)):</span>
            <span class="c1"># Ensure that the build infos get computed and cached...</span>
            <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">store_info_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">store_info</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># ... then release some more variables.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_specific_sources</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labspath</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_str</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scanner_paths</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="File.changed"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed">[docs]</a>    <span class="k">def</span> <span class="nf">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowcache</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if the node is up-to-date with respect to the BuildInfo</span>
<span class="sd">        stored last time it was built.</span>

<span class="sd">        For File nodes this is basically a wrapper around Node.changed(),</span>
<span class="sd">        but we allow the return value to get cached after the reference</span>
<span class="sd">        to the Executor got released in release_target_info().</span>

<span class="sd">        @see: Node.changed()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">has_changed</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">allowcache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;changed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_changed</span>
        <span class="k">return</span> <span class="n">has_changed</span></div>

<div class="viewcode-block" id="File.changed_content"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed_content">[docs]</a>    <span class="k">def</span> <span class="nf">changed_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">cur_csig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_csig</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cur_csig</span> <span class="o">!=</span> <span class="n">prev_ni</span><span class="o">.</span><span class="n">csig</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="File.changed_state"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed_state">[docs]</a>    <span class="k">def</span> <span class="nf">changed_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">up_to_date</span></div>


    <span class="c1"># Caching node -&gt; string mapping for the below method</span>
    <span class="n">__dmap_cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">__dmap_sig_cache</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="File._build_dependency_map"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._build_dependency_map">[docs]</a>    <span class="k">def</span> <span class="nf">_build_dependency_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build mapping from file -&gt; signature</span>

<span class="sd">        Args:</span>
<span class="sd">            self - self</span>
<span class="sd">            binfo - buildinfo from node being considered</span>

<span class="sd">        Returns:</span>
<span class="sd">            dictionary of file-&gt;signature mappings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># For an &quot;empty&quot; binfo properties like bsources</span>
        <span class="c1"># do not exist: check this to avoid exception.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">bsourcesigs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">bdependsigs</span><span class="p">)</span> <span class="o">+</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">bimplicitsigs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">binfo</span><span class="o">.</span><span class="n">dependency_map</span> <span class="o">=</span> <span class="p">{</span> <span class="n">child</span><span class="p">:</span><span class="n">signature</span> <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">signature</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">bsources</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">bdepends</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">bimplicit</span><span class="p">),</span>
                                     <span class="n">chain</span><span class="p">(</span><span class="n">binfo</span><span class="o">.</span><span class="n">bsourcesigs</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">bdependsigs</span><span class="p">,</span> <span class="n">binfo</span><span class="o">.</span><span class="n">bimplicitsigs</span><span class="p">))}</span>

        <span class="k">return</span> <span class="n">binfo</span><span class="o">.</span><span class="n">dependency_map</span></div>

    <span class="c1"># @profile</span>
<div class="viewcode-block" id="File._add_strings_to_dependency_map"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._add_strings_to_dependency_map">[docs]</a>    <span class="k">def</span> <span class="nf">_add_strings_to_dependency_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In the case comparing node objects isn&#39;t sufficient, we&#39;ll add the strings for the nodes to the dependency map</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">first_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dmap</span><span class="p">)))</span>

        <span class="c1"># print(&quot;DMAP:%s&quot;%id(dmap))</span>
        <span class="k">if</span> <span class="n">first_string</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dmap</span><span class="p">:</span>
                <span class="n">string_dict</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="p">):</span> <span class="n">signature</span> <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">signature</span> <span class="ow">in</span> <span class="n">dmap</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">dmap</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">string_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dmap</span></div>

<div class="viewcode-block" id="File._get_previous_signatures"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File._get_previous_signatures">[docs]</a>    <span class="k">def</span> <span class="nf">_get_previous_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of corresponding csigs from previous</span>
<span class="sd">        build in order of the node/files in children.</span>

<span class="sd">        Args:</span>
<span class="sd">            self - self</span>
<span class="sd">            dmap - Dictionary of file -&gt; csig</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of csigs for provided list of children</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># MD5_TIMESTAMP_DEBUG = False</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing dmap shortcutting&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;len(dmap):</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">dmap</span><span class="p">))</span>


        <span class="c1"># First try retrieving via Node</span>
        <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if self is in  map:</span><span class="si">%s</span><span class="s2"> id:</span><span class="si">%s</span><span class="s2"> type:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="c1"># Now check if self&#39;s repository file is in map.</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if self.rfile  is in  map:</span><span class="si">%s</span><span class="s2"> id:</span><span class="si">%s</span><span class="s2"> type:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rf</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">rf</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">rf</span><span class="p">)))</span>
        <span class="n">rfm</span> <span class="o">=</span> <span class="n">dmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rfm</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rfm</span>

        <span class="c1"># get default string for node and then also string swapping os.altsep for os.sep (/ for \)</span>
        <span class="n">c_strs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span><span class="p">:</span>
            <span class="n">c_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_strs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span><span class="p">))</span>

        <span class="c1"># In some cases the dependency_maps&#39; keys are already strings check.</span>
        <span class="c1"># Check if either string is now in dmap.</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c_strs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if str(self) is in map  :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">dmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df</span>

        <span class="c1"># Strings don&#39;t exist in map, add them and try again</span>
        <span class="c1"># If there are no strings in this dmap, then add them.</span>
        <span class="c1"># This may not be necessary, we could walk the nodes in the dmap and check each string</span>
        <span class="c1"># rather than adding ALL the strings to dmap. In theory that would be n/2 vs 2n str() calls on node</span>
        <span class="c1"># if not dmap.has_strings:</span>
        <span class="n">dmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_strings_to_dependency_map</span><span class="p">(</span><span class="n">dmap</span><span class="p">)</span>

        <span class="c1"># In some cases the dependency_maps&#39; keys are already strings check.</span>
        <span class="c1"># Check if either string is now in dmap.</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c_strs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if str(self) is in map (now with strings)  :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">dmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df</span>

        <span class="c1"># Lastly use nodes get_path() to generate string and see if that&#39;s in dmap</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># this should yield a path which matches what&#39;s in the sconsign</span>
                <span class="n">c_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span><span class="p">:</span>
                    <span class="n">c_str</span> <span class="o">=</span> <span class="n">c_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking if self.get_path is in map (now with strings)  :</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>

                <span class="n">df</span> <span class="o">=</span> <span class="n">dmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c_str</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileBuildInfoFileToCsigMappingError</span><span class="p">(</span><span class="s2">&quot;No mapping from file name to content signature for :</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">c_str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="File.changed_timestamp_then_content"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed_timestamp_then_content">[docs]</a>    <span class="k">def</span> <span class="nf">changed_timestamp_then_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used when decider for file is Timestamp-MD5</span>

<span class="sd">        NOTE: If the timestamp hasn&#39;t changed this will skip md5&#39;ing the</span>
<span class="sd">              file and just copy the prev_ni provided.  If the prev_ni</span>
<span class="sd">              is wrong. It will propagate it.</span>
<span class="sd">              See: https://github.com/SCons/scons/issues/2980</span>

<span class="sd">        Args:</span>
<span class="sd">            self - dependency</span>
<span class="sd">            target - target</span>
<span class="sd">            prev_ni - The NodeInfo object loaded from previous builds .sconsign</span>
<span class="sd">            node - Node instance.  Check this node for file existence/timestamp</span>
<span class="sd">                   if specified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean - Indicates if node(File) has changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># Now get sconsign name -&gt; csig map and then get proper prev_ni if possible</span>
        <span class="n">bi</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_stored_info</span><span class="p">()</span><span class="o">.</span><span class="n">binfo</span>
        <span class="n">rebuilt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dependency_map</span> <span class="o">=</span> <span class="n">bi</span><span class="o">.</span><span class="n">dependency_map</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">dependency_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dependency_map</span><span class="p">(</span><span class="n">bi</span><span class="p">)</span>
            <span class="n">rebuilt</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dependency_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># If there&#39;s no dependency map, there&#39;s no need to find the</span>
            <span class="c1"># prev_ni as there aren&#39;t any</span>
            <span class="c1"># shortcut the rest of the logic</span>
            <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping checks len(dmap)=0&quot;</span><span class="p">)</span>

            <span class="c1"># We still need to get the current file&#39;s csig</span>
            <span class="c1"># This should be slightly faster than calling self.changed_content(target, new_prev_ni)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_csig</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">new_prev_ni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_signatures</span><span class="p">(</span><span class="n">dependency_map</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed_timestamp_match</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new_prev_ni</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">MD5_TIMESTAMP_DEBUG</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed_timestamp_match</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">old</span> <span class="o">!=</span> <span class="n">new</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mismatch self.changed_timestamp_match(</span><span class="si">%s</span><span class="s2">, prev_ni) old:</span><span class="si">%s</span><span class="s2"> new:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">))</span>
                <span class="n">new_prev_ni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_signatures</span><span class="p">(</span><span class="n">dependency_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># NOTE: We&#39;re modifying the current node&#39;s csig in a query.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_ninfo</span><span class="p">()</span><span class="o">.</span><span class="n">csig</span> <span class="o">=</span> <span class="n">new_prev_ni</span><span class="o">.</span><span class="n">csig</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed_content</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">new_prev_ni</span><span class="p">)</span></div>

<div class="viewcode-block" id="File.changed_timestamp_newer"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed_timestamp_newer">[docs]</a>    <span class="k">def</span> <span class="nf">changed_timestamp_newer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">target</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="File.changed_timestamp_match"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.changed_timestamp_match">[docs]</a>    <span class="k">def</span> <span class="nf">changed_timestamp_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the timestamps don&#39;t match or if there is no previous timestamp</span>
<span class="sd">        :param target:</span>
<span class="sd">        :param prev_ni: Information about the node from the previous build</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timestamp</span><span class="p">()</span> <span class="o">!=</span> <span class="n">prev_ni</span><span class="o">.</span><span class="n">timestamp</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="File.is_up_to_date"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.is_up_to_date">[docs]</a>    <span class="k">def</span> <span class="nf">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for whether the Node is current.</span>

<span class="sd">        In all cases self is the target we&#39;re checking to see if it&#39;s up to date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;is_up_to_date(</span><span class="si">%s</span><span class="s1">):&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39; not self.exists():&#39;</span><span class="p">)</span>
            <span class="c1"># The file (always a target) doesn&#39;t exist locally...</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># ...but there is one (always a target) in a Repository...</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39; changed(</span><span class="si">%s</span><span class="s1">):&#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
                    <span class="c1"># ...and it&#39;s even up-to-date...</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local</span><span class="p">:</span>
                        <span class="c1"># ...and they&#39;d like a local copy.</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">LocalCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span><span class="p">):</span>
                            <span class="c1"># Likely this should be re-raising exception e</span>
                            <span class="c1"># (which would be BuildError)</span>
                            <span class="k">raise</span> <span class="n">e</span>
                        <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">store_info_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">store_info</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39; 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39; None</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">changed</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">T</span><span class="p">:</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39; self.exists():  </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">r</span></div>

<div class="viewcode-block" id="File.rfile"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.rfile">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">rfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rfile&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">repo_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">repo_dir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">repo_dir</span><span class="o">.</span><span class="n">file_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">File</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Entry</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_derived</span><span class="p">()):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">node</span>
                        <span class="c1"># Copy over our local attributes to the repository</span>
                        <span class="c1"># Node so we identify shared object files in the</span>
                        <span class="c1"># repository and don&#39;t assume they&#39;re static.</span>
                        <span class="c1">#</span>
                        <span class="c1"># This isn&#39;t perfect; the attribute would ideally</span>
                        <span class="c1"># be attached to the object in the repository in</span>
                        <span class="c1"># case it was built statically in the repository</span>
                        <span class="c1"># and we changed it to shared locally, but that&#39;s</span>
                        <span class="c1"># rarely the case and would only occur if you</span>
                        <span class="c1"># intentionally used the same suffix for both</span>
                        <span class="c1"># shared and static objects anyway.  So this</span>
                        <span class="c1"># should work well in practice.</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span>
                        <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;rfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="File.find_repo_file"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.find_repo_file">[docs]</a>    <span class="k">def</span> <span class="nf">find_repo_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For this node, find if there exists a corresponding file in one or more repositories</span>
<span class="sd">        :return: list of corresponding files in repositories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retvals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">repo_dir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">get_all_rdirs</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">repo_dir</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">repo_dir</span><span class="o">.</span><span class="n">file_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">File</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Entry</span><span class="p">)</span>
                     <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_derived</span><span class="p">()):</span>
                <span class="n">retvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">retvals</span></div>


<div class="viewcode-block" id="File.rstr"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.rstr">[docs]</a>    <span class="k">def</span> <span class="nf">rstr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">())</span></div>

<div class="viewcode-block" id="File.get_cachedir_csig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_cachedir_csig">[docs]</a>    <span class="k">def</span> <span class="nf">get_cachedir_csig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a Node&#39;s content signature for purposes of computing</span>
<span class="sd">        another Node&#39;s cachesig.</span>

<span class="sd">        This is a wrapper around the normal get_csig() method that handles</span>
<span class="sd">        the somewhat obscure case of using CacheDir with the -n option.</span>
<span class="sd">        Any files that don&#39;t exist would normally be &quot;built&quot; by fetching</span>
<span class="sd">        them from the cache, but the normal get_csig() method will try</span>
<span class="sd">        to open up the local file, which doesn&#39;t exist because the -n</span>
<span class="sd">        option meant we didn&#39;t actually pull the file from cachedir.</span>
<span class="sd">        But since the file *does* actually exist in the cachedir, we</span>
<span class="sd">        can use its contents for the csig.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachedir_csig</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span><span class="o">.</span><span class="n">get_CacheDir</span><span class="p">()</span>
        <span class="n">cachedir</span><span class="p">,</span> <span class="n">cachefile</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">cachepath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">cachefile</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cachefile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cachedir_csig</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_cachedir_csig</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cachedir_csig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_csig</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachedir_csig</span></div>

<div class="viewcode-block" id="File.get_contents_sig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_contents_sig">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents_sig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper method for get_cachedir_bsig.</span>

<span class="sd">        It computes and returns the signature for this</span>
<span class="sd">        node&#39;s contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsig</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsig</span> <span class="o">=</span> <span class="n">hash_signature</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">get_contents</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="File.get_cachedir_bsig"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.File.get_cachedir_bsig">[docs]</a>    <span class="k">def</span> <span class="nf">get_cachedir_bsig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the signature for a cached file, including</span>
<span class="sd">        its children.</span>

<span class="sd">        It adds the path of the cached file to the cache signature,</span>
<span class="sd">        because multiple targets built by the same action will all</span>
<span class="sd">        have the same build signature, and we have to differentiate</span>
<span class="sd">        them somehow.</span>

<span class="sd">        Signature should normally be string of hex digits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachesig</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Collect signatures for all children</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">()</span>
        <span class="n">sigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_cachedir_csig</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>

        <span class="c1"># Append this node&#39;s signature...</span>
        <span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_contents_sig</span><span class="p">())</span>

        <span class="c1"># ...and it&#39;s path</span>
        <span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_internal_path</span><span class="p">())</span>

        <span class="c1"># Merge this all into a single signature</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cachesig</span> <span class="o">=</span> <span class="n">hash_collect</span><span class="p">(</span><span class="n">sigs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>

<span class="n">default_fs</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="get_default_fs"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.get_default_fs">[docs]</a><span class="k">def</span> <span class="nf">get_default_fs</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">default_fs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">default_fs</span><span class="p">:</span>
        <span class="n">default_fs</span> <span class="o">=</span> <span class="n">FS</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">default_fs</span></div>

<div class="viewcode-block" id="FileFinder"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileFinder">[docs]</a><span class="k">class</span> <span class="nc">FileFinder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="FileFinder.filedir_lookup"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileFinder.filedir_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">filedir_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A helper method for find_file() that looks up a directory for</span>
<span class="sd">        a file we&#39;re trying to find.  This only creates the Dir Node if</span>
<span class="sd">        it exists on-disk, since if the directory doesn&#39;t exist we know</span>
<span class="sd">        we won&#39;t find any files in it...  :-)</span>

<span class="sd">        It would be more compact to just use this as a nested function</span>
<span class="sd">        with a default keyword argument (see the commented-out version</span>
<span class="sd">        below), but that doesn&#39;t work unless you have nested scopes,</span>
<span class="sd">        so we define it here just so this work under Python 1.5.2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_filedir</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_splitdrive</span><span class="p">:</span>
            <span class="n">drive</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">_my_splitdrive</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drive</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">dir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">d</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">OS_SEP</span><span class="p">):</span>
            <span class="c1">#return p.fs.get_root(drive).dir_on_disk(name)</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">get_root</span><span class="p">(</span><span class="n">drive</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">dir</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filedir_lookup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">norm_name</span> <span class="o">=</span> <span class="n">_my_normcase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">entries</span><span class="p">[</span><span class="n">norm_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">dir_on_disk</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Dir</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Entry</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">must_be_same</span><span class="p">(</span><span class="n">Dir</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FileFinder._find_file_key"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileFinder._find_file_key">[docs]</a>    <span class="k">def</span> <span class="nf">_find_file_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Note: paths could be a list, which is not hashable. If it is, convert</span>
        <span class="c1"># it to a tuple, which is hashable.</span>
        <span class="n">paths_entry</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">paths</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">paths_entry</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileFinder.find_file"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.FileFinder.find_file">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountDictCall</span><span class="p">(</span><span class="n">_find_file_key</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">find_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a node corresponding to either a derived file or a file that exists already.</span>

<span class="sd">        Only the first file found is returned, and none is returned if no file is found.</span>

<span class="sd">        filename: A filename to find</span>
<span class="sd">        paths: A list of directory path *nodes* to search in.  Can be represented as a list, a tuple, or a callable that is called with no arguments and returns the list or tuple.</span>

<span class="sd">        returns The node created from the found file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">memo_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_file_key</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;find_file&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">memo_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;find_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memo_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">memo_dict</span><span class="p">[</span><span class="n">memo_key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
                <span class="n">verbose</span> <span class="o">=</span> <span class="s2">&quot;find_file&quot;</span>
            <span class="n">_verbose</span> <span class="o">=</span> <span class="s1">&#39;  </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="n">verbose</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_verbose</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>

        <span class="n">filedir</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filedir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_filedir</span> <span class="o">=</span> <span class="n">filedir</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filedir_lookup</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span> <span class="k">if</span> <span class="n">_f</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;looking for &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39; ...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">dir</span><span class="p">))</span>
            <span class="n">node</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">dir</span><span class="o">.</span><span class="n">srcdir_find_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;... FOUND &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">node</span>
                <span class="k">break</span>

        <span class="n">memo_dict</span><span class="p">[</span><span class="n">memo_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div></div>

<span class="n">find_file</span> <span class="o">=</span> <span class="n">FileFinder</span><span class="p">()</span><span class="o">.</span><span class="n">find_file</span>


<div class="viewcode-block" id="invalidate_node_memos"><a class="viewcode-back" href="../../../../SCons.Node/#SCons.Node.FS.invalidate_node_memos">[docs]</a><span class="k">def</span> <span class="nf">invalidate_node_memos</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invalidate the memoized values of all Nodes (files or directories)</span>
<span class="sd">    that are associated with the given entries. Has been added to</span>
<span class="sd">    clear the cache of nodes affected by a direct execution of an</span>
<span class="sd">    action (e.g.  Delete/Copy/Chmod). Existing Node caches become</span>
<span class="sd">    inconsistent if the action is run through Execute().  The argument</span>
<span class="sd">    `targets` can be a single Node object or filename, or a sequence</span>
<span class="sd">    of Nodes/filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">extract_stack</span>

    <span class="c1"># First check if the cache really needs to be flushed. Only</span>
    <span class="c1"># actions run in the SConscript with Execute() seem to be</span>
    <span class="c1"># affected. XXX The way to check if Execute() is in the stacktrace</span>
    <span class="c1"># is a very dirty hack and should be replaced by a more sensible</span>
    <span class="c1"># solution.</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extract_stack</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Execute&#39;</span> <span class="ow">and</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">14</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;Environment.py&#39;</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Dont have to invalidate, so return</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">targets</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
        <span class="c1"># If the target is a Node object, clear the cache. If it is a</span>
        <span class="c1"># filename, look up potentially existing Node object first.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">clear_memoized_values</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># Not a Node object, try to look up Node by filename.  XXX</span>
            <span class="c1"># This creates Node objects even for those filenames which</span>
            <span class="c1"># do not correspond to an existing Node object.</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">get_default_fs</span><span class="p">()</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">clear_memoized_values</span><span class="p">()</span></div>

<span class="c1"># Local Variables:</span>
<span class="c1"># tab-width:4</span>
<span class="c1"># indent-tabs-mode:nil</span>
<span class="c1"># End:</span>
<span class="c1"># vim: set expandtab tabstop=4 shiftwidth=4:</span>
</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SCons Project Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2022, SCons Project.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>