<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 24. Caching Built Files</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 4.0.0"><link rel="up" href="index.html" title="SCons 4.0.0"><link rel="prev" href="ch23s09.html" title="23.9. Not Configuring When Cleaning Targets"><link rel="next" href="ch24s02.html" title="24.2. Keeping Build Output Consistent"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 24. Caching Built Files</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch23s09.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch24s02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 24. Caching Built Files"><div class="titlepage"><div><div><h2 class="title"><a name="chap-caching"></a>Chapter 24. Caching Built Files</h2></div></div></div><p>

  On multi-developer software projects,
  you can sometimes speed up every developer's builds a lot by
  allowing them to share the derived files that they build.
  After all, it is relatively rare that any in-progress change affects
  more than a few derived files, most will be unchanged.
  <span class="application">SCons</span> makes this easy and reliable.

  </p><div class="section" title="24.1. Specifying the Shared Cache Directory"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp140522969716840"></a>24.1. Specifying the Shared Cache Directory</h2></div></div></div><p>

    To enable sharing of derived files,
    use the <a class="link" href="apd.html#f-CacheDir"><code class="function">CacheDir</code></a> function
    in any <code class="filename">SConscript</code> file:

    </p><pre class="programlisting">
CacheDir('/usr/local/build_cache')
       </pre><p>

    The cache directory you specify must
    be readable and writable by all developers
    who will be sharing derived files.
    It should also be in some central location
    that all builds will be able to access.
    In environments where developers are using separate systems
    (like individual workstations) for builds,
    this directory would typically be
    on a shared or NFS-mounted file system.
    While <span class="application">SCons</span> will create the specified cache directory as needed,
    in this multi user scenario it is usually best
    to create it ahead of time so the access rights
    can be set up correctly.

    </p><p>

    Here's what happens:
    When a build has a <code class="function">CacheDir</code> specified,
    every time a file is built,
    it is stored in that cache directory
    along with its build signature.
    On subsequent builds,
    before an action is invoked to build a file,
    <span class="application">SCons</span> will check the shared cache directory
    to see if a file with the exact same build
    signature already exists.
      <sup>[<a name="idp140522969722344" href="#ftn.idp140522969722344" class="footnote">4</a>]</sup>
    If so, the derived file will not be built locally,
    but will be copied into the local build directory
    from the shared cache directory,
    like this:

    </p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
cc -o hello.o -c hello.c
cc -o hello hello.o
% <strong class="userinput"><code>scons -Q -c</code></strong>
Removed hello.o
Removed hello
% <strong class="userinput"><code>scons -Q</code></strong>
Retrieved `hello.o' from cache
Retrieved `hello' from cache
</pre><p>

    Note that the <code class="function">CacheDir</code> feature requires that build signatures
    be calculated,
    even if you configure <span class="application">SCons</span> to use timestamps
    to decide if files are up to date
    (see the <a class="xref" href="ch06.html" title="Chapter 6. Dependencies">Chapter 6, <i>Dependencies</i></a>
    chapter for information about the <a class="link" href="apd.html#f-Decider"><code class="function">Decider</code></a> function),
    since the build signature is used to determine if a target file
    exists in the cache.
    Consequently, using <code class="function">CacheDir</code> may reduce or eliminate any
    potential performance improvements
    from using timestamps for up-to-date decisions.

    </p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.idp140522969722344" href="#idp140522969722344" class="para">4</a>] </sup>
      A few inner details: <span class="application">SCons</span> tracks two main kinds of cryptographic
      hashes: <span class="emphasis"><em>content signatures</em></span>,
      which are a hash of the contents of a file;
      and <span class="emphasis"><em>build signatures</em></span>, which are a hash of the
      elements needed to build a target, such as the exact command line,
      the contents of the sources, and possibly information about
      tools used in the build. The hash function produces a unique signature
      from its inputs, no other set of inputs can produce that same
      signature.  The build signature from building
      a target is used as the filename of the target file in the
      shared cache - that way lookups are efficient, just compute
      a build signature and see if a file exists with that as the name.
      </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch23s09.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch24s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">23.9. Not Configuring When Cleaning Targets </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 24.2. Keeping Build Output Consistent</td></tr></table></div></body></html>
