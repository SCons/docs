<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Construction Environments</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="SCons User Guide 0.98.5"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="The AlwaysBuild Function"
HREF="x1176.html"><LINK
REL="NEXT"
TITLE="Copying Construction Environments"
HREF="x1264.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>SCons User Guide 0.98.5</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1176.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1264.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="chap-environments"
></A
>Chapter 7. Construction Environments</H1
><P
>&#13;
   It is rare that all of the software in a large,
   complicated system needs to be built the same way.
   For example, different source files may need different options
   enabled on the command line,
   or different executable programs need to be linked
   with different libraries.
   <SPAN
CLASS="application"
>SCons</SPAN
> accommodates these different build
   requirements by allowing you to create and
   configure multiple <TT
CLASS="literal"
>construction environments</TT
>
   that control how the software is built.
   Technically, a <TT
CLASS="literal"
>construction environment</TT
> is an object
   that has a number of associated
   <TT
CLASS="literal"
>construction variables</TT
>, each with a name and a value.
   (A construction environment also has an attached
   set of <CODE
CLASS="classname"
>Builder</CODE
> methods,
   about which we'll learn more later.)

 </P
><P
>&#13;
   A <TT
CLASS="literal"
>construction environment</TT
> is created by the <CODE
CLASS="function"
>Environment</CODE
> method:

 </P
><PRE
CLASS="programlisting"
>&#13;    env = Environment()
  </PRE
><P
>&#13;
   By default, <SPAN
CLASS="application"
>SCons</SPAN
> initializes every
   new construction environment
   with a set of <TT
CLASS="literal"
>construction variables</TT
>
   based on the tools that it finds on your system,
   plus the default set of builder methods
   necessary for using those tools.
   The construction variables
   are initialized with values describing
   the C compiler,
   the Fortran compiler,
   the linker,
   etc.,
   as well as the command lines to invoke them.

 </P
><P
>&#13;
   When you initialize a construction environment
   you can set the values of the
   environment's <TT
CLASS="literal"
>construction variables</TT
>
   to control how a program is built.
   For example:

 </P
><PRE
CLASS="programlisting"
>&#13;    env = Environment(CC = 'gcc',
                      CCFLAGS = '-O2')

    env.Program('foo.c')
  </PRE
><P
>&#13;
   The construction environment in this example
   is still initialized with the same default
   construction variable values,
   except that the user has explicitly specified use of the
   GNU C compiler <SPAN
CLASS="application"
>gcc</SPAN
>,
   and further specifies that the <TT
CLASS="literal"
>-O2</TT
>
   (optimization level two)
   flag should be used when compiling the object file.
   In other words, the explicit initializations of
   <A
HREF="a3655.html#cv-CC"
><CODE
CLASS="envar"
>$CC</CODE
></A
> and <A
HREF="a3655.html#cv-CCFLAGS"
><CODE
CLASS="envar"
>$CCFLAGS</CODE
></A
>
   override the default values in the newly-created
   construction environment.
   So a run from this example would look like:

 </P
><PRE
CLASS="screen"
>&#13;    % <KBD
CLASS="userinput"
>scons -Q</KBD
>
    gcc -o foo.o -c -O2 foo.c
    gcc -o foo foo.o
 </PRE
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="AEN1224"
>7.1. Multiple <TT
CLASS="literal"
>Construction Environments</TT
></A
></H1
><P
>&#13;
   The real advantage of construction environments
   is that you can create as many different construction
   environments as you need,
   each tailored to a different way to build
   some piece of software or other file.
   If, for example, we need to build
   one program with the <TT
CLASS="literal"
>-O2</TT
> flag
   and another with the <TT
CLASS="literal"
>-g</TT
> (debug) flag,
   we would do this like so:

   </P
><PRE
CLASS="programlisting"
>&#13;      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      opt.Program('foo', 'foo.c')

      dbg.Program('bar', 'bar.c')
   </PRE
><PRE
CLASS="screen"
>&#13;      % <KBD
CLASS="userinput"
>scons -Q</KBD
>
      cc -o bar.o -c -g bar.c
      cc -o bar bar.o
      cc -o foo.o -c -O2 foo.c
      cc -o foo foo.o
   </PRE
><P
>&#13;
   We can even use multiple construction environments to build
   multiple versions of a single program.
   If you do this by simply trying to use the
   <A
HREF="a7185.html#b-Program"
><CODE
CLASS="function"
>Program</CODE
></A
> builder with both environments, though,
   like this:

   </P
><PRE
CLASS="programlisting"
>&#13;      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      opt.Program('foo', 'foo.c')

      dbg.Program('foo', 'foo.c')
   </PRE
><P
>&#13;
   Then <SPAN
CLASS="application"
>SCons</SPAN
> generates the following error:

   </P
><PRE
CLASS="screen"
>&#13;      % <KBD
CLASS="userinput"
>scons -Q</KBD
>
      
      scons: *** Two environments with different actions were specified for the same target: foo.o
      File "/home/my/project/SConstruct", line 6, in &#60;module&#62;
   </PRE
><P
>&#13;
   This is because the two <CODE
CLASS="function"
>Program</CODE
> calls have
   each implicitly told <SPAN
CLASS="application"
>SCons</SPAN
> to generate an object file named
   <TT
CLASS="filename"
>foo.o</TT
>,
   one with a <A
HREF="a3655.html#cv-CCFLAGS"
><CODE
CLASS="envar"
>$CCFLAGS</CODE
></A
> value of
   <TT
CLASS="literal"
>-O2</TT
>
   and one with a <A
HREF="a3655.html#cv-CCFLAGS"
><CODE
CLASS="envar"
>$CCFLAGS</CODE
></A
> value of
   <TT
CLASS="literal"
>-g</TT
>.
   <SPAN
CLASS="application"
>SCons</SPAN
> can't just decide that one of them
   should take precedence over the other,
   so it generates the error.
   To avoid this problem,
   we must explicitly specify
   that each environment compile
   <TT
CLASS="filename"
>foo.c</TT
>
   to a separately-named object file
   using the <A
HREF="a7185.html#b-Object"
><CODE
CLASS="function"
>Object</CODE
></A
> builder, like so:

   </P
><PRE
CLASS="programlisting"
>&#13;      opt = Environment(CCFLAGS = '-O2')
      dbg = Environment(CCFLAGS = '-g')

      o = opt.Object('foo-opt', 'foo.c')
      opt.Program(o)

      d = dbg.Object('foo-dbg', 'foo.c')
      dbg.Program(d)
   </PRE
><P
>&#13;
   Notice that each call to the <CODE
CLASS="function"
>Object</CODE
> builder
   returns a value,
   an internal <SPAN
CLASS="application"
>SCons</SPAN
> object that
   represents the object file that will be built.
   We then use that object
   as input to the <CODE
CLASS="function"
>Program</CODE
> builder.
   This avoids having to specify explicitly
   the object file name in multiple places,
   and makes for a compact, readable
   <TT
CLASS="filename"
>SConstruct</TT
> file.
   Our <SPAN
CLASS="application"
>SCons</SPAN
> output then looks like:

   </P
><PRE
CLASS="screen"
>&#13;      % <KBD
CLASS="userinput"
>scons -Q</KBD
>
      cc -o foo-dbg.o -c -g foo.c
      cc -o foo-dbg foo-dbg.o
      cc -o foo-opt.o -c -O2 foo.c
      cc -o foo-opt foo-opt.o
   </PRE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1176.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1264.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>The <CODE
CLASS="function"
>AlwaysBuild</CODE
> Function</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Copying <TT
CLASS="literal"
>Construction Environments</TT
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>