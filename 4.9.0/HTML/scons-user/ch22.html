<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 22. Caching Built Files</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 4.9.0"><link rel="up" href="index.html" title="SCons 4.9.0"><link rel="prev" href="ch21s09.html" title="21.9. Not Configuring When Cleaning Targets"><link rel="next" href="ch22s02.html" title="22.2. Keeping Build Output Consistent"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 22. Caching Built Files</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch21s09.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch22s02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 22. Caching Built Files"><div class="titlepage"><div><div><h2 class="title"><a name="chap-caching"></a>Chapter 22. Caching Built Files</h2></div></div></div><p>

  On multi-developer software projects,
  you can sometimes speed up every developer's builds a lot by
  allowing them to share a cache of the derived files that they build.
  After all, it is relatively rare that any in-progress change affects
  more than a few derived files, most will be unchanged.
  Using a cache can also help an individual developer:
  for example if you wish to start work on a new feature in a clean tree,
  those build artifacts which could be reused can be
  retrieved from the cache to populate the tree and save
  a lot of initial build time.
  <span class="application">SCons</span> makes this easy and reliable.

  </p><div class="section" title="22.1. Specifying the Derived-File Cache Directory"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id1412"></a>22.1. Specifying the Derived-File Cache Directory</h2></div></div></div><p>

    To enable caching of derived files,
    use the <a class="link" href="apd.html#f-CacheDir"><code class="function">CacheDir</code></a> function
    in any <code class="filename">SConscript</code> file:

    </p><pre class="programlisting">
CacheDir('/usr/local/build_cache')
       </pre><p>

    The cache directory you specify must
    have read and write access for all developers
    who will be accessing the cached files
    (if <code class="option">--cache-readonly</code> is used,
    only read access is required).
    It should also be in some central location
    that all builds will be able to access.
    In environments where developers are using separate systems
    (like individual workstations) for builds,
    this directory would typically be
    on a shared or NFS-mounted file system.
    While <span class="application">SCons</span> will create the specified cache directory as needed,
    in this multiuser scenario it is usually best
    to create it ahead of time, so the access rights
    can be set up correctly.

    </p><p>

    Here's what happens:
    When a build has a <code class="function">CacheDir</code> specified,
    every time a file is built,
    it is stored in that cache directory
    indexed by its <span>build signature</span>.
    On subsequent builds,
    before an action is invoked to build a file,
    the <span>build signature</span> is computed and <span class="application">SCons</span> checks
    the derived-file cache directory
    to see if a file with the exact same <span>build signature</span>
    already exists.

      <sup>[<a name="id6363" href="#ftn.id6363" class="footnote">4</a>]</sup>

    If so, the derived file will not be built locally,
    but will be copied into the local build directory
    from the derived-file cache directory,
    like this:

    </p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
cc -o hello.o -c hello.c
cc -o hello hello.o
% <strong class="userinput"><code>scons -Q -c</code></strong>
Removed hello.o
Removed hello
% <strong class="userinput"><code>scons -Q</code></strong>
Retrieved `hello.o' from cache
Retrieved `hello' from cache
</pre><p>

    Note that the <code class="function">CacheDir</code> feature requires that the <span>build signature</span>
    be calculated,
    even if you configure <span class="application">SCons</span> to use timestamps
    to decide if files are up to date
    (see the <a class="xref" href="ch06.html" title="Chapter 6. Dependencies">Chapter 6, <i>Dependencies</i></a>
    chapter for information about the <a class="link" href="apd.html#f-Decider"><code class="function">Decider</code></a> function),
    since the <span>build signature</span> is used to determine if a target file
    exists in the cache.
    Consequently, using <code class="function">CacheDir</code> may reduce or negate any performance
    improvements from using timestamps for up-to-date decisions.

    </p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id6363" href="#id6363" class="para">4</a>] </sup>
      A few inside details: <span class="application">SCons</span> tracks two main kinds of cryptographic
      hashes: a <span class="emphasis"><em><span>content signature</span></em></span>,
      which is a hash of the contents of a file participating in the
      build (dependencies as well as targets);
      and a <span class="emphasis"><em><span>build signature</span></em></span>, which is a hash of the
      elements needed to build a target, such as the command line,
      the contents of the sources, and possibly information about
      tools used in the build. The hash function produces a unique signature
      from its inputs, no other set of inputs can produce that same
      signature.  The <span>build signature</span> from building
      a target is used as the filename of the target file in the
      derived-file cache - that way lookups are efficient, just compute
      a <span>build signature</span> and see if a file exists with that as the name.
      </p><p>
      The use of the <span>build signature</span> provides protection from conflicts:
      if two developers have different setups, so they would produce
      built objects that are not identical, then because the difference in
      tools will show up in the <span>build signature</span>, which is used as the
      name of the cache entry, they will end up being
      stored as separate entries.
      </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch21s09.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch22s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">21.9. Not Configuring When Cleaning Targets </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 22.2. Keeping Build Output Consistent</td></tr></table></div></body></html>
