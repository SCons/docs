<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Modifying a Construction Environment</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="SCons User Guide 0.98.0"
HREF="index.html"><LINK
REL="UP"
TITLE="Construction Environments"
HREF="c1191.html"><LINK
REL="PREVIOUS"
TITLE="Expanding Values From a Construction Environment"
HREF="x1301.html"><LINK
REL="NEXT"
TITLE="Controlling the External Environment Used to Execute Build Commands"
HREF="c1404.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>SCons User Guide 0.98.0</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1301.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 7. Construction Environments</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c1404.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="AEN1331"
>7.5. Modifying a <TT
CLASS="literal"
>Construction Environment</TT
></A
></H1
><P
>&#13;
   <SPAN
CLASS="application"
>SCons</SPAN
> provides various methods that
   support modifying existing values in a construction environment.

   </P
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="AEN1336"
>7.5.1. Replacing Values in a <TT
CLASS="literal"
>Construction Environment</TT
></A
></H2
><P
>&#13;
     You can replace existing construction variable values
     using the <CODE
CLASS="function"
>Replace</CODE
> method:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment(CCFLAGS = '-DDEFINE1')
        env.Replace(CCFLAGS = '-DDEFINE2')
        env.Program('foo.c')
     </PRE
><P
>&#13;
     The replacing value
     (<TT
CLASS="literal"
>-DDEFINE2</TT
> in the above example)
     completely replaces the value in the
     construction environment:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        cc -o foo.o -c -DDEFINE2 foo.c
        cc -o foo foo.o
     </PRE
><P
>&#13;
     You can safely call <CODE
CLASS="function"
>Replace</CODE
>
     for construction variables that
     don't exist in the construction environment:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment()
        env.Replace(NEW_VARIABLE = 'xyzzy')
        print "NEW_VARIABLE =", env['NEW_VARIABLE']
     </PRE
><P
>&#13;
     In this case,
     the construction variable simply
     gets added to the construction environment:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        NEW_VARIABLE = xyzzy
        scons: `.' is up to date.
     </PRE
><P
>&#13;
     Because the variables
     aren't expanded until the construction environment
     is actually used to build the targets,
     and because <SPAN
CLASS="application"
>SCons</SPAN
> function and method calls
     are order-independent,
     the last replacement "wins"
     and is used to build all targets,
     regardless of the order in which
     the calls to Replace() are
     interspersed with calls to
     builder methods:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment(CCFLAGS = '-DDEFINE1')
        print "CCFLAGS =", env['CCFLAGS']
        env.Program('foo.c')

        env.Replace(CCFLAGS = '-DDEFINE2')
        print "CCFLAGS =", env['CCFLAGS']
        env.Program('bar.c')
     </PRE
><P
>&#13;
     The timing of when the replacement
     actually occurs relative
     to when the targets get built
     becomes apparent
     if we run <SPAN
CLASS="application"
>scons</SPAN
> without the <TT
CLASS="literal"
>-Q</TT
>
     option:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons</KBD
>
        scons: Reading SConscript files ...
        CCFLAGS = -DDEFINE1
        CCFLAGS = -DDEFINE2
        scons: done reading SConscript files.
        scons: Building targets ...
        cc -o bar.o -c -DDEFINE2 bar.c
        cc -o bar bar.o
        cc -o foo.o -c -DDEFINE2 foo.c
        cc -o foo foo.o
        scons: done building targets.
     </PRE
><P
>&#13;
     Because the replacement occurs while
     the <TT
CLASS="filename"
>SConscript</TT
> files are being read,
     the <A
HREF="a3578.html#cv-CCFLAGS"
><CODE
CLASS="envar"
>$CCFLAGS</CODE
></A
>
     variable has already been set to
     <TT
CLASS="literal"
>-DDEFINE2</TT
>
     by the time the <TT
CLASS="filename"
>foo.o</TT
> target is built,
     even though the call to the <CODE
CLASS="function"
>Replace</CODE
>
     method does not occur until later in
     the <TT
CLASS="filename"
>SConscript</TT
> file.

     </P
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="AEN1368"
>7.5.2. Appending to the End of Values in a <TT
CLASS="literal"
>Construction Environment</TT
></A
></H2
><P
>&#13;
     You can append a value to
     an existing construction variable
     using the <CODE
CLASS="function"
>Append</CODE
> method:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment(CCFLAGS = '-DMY_VALUE')
        env.Append(CCFLAGS = ' -DLAST')
        env.Program('foo.c')
     </PRE
><P
>&#13;
     <SPAN
CLASS="application"
>SCons</SPAN
> then supplies both the <TT
CLASS="literal"
>-DMY_VALUE</TT
> and
     <TT
CLASS="literal"
>-DLAST</TT
> flags when compiling the object file:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        cc -o foo.o -c -DMY_VALUE -DLAST foo.c
        cc -o foo foo.o
     </PRE
><P
>&#13;
     If the construction variable doesn't already exist,
     the <CODE
CLASS="function"
>Append</CODE
> method will create it:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment()
        env.Append(NEW_VARIABLE = 'added')
        print "NEW_VARIABLE =", env['NEW_VARIABLE']
     </PRE
><P
>&#13;
     Which yields:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        NEW_VARIABLE = added
        scons: `.' is up to date.
     </PRE
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="AEN1386"
>7.5.3. Appending to the Beginning of Values in a <TT
CLASS="literal"
>Construction Environment</TT
></A
></H2
><P
>&#13;
     You can append a value to the beginning of
     an existing construction variable
     using the <CODE
CLASS="function"
>Prepend</CODE
> method:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment(CCFLAGS = '-DMY_VALUE')
        env.Prepend(CCFLAGS = '-DFIRST ')
        env.Program('foo.c')
     </PRE
><P
>&#13;
     <SPAN
CLASS="application"
>SCons</SPAN
> then supplies both the <TT
CLASS="literal"
>-DFIRST</TT
> and
     <TT
CLASS="literal"
>-DMY_VALUE</TT
> flags when compiling the object file:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        cc -o foo.o -c -DFIRST -DMY_VALUE foo.c
        cc -o foo foo.o
     </PRE
><P
>&#13;
     If the construction variable doesn't already exist,
     the <CODE
CLASS="function"
>Prepend</CODE
> method will create it:

     </P
><PRE
CLASS="programlisting"
>&#13;        env = Environment()
        env.Prepend(NEW_VARIABLE = 'added')
        print "NEW_VARIABLE =", env['NEW_VARIABLE']
     </PRE
><P
>&#13;
     Which yields:

     </P
><PRE
CLASS="screen"
>&#13;        % <KBD
CLASS="userinput"
>scons -Q</KBD
>
        NEW_VARIABLE = added
        scons: `.' is up to date.
     </PRE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1301.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c1404.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Expanding Values From a <TT
CLASS="literal"
>Construction Environment</TT
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c1191.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Controlling the External Environment Used to Execute Build Commands</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>