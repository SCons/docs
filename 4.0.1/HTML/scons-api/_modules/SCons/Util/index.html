

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCons.Util &mdash; SCons 4.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../" class="icon icon-home"> SCons
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons/">SCons package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Action">SCons.Action module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Builder">SCons.Builder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.CacheDir">SCons.CacheDir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Conftest">SCons.Conftest module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Debug">SCons.Debug module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Defaults">SCons.Defaults module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Environment">SCons.Environment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Errors">SCons.Errors module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Executor">SCons.Executor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Job">SCons.Job module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Memoize">SCons.Memoize module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.PathList">SCons.PathList module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConf">SCons.SConf module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConsign">SCons.SConsign module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Subst">SCons.Subst module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Taskmaster">SCons.Taskmaster module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons/#generic-taskmaster-module-for-the-scons-build-engine">Generic Taskmaster module for the SCons build engine.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Util">SCons.Util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Warnings">SCons.Warnings module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.cpp">SCons.cpp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.dblite">SCons.dblite module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.exitfuncs">SCons.exitfuncs module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.compat/#module-SCons.compat">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Alias">SCons.Node.Alias module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.FS">SCons.Node.FS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Python">SCons.Node.Python module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.aix">SCons.Platform.aix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.cygwin">SCons.Platform.cygwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.darwin">SCons.Platform.darwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.hpux">SCons.Platform.hpux module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.irix">SCons.Platform.irix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.mingw">SCons.Platform.mingw module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.os2">SCons.Platform.os2 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.posix">SCons.Platform.posix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.sunos">SCons.Platform.sunos module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.virtualenv">SCons.Platform.virtualenv module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.win32">SCons.Platform.win32 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.C">SCons.Scanner.C module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.D">SCons.Scanner.D module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Dir">SCons.Scanner.Dir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Fortran">SCons.Scanner.Fortran module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.IDL">SCons.Scanner.IDL module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.LaTeX">SCons.Scanner.LaTeX module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Prog">SCons.Scanner.Prog module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.RC">SCons.Scanner.RC module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.SWIG">SCons.Scanner.SWIG module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Interactive">SCons.Script.Interactive module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Main">SCons.Script.Main module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConsOptions">SCons.Script.SConsOptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConscript">SCons.Script.SConscript module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Tool/#module-SCons.Tool">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.BoolVariable">SCons.Variables.BoolVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.EnumVariable">SCons.Variables.EnumVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.ListVariable">SCons.Variables.ListVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PackageVariable">SCons.Variables.PackageVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PathVariable">SCons.Variables.PathVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">SCons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../">Docs</a> &raquo;</li>
        
          <li><a href="../../">Module code</a> &raquo;</li>
        
      <li>SCons.Util</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SCons.Util</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;SCons.Util</span>

<span class="sd">Various utility functions go here.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1"># __COPYRIGHT__</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining</span>
<span class="c1"># a copy of this software and associated documentation files (the</span>
<span class="c1"># &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="c1"># without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="c1"># distribute, sublicense, and/or sell copies of the Software, and to</span>
<span class="c1"># permit persons to whom the Software is furnished to do so, subject to</span>
<span class="c1"># the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included</span>
<span class="c1"># in all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY</span>
<span class="c1"># KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE</span>
<span class="c1"># WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="c1"># NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE</span>
<span class="c1"># LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="c1"># OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="c1"># WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="n">__revision__</span> <span class="o">=</span> <span class="s2">&quot;__FILE__ __REVISION__ __DATE__ __DEVELOPER__&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span><span class="p">,</span> <span class="n">UserList</span><span class="p">,</span> <span class="n">UserString</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MappingView</span>

<span class="n">PYPY</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;pypy_translation_info&#39;</span><span class="p">)</span>

<span class="c1"># Below not used?</span>
<span class="c1"># InstanceType    = types.InstanceType</span>

<span class="n">MethodType</span>      <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span>
<span class="n">FunctionType</span>    <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span>

<div class="viewcode-block" id="dictify"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.dictify">[docs]</a><span class="k">def</span> <span class="nf">dictify</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="n">_altsep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">altsep</span>
<span class="k">if</span> <span class="n">_altsep</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
    <span class="c1"># My ActivePython 2.0.1 doesn&#39;t set os.altsep!  What gives?</span>
    <span class="n">_altsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
<span class="k">if</span> <span class="n">_altsep</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">rightmost_separator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">sep</span><span class="p">),</span> <span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">_altsep</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="rightmost_separator"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.rightmost_separator">[docs]</a>    <span class="k">def</span> <span class="nf">rightmost_separator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span></div>

<span class="c1"># First two from the Python Cookbook, just for completeness.</span>
<span class="c1"># (Yeah, yeah, YAGNI...)</span>
<div class="viewcode-block" id="containsAny"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.containsAny">[docs]</a><span class="k">def</span> <span class="nf">containsAny</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check whether sequence str contains ANY of the items in set.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="containsAll"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.containsAll">[docs]</a><span class="k">def</span> <span class="nf">containsAll</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check whether sequence str contains ALL of the items in set.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="containsOnly"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.containsOnly">[docs]</a><span class="k">def</span> <span class="nf">containsOnly</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check whether sequence str contains ONLY items in set.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="splitext"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.splitext">[docs]</a><span class="k">def</span> <span class="nf">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Same as os.path.splitext() but faster.&quot;&quot;&quot;</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="n">rightmost_separator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="c1"># An ext is only real if it has at least one non-digit char</span>
    <span class="k">if</span> <span class="n">dot</span> <span class="o">&gt;</span> <span class="n">sep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">containsOnly</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">dot</span><span class="p">:],</span> <span class="s2">&quot;0123456789.&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">[:</span><span class="n">dot</span><span class="p">],</span><span class="n">path</span><span class="p">[</span><span class="n">dot</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">,</span><span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="updrive"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.updrive">[docs]</a><span class="k">def</span> <span class="nf">updrive</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the drive letter (if any) upper case.</span>
<span class="sd">    This is useful because Windows is inconsistent on the case</span>
<span class="sd">    of the drive letter, which can cause inconsistencies when</span>
<span class="sd">    calculating command signatures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drive</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitdrive</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">drive</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">drive</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">rest</span>
    <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="NodeList"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.NodeList">[docs]</a><span class="k">class</span> <span class="nc">NodeList</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class is almost exactly like a regular list of Nodes</span>
<span class="sd">    (actually it can hold any object), with one important difference.</span>
<span class="sd">    If you try to get an attribute from this list, it will return that</span>
<span class="sd">    attribute from every item in the list.  For example:</span>

<span class="sd">    &gt;&gt;&gt; someList = NodeList([ &#39;  foo  &#39;, &#39;  bar  &#39; ])</span>
<span class="sd">    &gt;&gt;&gt; someList.strip()</span>
<span class="sd">    [ &#39;foo&#39;, &#39;bar&#39; ]</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="c1">#     def __init__(self, initlist=None):</span>
<span class="c1">#         self.data = []</span>
<span class="c1"># #        print(&quot;TYPE:%s&quot;%type(initlist))</span>
<span class="c1">#         if initlist is not None:</span>
<span class="c1">#             # XXX should this accept an arbitrary sequence?</span>
<span class="c1">#             if type(initlist) == type(self.data):</span>
<span class="c1">#                 self.data[:] = initlist</span>
<span class="c1">#             elif isinstance(initlist, (UserList, NodeList)):</span>
<span class="c1">#                 self.data[:] = initlist.data[:]</span>
<span class="c1">#             elif isinstance(initlist, Iterable):</span>
<span class="c1">#                 self.data = list(initlist)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 self.data = [ initlist,]</span>


    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nonzero__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This comes for free on py2,</span>
<span class="sd">        but py3 slices of NodeList are returning a list</span>
<span class="sd">        breaking slicing nodelist and refering to</span>
<span class="sd">        properties and methods on contained object</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#        return self.__class__(self.data[index])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="c1"># Expand the slice object using range()</span>
            <span class="c1"># limited by number of items in self.data</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                    <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">indices</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return one item of the tart</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>


<span class="n">_get_env_var</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\$([_a-zA-Z]\w*|{[_a-zA-Z]\w*})$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="get_environment_var"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.get_environment_var">[docs]</a><span class="k">def</span> <span class="nf">get_environment_var</span><span class="p">(</span><span class="n">varstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a string, first determine if it looks like a reference</span>
<span class="sd">    to a single environment variable, like &quot;$FOO&quot; or &quot;${FOO}&quot;.</span>
<span class="sd">    If so, return that variable with no decorations (&quot;FOO&quot;).</span>
<span class="sd">    If not, return None.&quot;&quot;&quot;</span>
    <span class="n">mo</span><span class="o">=</span><span class="n">_get_env_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">to_String</span><span class="p">(</span><span class="n">varstr</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">var</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DisplayEngine"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.DisplayEngine">[docs]</a><span class="k">class</span> <span class="nc">DisplayEngine</span><span class="p">:</span>
    <span class="n">print_it</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">append_newline</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_it</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">append_newline</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># Stdout might be connected to a pipe that has been closed</span>
            <span class="c1"># by now. The most likely reason for the pipe being closed</span>
            <span class="c1"># is that the user has press ctrl-c. It this is the case,</span>
            <span class="c1"># then SCons is currently shutdown. We therefore ignore</span>
            <span class="c1"># IOError&#39;s here so that SCons can continue and shutdown</span>
            <span class="c1"># properly so that the .sconsign is correctly written</span>
            <span class="c1"># before SCons exits.</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="DisplayEngine.set_mode"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.DisplayEngine.set_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_it</span> <span class="o">=</span> <span class="n">mode</span></div></div>


<div class="viewcode-block" id="render_tree"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.render_tree">[docs]</a><span class="k">def</span> <span class="nf">render_tree</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">child_func</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">visited</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render a tree of nodes into an ASCII tree view.</span>

<span class="sd">    :Parameters:</span>
<span class="sd">        - `root`:       the root node of the tree</span>
<span class="sd">        - `child_func`: the function called to get the children of a node</span>
<span class="sd">        - `prune`:      don&#39;t visit the same node twice</span>
<span class="sd">        - `margin`:     the format of the left margin to use for children of root. 1 results in a pipe, and 0 results in no pipe.</span>
<span class="sd">        - `visited`:    a dictionary of visited nodes in the current branch if not prune, or in the whole tree if prune.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="c1"># Initialize &#39;visited&#39; dict, if required</span>
    <span class="k">if</span> <span class="n">visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">children</span> <span class="o">=</span> <span class="n">child_func</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pipe</span> <span class="ow">in</span> <span class="n">margin</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">pipe</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span> <span class="o">+</span> <span class="s2">&quot;| &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>

    <span class="k">if</span> <span class="n">rname</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">retval</span> <span class="o">+</span> <span class="s2">&quot;+-[&quot;</span> <span class="o">+</span> <span class="n">rname</span> <span class="o">+</span> <span class="s2">&quot;]</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span> <span class="o">+</span> <span class="s2">&quot;+-&quot;</span> <span class="o">+</span> <span class="n">rname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prune</span><span class="p">:</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">visited</span><span class="p">)</span>
    <span class="n">visited</span><span class="p">[</span><span class="n">rname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)):</span>
        <span class="n">margin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">retval</span> <span class="o">+</span> <span class="n">render_tree</span><span class="p">(</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">child_func</span><span class="p">,</span> <span class="n">prune</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>
        <span class="n">margin</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">retval</span></div>

<span class="n">IDX</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">N</span><span class="p">:</span> <span class="n">N</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">0</span>

<span class="c1"># unicode line drawing chars:</span>
<span class="n">BOX_HORIZ</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x2500</span><span class="p">)</span>  <span class="c1"># &#39;─&#39;</span>
<span class="n">BOX_VERT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x2502</span><span class="p">)</span>  <span class="c1"># &#39;│&#39;</span>
<span class="n">BOX_UP_RIGHT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x2514</span><span class="p">)</span>  <span class="c1"># &#39;└&#39;</span>
<span class="n">BOX_DOWN_RIGHT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x250c</span><span class="p">)</span>  <span class="c1"># &#39;┌&#39;</span>
<span class="n">BOX_DOWN_LEFT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x2510</span><span class="p">)</span>   <span class="c1"># &#39;┐&#39;</span>
<span class="n">BOX_UP_LEFT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x2518</span><span class="p">)</span>  <span class="c1"># &#39;┘&#39;</span>
<span class="n">BOX_VERT_RIGHT</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x251c</span><span class="p">)</span>  <span class="c1"># &#39;├&#39;</span>
<span class="n">BOX_HORIZ_DOWN</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x252c</span><span class="p">)</span>  <span class="c1"># &#39;┬&#39;</span>


<div class="viewcode-block" id="print_tree"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.print_tree">[docs]</a><span class="k">def</span> <span class="nf">print_tree</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">child_func</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">showtags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">visited</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lastChild</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">singleLineDraw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a tree of nodes.  This is like render_tree, except it prints</span>
<span class="sd">    lines directly instead of creating a string representation in memory,</span>
<span class="sd">    so that huge trees can be printed.</span>

<span class="sd">    :Parameters:</span>
<span class="sd">        - `root`       - the root node of the tree</span>
<span class="sd">        - `child_func` - the function called to get the children of a node</span>
<span class="sd">        - `prune`      - don&#39;t visit the same node twice</span>
<span class="sd">        - `showtags`   - print status information to the left of each node line</span>
<span class="sd">        - `margin`     - the format of the left margin to use for children of root. 1 results in a pipe, and 0 results in no pipe.</span>
<span class="sd">        - `visited`    - a dictionary of visited nodes in the current branch if not prune, or in the whole tree if prune.</span>
<span class="sd">        - `singleLineDraw` - use line-drawing characters rather than ASCII.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>


    <span class="c1"># Initialize &#39;visited&#39; dict, if required</span>
    <span class="k">if</span> <span class="n">visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">showtags</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">showtags</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; E         = exists</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;  R        = exists in repository only</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;   b       = implicit builder</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;   B       = explicit builder</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;    S      = side effect</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;     P     = precious</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;      A    = always build</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;       C   = current</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;        N  = no clean</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;         H = no cache</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">legend</span><span class="p">)</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;[&#39;</span><span class="p">,</span>
            <span class="s1">&#39; E&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">exists</span><span class="p">())],</span>
            <span class="s1">&#39; R&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">rexists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">root</span><span class="o">.</span><span class="n">exists</span><span class="p">())],</span>
            <span class="s1">&#39; BbB&#39;</span><span class="p">[</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">has_explicit_builder</span><span class="p">())]</span> <span class="o">+</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">][</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">has_builder</span><span class="p">())]</span>
            <span class="p">],</span>
            <span class="s1">&#39; S&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">side_effect</span><span class="p">)],</span>
            <span class="s1">&#39; P&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">precious</span><span class="p">)],</span>
            <span class="s1">&#39; A&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">always_build</span><span class="p">)],</span>
            <span class="s1">&#39; C&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">is_up_to_date</span><span class="p">())],</span>
            <span class="s1">&#39; N&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">noclean</span><span class="p">)],</span>
            <span class="s1">&#39; H&#39;</span><span class="p">[</span><span class="n">IDX</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">nocache</span><span class="p">)],</span>
            <span class="s1">&#39;]&#39;</span>
        <span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">MMM</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">singleLineDraw</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">BOX_VERT</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;| &quot;</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>

    <span class="n">margins</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">MMM</span><span class="p">,</span> <span class="n">margin</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">children</span> <span class="o">=</span> <span class="n">child_func</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>


    <span class="n">cross</span> <span class="o">=</span> <span class="s2">&quot;+-&quot;</span>
    <span class="k">if</span> <span class="n">singleLineDraw</span><span class="p">:</span>
        <span class="n">cross</span> <span class="o">=</span> <span class="n">BOX_VERT_RIGHT</span> <span class="o">+</span> <span class="n">BOX_HORIZ</span>   <span class="c1"># sign used to point to the leaf.</span>
        <span class="c1"># check if this is the last leaf of the branch</span>
        <span class="k">if</span> <span class="n">lastChild</span><span class="p">:</span>
            <span class="c1">#if this if the last leaf, then terminate:</span>
            <span class="n">cross</span> <span class="o">=</span> <span class="n">BOX_UP_RIGHT</span> <span class="o">+</span> <span class="n">BOX_HORIZ</span>  <span class="c1"># sign for the last leaf</span>

        <span class="c1"># if this branch has children then split it</span>
        <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
            <span class="c1"># if it&#39;s a leaf:</span>
            <span class="k">if</span> <span class="n">prune</span> <span class="ow">and</span> <span class="n">rname</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">and</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">cross</span> <span class="o">+=</span> <span class="n">BOX_HORIZ</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cross</span> <span class="o">+=</span> <span class="n">BOX_HORIZ_DOWN</span>

    <span class="k">if</span> <span class="n">prune</span> <span class="ow">and</span> <span class="n">rname</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">and</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags</span> <span class="o">+</span> <span class="n">margins</span> <span class="o">+</span> <span class="p">[</span><span class="n">cross</span><span class="p">,</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">rname</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags</span> <span class="o">+</span> <span class="n">margins</span> <span class="o">+</span> <span class="p">[</span><span class="n">cross</span><span class="p">,</span> <span class="n">rname</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">visited</span><span class="p">[</span><span class="n">rname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># if this item has children:</span>
    <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">margin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Initialize margin with 1 for vertical bar.</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">IDX</span><span class="p">(</span><span class="n">showtags</span><span class="p">)</span>
        <span class="n">_child</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Initialize this for the first child.</span>
        <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">_child</span> <span class="o">=</span> <span class="n">_child</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># number the children</span>
            <span class="n">print_tree</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">child_func</span><span class="p">,</span> <span class="n">prune</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">-</span> <span class="n">_child</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">,</span><span class="n">singleLineDraw</span><span class="p">)</span>
        <span class="n">margin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># margins are with space (index 0) because we arrived to the last child.</span>
        <span class="n">print_tree</span><span class="p">(</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">child_func</span><span class="p">,</span> <span class="n">prune</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="kc">True</span> <span class="p">,</span><span class="n">singleLineDraw</span><span class="p">)</span> <span class="c1"># for this call child and nr of children needs to be set 0, to signal the second phase.</span>
        <span class="n">margin</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="c1"># destroy the last margin added</span></div>


<span class="c1"># Functions for deciding if things are like various types, mainly to</span>
<span class="c1"># handle UserDict, UserList and UserString like their underlying types.</span>
<span class="c1">#</span>
<span class="c1"># Yes, all of this manual testing breaks polymorphism, and the real</span>
<span class="c1"># Pythonic way to do all of this would be to just try it and handle the</span>
<span class="c1"># exception, but handling the exception when it&#39;s not the right type is</span>
<span class="c1"># often too slow.</span>

<span class="c1"># We are using the following trick to speed up these</span>
<span class="c1"># functions. Default arguments are used to take a snapshot of</span>
<span class="c1"># the global functions and constants used by these functions. This</span>
<span class="c1"># transforms accesses to global variable into local variables</span>
<span class="c1"># accesses (i.e. LOAD_FAST instead of LOAD_GLOBAL).</span>

<span class="n">DictTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">UserDict</span><span class="p">)</span>
<span class="n">ListTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">UserList</span><span class="p">)</span>

<span class="c1"># Handle getting dictionary views.</span>
<span class="n">SequenceTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">UserList</span><span class="p">,</span> <span class="n">MappingView</span><span class="p">)</span>

<span class="c1"># TODO: PY3 check this benchmarking is still correct.</span>
<span class="c1"># Note that profiling data shows a speed-up when comparing</span>
<span class="c1"># explicitly with str instead of simply comparing</span>
<span class="c1"># with basestring. (at least on Python 2.5.1)</span>
<span class="n">StringTypes</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">UserString</span><span class="p">)</span>

<span class="c1"># Empirically, it is faster to check explicitly for str than for basestring.</span>
<span class="n">BaseStringTypes</span> <span class="o">=</span> <span class="nb">str</span>

<div class="viewcode-block" id="is_Dict"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_Dict">[docs]</a><span class="k">def</span> <span class="nf">is_Dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">DictTypes</span><span class="o">=</span><span class="n">DictTypes</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DictTypes</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_List"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_List">[docs]</a><span class="k">def</span> <span class="nf">is_List</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">ListTypes</span><span class="o">=</span><span class="n">ListTypes</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ListTypes</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_Sequence"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_Sequence">[docs]</a><span class="k">def</span> <span class="nf">is_Sequence</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_Tuple"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_Tuple">[docs]</a><span class="k">def</span> <span class="nf">is_Tuple</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="nb">tuple</span><span class="o">=</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_String"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_String">[docs]</a><span class="k">def</span> <span class="nf">is_String</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">StringTypes</span><span class="o">=</span><span class="n">StringTypes</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span></div>

<div class="viewcode-block" id="is_Scalar"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.is_Scalar">[docs]</a><span class="k">def</span> <span class="nf">is_Scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">StringTypes</span><span class="o">=</span><span class="n">StringTypes</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">):</span>
    <span class="c1"># Profiling shows that there is an impressive speed-up of 2x</span>
    <span class="c1"># when explicitly checking for strings instead of just not</span>
    <span class="c1"># sequence when the argument (i.e. obj) is already a string.</span>
    <span class="c1"># But, if obj is a not string then it is twice as fast to</span>
    <span class="c1"># check only for &#39;not sequence&#39;. The following code therefore</span>
    <span class="c1"># assumes that the obj argument is a string most of the time.</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">)</span></div>

<div class="viewcode-block" id="do_flatten"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.do_flatten">[docs]</a><span class="k">def</span> <span class="nf">do_flatten</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span>
               <span class="n">StringTypes</span><span class="o">=</span><span class="n">StringTypes</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_flatten</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="flatten"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.flatten">[docs]</a><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">StringTypes</span><span class="o">=</span><span class="n">StringTypes</span><span class="p">,</span>
            <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">,</span> <span class="n">do_flatten</span><span class="o">=</span><span class="n">do_flatten</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flatten a sequence to a non-nested list.</span>

<span class="sd">    Flatten() converts either a single scalar or a nested sequence</span>
<span class="sd">    to a non-nested list. Note that flatten() considers strings</span>
<span class="sd">    to be scalars instead of sequences like Python would.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_flatten</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="flatten_sequence"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.flatten_sequence">[docs]</a><span class="k">def</span> <span class="nf">flatten_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="n">StringTypes</span><span class="o">=</span><span class="n">StringTypes</span><span class="p">,</span>
                     <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">,</span> <span class="n">do_flatten</span><span class="o">=</span><span class="n">do_flatten</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flatten a sequence to a non-nested list.</span>

<span class="sd">    Same as flatten(), but it does not handle the single scalar</span>
<span class="sd">    case. This is slightly more efficient when one knows that</span>
<span class="sd">    the sequence to flatten can not be a scalar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">StringTypes</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_flatten</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="c1"># Generic convert-to-string functions.  The wrapper</span>
<span class="c1"># to_String_for_signature() will use a for_signature() method if the</span>
<span class="c1"># specified object has one.</span>
<span class="c1">#</span>


<div class="viewcode-block" id="to_String"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.to_String">[docs]</a><span class="k">def</span> <span class="nf">to_String</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
              <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="nb">str</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
              <span class="n">UserString</span><span class="o">=</span><span class="n">UserString</span><span class="p">,</span> <span class="n">BaseStringTypes</span><span class="o">=</span><span class="n">BaseStringTypes</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">BaseStringTypes</span><span class="p">):</span>
        <span class="c1"># Early out when already a string!</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
        <span class="c1"># s.data can only be a regular string. Please see the UserString initializer.</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="to_String_for_subst"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.to_String_for_subst">[docs]</a><span class="k">def</span> <span class="nf">to_String_for_subst</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
                        <span class="nb">isinstance</span><span class="o">=</span><span class="nb">isinstance</span><span class="p">,</span> <span class="nb">str</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">to_String</span><span class="o">=</span><span class="n">to_String</span><span class="p">,</span>
                        <span class="n">BaseStringTypes</span><span class="o">=</span><span class="n">BaseStringTypes</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="o">=</span><span class="n">SequenceTypes</span><span class="p">,</span>
                        <span class="n">UserString</span><span class="o">=</span><span class="n">UserString</span><span class="p">):</span>

    <span class="c1"># Note that the test cases are sorted by order of probability.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">BaseStringTypes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">to_String_for_subst</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">UserString</span><span class="p">):</span>
        <span class="c1"># s.data can only a regular string. Please see the UserString initializer.</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="to_String_for_signature"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.to_String_for_signature">[docs]</a><span class="k">def</span> <span class="nf">to_String_for_signature</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">to_String_for_subst</span><span class="o">=</span><span class="n">to_String_for_subst</span><span class="p">,</span>
                            <span class="ne">AttributeError</span><span class="o">=</span><span class="ne">AttributeError</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">for_signature</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># pprint will output dictionary in key sorted order</span>
            <span class="c1"># with py3.5 the order was randomized. In general depending on dictionary order</span>
            <span class="c1"># which was undefined until py3.6 (where it&#39;s by insertion order) was not wise.</span>
            <span class="c1"># TODO: Change code when floor is raised to PY36</span>
            <span class="k">return</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">to_String_for_subst</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">()</span></div>


<span class="c1"># The SCons &quot;semi-deep&quot; copy.</span>
<span class="c1">#</span>
<span class="c1"># This makes separate copies of lists (including UserList objects)</span>
<span class="c1"># dictionaries (including UserDict objects) and tuples, but just copies</span>
<span class="c1"># references to anything else it finds.</span>
<span class="c1">#</span>
<span class="c1"># A special case is any object that has a __semi_deepcopy__() method,</span>
<span class="c1"># which we invoke to create the copy. Currently only used by</span>
<span class="c1"># BuilderDict to actually prevent the copy operation (as invalid on that object).</span>
<span class="c1">#</span>
<span class="c1"># The dispatch table approach used here is a direct rip-off from the</span>
<span class="c1"># normal Python copy module.</span>

<span class="n">_semi_deepcopy_dispatch</span> <span class="o">=</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="semi_deepcopy_dict"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.semi_deepcopy_dict">[docs]</a><span class="k">def</span> <span class="nf">semi_deepcopy_dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">):</span>
    <span class="n">copy</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># The regular Python copy.deepcopy() also deepcopies the key,</span>
        <span class="c1"># as follows:</span>
        <span class="c1">#</span>
        <span class="c1">#    copy[semi_deepcopy(key)] = semi_deepcopy(val)</span>
        <span class="c1">#</span>
        <span class="c1"># Doesn&#39;t seem like we need to, but we&#39;ll comment it just in case.</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">copy</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">semi_deepcopy</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copy</span></div>
<span class="n">d</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">semi_deepcopy_dict</span>

<div class="viewcode-block" id="_semi_deepcopy_list"><a class="viewcode-back" href="../../../SCons/#SCons.Builder._semi_deepcopy_list">[docs]</a><span class="k">def</span> <span class="nf">_semi_deepcopy_list</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">semi_deepcopy</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>
<span class="n">d</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">_semi_deepcopy_list</span>

<div class="viewcode-block" id="_semi_deepcopy_tuple"><a class="viewcode-back" href="../../../SCons/#SCons.Builder._semi_deepcopy_tuple">[docs]</a><span class="k">def</span> <span class="nf">_semi_deepcopy_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">semi_deepcopy</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span></div>
<span class="n">d</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">_semi_deepcopy_tuple</span>

<div class="viewcode-block" id="semi_deepcopy"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.semi_deepcopy">[docs]</a><span class="k">def</span> <span class="nf">semi_deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">copier</span> <span class="o">=</span> <span class="n">_semi_deepcopy_dispatch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">copier</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">copier</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;__semi_deepcopy__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">__semi_deepcopy__</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">__semi_deepcopy__</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">UserDict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">semi_deepcopy_dict</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">UserList</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">_semi_deepcopy_list</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="Proxy"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Proxy">[docs]</a><span class="k">class</span> <span class="nc">Proxy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A simple generic Proxy class, forwarding all calls to</span>
<span class="sd">    subject.  So, for the benefit of the python newbie, what does</span>
<span class="sd">    this really mean?  Well, it means that you can take an object, let&#39;s</span>
<span class="sd">    call it &#39;objA&#39;, and wrap it in this Proxy class, with a statement</span>
<span class="sd">    like this</span>

<span class="sd">                 proxyObj = Proxy(objA),</span>

<span class="sd">    Then, if in the future, you do something like this</span>

<span class="sd">                 x = proxyObj.var1,</span>

<span class="sd">    since Proxy does not have a &#39;var1&#39; attribute (but presumably objA does),</span>
<span class="sd">    the request actually is equivalent to saying</span>

<span class="sd">                 x = objA.var1</span>

<span class="sd">    Inherit from this class to create a Proxy.</span>

<span class="sd">    Note that, with new-style classes, this does *not* work transparently</span>
<span class="sd">    for Proxy subclasses that use special .__*__() method names, because</span>
<span class="sd">    those names are now bound to the class, not the individual instances.</span>
<span class="sd">    You now need to know in advance which .__*__() method names you want</span>
<span class="sd">    to pass on to the underlying Proxy object, and specifically delegate</span>
<span class="sd">    their calls like this:</span>

<span class="sd">        class Foo(Proxy):</span>
<span class="sd">            __str__ = Delegate(&#39;__str__&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap an object as a Proxy object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subject</span> <span class="o">=</span> <span class="n">subject</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve an attribute from the wrapped object.  If the named</span>
<span class="sd">           attribute doesn&#39;t exist, AttributeError is raised&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Proxy.get"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Proxy.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the entire wrapped object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span></div>


<div class="viewcode-block" id="Delegate"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Delegate">[docs]</a><span class="k">class</span> <span class="nc">Delegate</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A Python Descriptor class that delegates attribute fetches</span>
<span class="sd">    to an underlying wrapped subject of a Proxy.  Typical use:</span>

<span class="sd">        class Foo(Proxy):</span>
<span class="sd">            __str__ = Delegate(&#39;__str__&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">attribute</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>

<span class="c1"># attempt to load the windows registry module:</span>
<span class="n">can_read_reg</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">winreg</span>

    <span class="n">can_read_reg</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">hkey_mod</span> <span class="o">=</span> <span class="n">winreg</span>

    <span class="n">RegOpenKeyEx</span>    <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKeyEx</span>
    <span class="n">RegEnumKey</span>      <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">EnumKey</span>
    <span class="n">RegEnumValue</span>    <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">EnumValue</span>
    <span class="n">RegQueryValueEx</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValueEx</span>
    <span class="n">RegError</span>        <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">error</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">win32api</span>
        <span class="kn">import</span> <span class="nn">win32con</span>
        <span class="n">can_read_reg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">hkey_mod</span> <span class="o">=</span> <span class="n">win32con</span>

        <span class="n">RegOpenKeyEx</span>    <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">RegOpenKeyEx</span>
        <span class="n">RegEnumKey</span>      <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">RegEnumKey</span>
        <span class="n">RegEnumValue</span>    <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">RegEnumValue</span>
        <span class="n">RegQueryValueEx</span> <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">RegQueryValueEx</span>
        <span class="n">RegError</span>        <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">error</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<div class="viewcode-block" id="_NoError"><a class="viewcode-back" href="../../../SCons/#SCons.Builder._NoError">[docs]</a>        <span class="k">class</span> <span class="nc">_NoError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">pass</span></div>
        <span class="n">RegError</span> <span class="o">=</span> <span class="n">_NoError</span>


<span class="c1"># Make sure we have a definition of WindowsError so we can</span>
<span class="c1"># run platform-independent tests of Windows functionality on</span>
<span class="c1"># platforms other than Windows.  (WindowsError is, in fact, an</span>
<span class="c1"># OSError subclass on Windows.)</span>

<div class="viewcode-block" id="PlainWindowsError"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.PlainWindowsError">[docs]</a><span class="k">class</span> <span class="nc">PlainWindowsError</span><span class="p">(</span><span class="ne">OSError</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="k">try</span><span class="p">:</span>
    <span class="n">WinError</span> <span class="o">=</span> <span class="ne">WindowsError</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">WinError</span> <span class="o">=</span> <span class="n">PlainWindowsError</span>


<span class="k">if</span> <span class="n">can_read_reg</span><span class="p">:</span>
    <span class="n">HKEY_CLASSES_ROOT</span>  <span class="o">=</span> <span class="n">hkey_mod</span><span class="o">.</span><span class="n">HKEY_CLASSES_ROOT</span>
    <span class="n">HKEY_LOCAL_MACHINE</span> <span class="o">=</span> <span class="n">hkey_mod</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span>
    <span class="n">HKEY_CURRENT_USER</span>  <span class="o">=</span> <span class="n">hkey_mod</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span>
    <span class="n">HKEY_USERS</span>         <span class="o">=</span> <span class="n">hkey_mod</span><span class="o">.</span><span class="n">HKEY_USERS</span>

    <span class="k">def</span> <span class="nf">RegGetValue</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This utility function returns a value in the registry</span>
<span class="sd">        without having to open the key first.  Only available on</span>
<span class="sd">        Windows platforms with a version of Python that can read the</span>
<span class="sd">        registry.  Returns the same thing as</span>
<span class="sd">        SCons.Util.RegQueryValueEx, except you just specify the entire</span>
<span class="sd">        path to the value, and don&#39;t have to bother opening the key</span>
<span class="sd">        first.  So:</span>

<span class="sd">        Instead of:</span>
<span class="sd">          k = SCons.Util.RegOpenKeyEx(SCons.Util.HKEY_LOCAL_MACHINE,</span>
<span class="sd">                r&#39;SOFTWARE\Microsoft\Windows\CurrentVersion&#39;)</span>
<span class="sd">          out = SCons.Util.RegQueryValueEx(k,</span>
<span class="sd">                &#39;ProgramFilesDir&#39;)</span>

<span class="sd">        You can write:</span>
<span class="sd">          out = SCons.Util.RegGetValue(SCons.Util.HKEY_LOCAL_MACHINE,</span>
<span class="sd">                r&#39;SOFTWARE\Microsoft\Windows\CurrentVersion\ProgramFilesDir&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># I would use os.path.split here, but it&#39;s not a filesystem</span>
        <span class="c1"># path...</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">keyp</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>          <span class="c1"># -1 to omit trailing slash</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">p</span><span class="p">:]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">RegOpenKeyEx</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">keyp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RegQueryValueEx</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">HKEY_CLASSES_ROOT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">HKEY_LOCAL_MACHINE</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">HKEY_CURRENT_USER</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">HKEY_USERS</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="RegGetValue"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.RegGetValue">[docs]</a>    <span class="k">def</span> <span class="nf">RegGetValue</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">WinError</span></div>

<div class="viewcode-block" id="RegOpenKeyEx"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.RegOpenKeyEx">[docs]</a>    <span class="k">def</span> <span class="nf">RegOpenKeyEx</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">WinError</span></div>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">WhereIs</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pathext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATHEXT&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">pathext</span> <span class="o">=</span> <span class="s1">&#39;.COM;.EXE;.BAT;.CMD&#39;</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">pathext</span><span class="p">):</span>
            <span class="n">pathext</span> <span class="o">=</span> <span class="n">pathext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">):]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">pathext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">reject</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">reject</span><span class="p">):</span>
            <span class="n">reject</span> <span class="o">=</span> <span class="p">[</span><span class="n">reject</span><span class="p">]</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">:</span>
                <span class="n">fext</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="n">ext</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fext</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">reject</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fext</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">fext</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;os2&#39;</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">WhereIs</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pathext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;.cmd&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">):]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">pathext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">reject</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">reject</span><span class="p">):</span>
            <span class="n">reject</span> <span class="o">=</span> <span class="p">[</span><span class="n">reject</span><span class="p">]</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">:</span>
                <span class="n">fext</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="n">ext</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fext</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">reject</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fext</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">fext</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">else</span><span class="p">:</span>

<div class="viewcode-block" id="WhereIs"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.WhereIs">[docs]</a>    <span class="k">def</span> <span class="nf">WhereIs</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="p">[]):</span>
        <span class="kn">import</span> <span class="nn">stat</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">reject</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">reject</span><span class="p">):</span>
            <span class="n">reject</span> <span class="o">=</span> <span class="p">[</span><span class="n">reject</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="c1"># os.stat() raises OSError, not IOError if the file</span>
                    <span class="c1"># doesn&#39;t exist, so in this case we let IOError get</span>
                    <span class="c1"># raised so as to not mask possibly serious disk or</span>
                    <span class="c1"># network issues.</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IMODE</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_MODE</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mo">0o111</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">reject</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PrependPath"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.PrependPath">[docs]</a><span class="k">def</span> <span class="nf">PrependPath</span><span class="p">(</span><span class="n">oldpath</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">,</span>
                <span class="n">delete_existing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">canonicalize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This prepends newpath elements to the given oldpath.  Will only</span>
<span class="sd">    add any particular path once (leaving the first one it encounters</span>
<span class="sd">    and ignoring the rest, to preserve path order), and will</span>
<span class="sd">    os.path.normpath and os.path.normcase all paths to help assure</span>
<span class="sd">    this.  This can also handle the case where the given old path</span>
<span class="sd">    variable is a list instead of a string, in which case a list will</span>
<span class="sd">    be returned instead of a string.</span>

<span class="sd">    Example:</span>
<span class="sd">      Old Path: &quot;/foo/bar:/foo&quot;</span>
<span class="sd">      New Path: &quot;/biz/boom:/foo&quot;</span>
<span class="sd">      Result:   &quot;/biz/boom:/foo:/foo/bar&quot;</span>

<span class="sd">    If delete_existing is 0, then adding a path that exists will</span>
<span class="sd">    not move it to the beginning; it will stay where it is in the</span>
<span class="sd">    list.</span>

<span class="sd">    If canonicalize is not None, it is applied to each element of</span>
<span class="sd">    newpath before use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orig</span> <span class="o">=</span> <span class="n">oldpath</span>
    <span class="n">is_list</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">orig</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">orig</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">is_list</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">newpath</span><span class="p">):</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">newpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">newpath</span><span class="p">):</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">newpath</span> <span class="p">]</span>  <span class="c1"># might be a Dir</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">newpath</span>

    <span class="k">if</span> <span class="n">canonicalize</span><span class="p">:</span>
        <span class="n">newpaths</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">,</span> <span class="n">newpaths</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_existing</span><span class="p">:</span>
        <span class="c1"># First uniquify the old paths, making sure to</span>
        <span class="c1"># preserve the first instance (in Unix/Linux,</span>
        <span class="c1"># the first one wins), and remembering them in normpaths.</span>
        <span class="c1"># Then insert the new paths at the head of the list</span>
        <span class="c1"># if they&#39;re not already in the normpaths list.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">normpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">normpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normpaths</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normpath</span><span class="p">)</span>
        <span class="n">newpaths</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>      <span class="c1"># since we&#39;re inserting at the head</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">newpaths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">normpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">normpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normpaths</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normpath</span><span class="p">)</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">result</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">newpaths</span> <span class="o">+</span> <span class="n">paths</span> <span class="c1"># prepend new paths</span>

        <span class="n">normpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># now we add them only if they are unique</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">newpaths</span><span class="p">:</span>
            <span class="n">normpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">normpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normpaths</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normpath</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">paths</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="AppendPath"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.AppendPath">[docs]</a><span class="k">def</span> <span class="nf">AppendPath</span><span class="p">(</span><span class="n">oldpath</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">,</span>
               <span class="n">delete_existing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">canonicalize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This appends new path elements to the given old path.  Will</span>
<span class="sd">    only add any particular path once (leaving the last one it</span>
<span class="sd">    encounters and ignoring the rest, to preserve path order), and</span>
<span class="sd">    will os.path.normpath and os.path.normcase all paths to help</span>
<span class="sd">    assure this.  This can also handle the case where the given old</span>
<span class="sd">    path variable is a list instead of a string, in which case a list</span>
<span class="sd">    will be returned instead of a string.</span>

<span class="sd">    Example:</span>
<span class="sd">      Old Path: &quot;/foo/bar:/foo&quot;</span>
<span class="sd">      New Path: &quot;/biz/boom:/foo&quot;</span>
<span class="sd">      Result:   &quot;/foo/bar:/biz/boom:/foo&quot;</span>

<span class="sd">    If delete_existing is 0, then adding a path that exists</span>
<span class="sd">    will not move it to the end; it will stay where it is in the list.</span>

<span class="sd">    If canonicalize is not None, it is applied to each element of</span>
<span class="sd">    newpath before use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orig</span> <span class="o">=</span> <span class="n">oldpath</span>
    <span class="n">is_list</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">orig</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">orig</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">is_list</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">newpath</span><span class="p">):</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">newpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">newpath</span><span class="p">):</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">newpath</span> <span class="p">]</span>  <span class="c1"># might be a Dir</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">newpath</span>

    <span class="k">if</span> <span class="n">canonicalize</span><span class="p">:</span>
        <span class="n">newpaths</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">,</span> <span class="n">newpaths</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_existing</span><span class="p">:</span>
        <span class="c1"># add old paths to result, then</span>
        <span class="c1"># add new paths if not already present</span>
        <span class="c1"># (I thought about using a dict for normpaths for speed,</span>
        <span class="c1"># but it&#39;s not clear hashing the strings would be faster</span>
        <span class="c1"># than linear searching these typically short lists.)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">newpaths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">normpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">normpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normpaths</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normpath</span><span class="p">)</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># start w/ new paths, add old ones if not present,</span>
        <span class="c1"># then reverse.</span>
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">paths</span> <span class="o">+</span> <span class="n">newpaths</span> <span class="c1"># append new paths</span>
        <span class="n">newpaths</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="n">normpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># now we add them only if they are unique</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">newpaths</span><span class="p">:</span>
            <span class="n">normpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">normpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normpaths</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">normpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normpath</span><span class="p">)</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">paths</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span></div>

<div class="viewcode-block" id="AddPathIfNotExists"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.AddPathIfNotExists">[docs]</a><span class="k">def</span> <span class="nf">AddPathIfNotExists</span><span class="p">(</span><span class="n">env_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function will take &#39;key&#39; out of the dictionary</span>
<span class="sd">    &#39;env_dict&#39;, then add the path &#39;path&#39; to that key if it is not</span>
<span class="sd">    already there.  This treats the value of env_dict[key] as if it</span>
<span class="sd">    has a similar format to the PATH variable...a list of paths</span>
<span class="sd">    separated by tokens.  The &#39;path&#39; will get added to the list if it</span>
<span class="sd">    is not already there.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">is_list</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">env_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">env_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">is_list</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">,</span> <span class="n">paths</span><span class="p">)):</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">path</span> <span class="p">]</span> <span class="o">+</span> <span class="n">paths</span>
        <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
            <span class="n">env_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">env_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span></div>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;cygwin&#39;</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_native_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms an absolute path into a native path for the system.  In</span>
<span class="sd">        Cygwin, this converts from a Cygwin path to a Windows one.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;cygpath -w &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">npath</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">npath</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="get_native_path"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.get_native_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_native_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transforms an absolute path into a native path for the system.</span>
<span class="sd">        Non-Cygwin version, just leave the path alone.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path</span></div>

<span class="n">display</span> <span class="o">=</span> <span class="n">DisplayEngine</span><span class="p">()</span>

<div class="viewcode-block" id="Split"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Split">[docs]</a><span class="k">def</span> <span class="nf">Split</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_Tuple</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arg</span>
    <span class="k">elif</span> <span class="n">is_String</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span></div>

<div class="viewcode-block" id="CLVar"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.CLVar">[docs]</a><span class="k">class</span> <span class="nc">CLVar</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class for command-line construction variables.</span>

<span class="sd">    This is a list that uses Split() to split an initial string along</span>
<span class="sd">    white-space arguments, and similarly to split any strings that get</span>
<span class="sd">    added.  This allows us to Do the Right Thing with Append() and</span>
<span class="sd">    Prepend() (as well as straight Python foo = env[&#39;VAR&#39;] + &#39;arg1</span>
<span class="sd">    arg2&#39;) regardless of whether a user adds a list or a string to a</span>
<span class="sd">    command-line construction variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Split</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CLVar</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CLVar</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="Selector"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Selector">[docs]</a><span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A callable ordered dictionary that maps file suffixes to</span>
<span class="sd">    dictionary values.  We preserve the order in which items are added</span>
<span class="sd">    so that get_suffix() calls always return the first suffix added.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_suffix</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Try to perform Environment substitution on the keys of</span>
            <span class="c1"># the dictionary before giving up.</span>
            <span class="n">s_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">s_k</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s_k</span> <span class="ow">in</span> <span class="n">s_dict</span><span class="p">:</span>
                        <span class="c1"># We only raise an error when variables point</span>
                        <span class="c1"># to the same suffix.  If one suffix is literal</span>
                        <span class="c1"># and a variable suffix contains this literal,</span>
                        <span class="c1"># the literal wins and we don&#39;t raise an error.</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">s_dict</span><span class="p">[</span><span class="n">s_k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">s_k</span><span class="p">)</span>
                    <span class="n">s_dict</span><span class="p">[</span><span class="n">s_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s_dict</span><span class="p">[</span><span class="n">ext</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span></div>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;cygwin&#39;</span><span class="p">:</span>
    <span class="c1"># On Cygwin, os.path.normcase() lies, so just report back the</span>
    <span class="c1"># fact that the underlying Windows OS is case-insensitive.</span>
    <span class="k">def</span> <span class="nf">case_sensitive_suffixes</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="case_sensitive_suffixes"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.case_sensitive_suffixes">[docs]</a>    <span class="k">def</span> <span class="nf">case_sensitive_suffixes</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span></div>

<div class="viewcode-block" id="adjustixes"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.adjustixes">[docs]</a><span class="k">def</span> <span class="nf">adjustixes</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">pre</span><span class="p">,</span> <span class="n">suf</span><span class="p">,</span> <span class="n">ensure_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pre</span><span class="p">:</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fn</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">pre</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">pre</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pre</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="c1"># Only append a suffix if the suffix we&#39;re going to add isn&#39;t already</span>
    <span class="c1"># there, and if either we&#39;ve been asked to ensure the specific suffix</span>
    <span class="c1"># is present or there&#39;s no suffix on it at all.</span>
    <span class="k">if</span> <span class="n">suf</span> <span class="ow">and</span> <span class="n">fname</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">suf</span><span class="p">):]</span> <span class="o">!=</span> <span class="n">suf</span> <span class="ow">and</span> \
       <span class="p">(</span><span class="n">ensure_suffix</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">suf</span>
    <span class="k">return</span> <span class="n">fname</span></div>



<span class="c1"># From Tim Peters,</span>
<span class="c1"># http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/52560</span>
<span class="c1"># ASPN: Python Cookbook: Remove duplicates from a sequence</span>
<span class="c1"># (Also in the printed Python Cookbook.)</span>

<div class="viewcode-block" id="unique"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.unique">[docs]</a><span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a list of the elements in s, but without duplicates.</span>

<span class="sd">    For example, unique([1,2,3,1,2,3]) is some permutation of [1,2,3],</span>
<span class="sd">    unique(&quot;abcabc&quot;) some permutation of [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;], and</span>
<span class="sd">    unique(([1, 2], [2, 3], [1, 2])) some permutation of</span>
<span class="sd">    [[2, 3], [1, 2]].</span>

<span class="sd">    For best speed, all sequence elements should be hashable.  Then</span>
<span class="sd">    unique() will usually work in linear time.</span>

<span class="sd">    If not possible, the sequence elements should enjoy a total</span>
<span class="sd">    ordering, and if list(s).sort() doesn&#39;t raise TypeError it&#39;s</span>
<span class="sd">    assumed that they do enjoy a total ordering.  Then unique() will</span>
<span class="sd">    usually work in O(N*log2(N)) time.</span>

<span class="sd">    If that&#39;s not possible either, the sequence elements must support</span>
<span class="sd">    equality-testing.  Then unique() will usually work in quadratic</span>
<span class="sd">    time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Try using a dict first, as that&#39;s the fastest and will usually</span>
    <span class="c1"># work.  If it doesn&#39;t work, it will usually fail quickly, so it</span>
    <span class="c1"># usually doesn&#39;t cost much to *try* it.  It requires that all the</span>
    <span class="c1"># sequence elements be hashable, and support equality comparison.</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">u</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c1"># move on to the next method</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">del</span> <span class="n">u</span>

    <span class="c1"># We can&#39;t hash all the elements.  Second fastest is to sort,</span>
    <span class="c1"># which brings the equal elements together; then duplicates are</span>
    <span class="c1"># easy to weed out in a single pass.</span>
    <span class="c1"># NOTE:  Python&#39;s list.sort() was designed to be efficient in the</span>
    <span class="c1"># presence of many duplicate elements.  This isn&#39;t true of all</span>
    <span class="c1"># sort functions in all languages or libraries, so this approach</span>
    <span class="c1"># is more effective in Python than it may be elsewhere.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c1"># move on to the next method</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lasti</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">last</span><span class="p">:</span>
                <span class="n">t</span><span class="p">[</span><span class="n">lasti</span><span class="p">]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lasti</span> <span class="o">=</span> <span class="n">lasti</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">[:</span><span class="n">lasti</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">t</span>

    <span class="c1"># Brute force is all that&#39;s left.</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
            <span class="n">u</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span></div>



<span class="c1"># From Alex Martelli,</span>
<span class="c1"># http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/52560</span>
<span class="c1"># ASPN: Python Cookbook: Remove duplicates from a sequence</span>
<span class="c1"># First comment, dated 2001/10/13.</span>
<span class="c1"># (Also in the printed Python Cookbook.)</span>
<span class="c1"># This not currently used, in favor of the next function...</span>

<div class="viewcode-block" id="uniquer"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.uniquer">[docs]</a><span class="k">def</span> <span class="nf">uniquer</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">idfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">default_idfun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">idfun</span><span class="p">:</span>
        <span class="n">idfun</span> <span class="o">=</span> <span class="n">default_idfun</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">idfun</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="c1"># in old Python versions:</span>
        <span class="c1"># if seen.has_key(marker)</span>
        <span class="c1"># but in new ones:</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">marker</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>

<span class="c1"># A more efficient implementation of Alex&#39;s uniquer(), this avoids the</span>
<span class="c1"># idfun() argument and function-call overhead by assuming that all</span>
<span class="c1"># items in the sequence are hashable.</span>

<div class="viewcode-block" id="uniquer_hashables"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.uniquer_hashables">[docs]</a><span class="k">def</span> <span class="nf">uniquer_hashables</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
        <span class="c1">#if not item in seen:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>


<span class="c1"># Recipe 19.11 &quot;Reading Lines with Continuation Characters&quot;,</span>
<span class="c1"># by Alex Martelli, straight from the Python CookBook (2nd edition).</span>
<div class="viewcode-block" id="logical_lines"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.logical_lines">[docs]</a><span class="k">def</span> <span class="nf">logical_lines</span><span class="p">(</span><span class="n">physical_lines</span><span class="p">,</span> <span class="n">joiner</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">):</span>
    <span class="n">logical_line</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">physical_lines</span><span class="p">:</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="c1"># a line which continues w/the next physical line</span>
            <span class="n">logical_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a line which does not continue, end of logical line</span>
            <span class="n">logical_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">joiner</span><span class="p">(</span><span class="n">logical_line</span><span class="p">)</span>
            <span class="n">logical_line</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">logical_line</span><span class="p">:</span>
        <span class="c1"># end of sequence implies end of last logical line</span>
        <span class="k">yield</span> <span class="n">joiner</span><span class="p">(</span><span class="n">logical_line</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogicalLines"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.LogicalLines">[docs]</a><span class="k">class</span> <span class="nc">LogicalLines</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Wrapper class for the logical_lines method.</span>

<span class="sd">        Allows us to read all &quot;logical&quot; lines at once from a</span>
<span class="sd">        given file object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>

<div class="viewcode-block" id="LogicalLines.readlines"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.LogicalLines.readlines">[docs]</a>    <span class="k">def</span> <span class="nf">readlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">logical_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="UniqueList"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList">[docs]</a><span class="k">class</span> <span class="nc">UniqueList</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">__make_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">uniquer_hashables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="n">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="n">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">UserList</span><span class="o">.</span><span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">result</span>
<div class="viewcode-block" id="UniqueList.append"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span></div>
<div class="viewcode-block" id="UniqueList.insert"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span></div>
<div class="viewcode-block" id="UniqueList.count"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>
<div class="viewcode-block" id="UniqueList.index"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>
<div class="viewcode-block" id="UniqueList.reverse"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.reverse">[docs]</a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="n">UserList</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
<div class="viewcode-block" id="UniqueList.sort"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_unique</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">UserList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div>
<div class="viewcode-block" id="UniqueList.extend"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.UniqueList.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">UserList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="Unbuffered"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Unbuffered">[docs]</a><span class="k">class</span> <span class="nc">Unbuffered</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A proxy class that wraps a file object, flushing after every write,</span>
<span class="sd">    and delegating everything else to the wrapped object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softspace</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">## backward compatibility; not supported in Py3k</span>
<div class="viewcode-block" id="Unbuffered.write"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Unbuffered.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># Stdout might be connected to a pipe that has been closed</span>
            <span class="c1"># by now. The most likely reason for the pipe being closed</span>
            <span class="c1"># is that the user has press ctrl-c. It this is the case,</span>
            <span class="c1"># then SCons is currently shutdown. We therefore ignore</span>
            <span class="c1"># IOError&#39;s here so that SCons can continue and shutdown</span>
            <span class="c1"># properly so that the .sconsign is correctly written</span>
            <span class="c1"># before SCons exits.</span>
            <span class="k">pass</span></div>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></div>

<div class="viewcode-block" id="make_path_relative"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.make_path_relative">[docs]</a><span class="k">def</span> <span class="nf">make_path_relative</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; makes an absolute path name to a relative pathname.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">drive_s</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitdrive</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">re</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">drive_s</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;/*(.*)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">assert</span><span class="p">(</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span> <span class="n">path</span> <span class="p">)</span> <span class="p">),</span> <span class="n">path</span>
    <span class="k">return</span> <span class="n">path</span></div>



<span class="c1"># The original idea for AddMethod() and RenameFunction() come from the</span>
<span class="c1"># following post to the ActiveState Python Cookbook:</span>
<span class="c1">#</span>
<span class="c1">#   ASPN: Python Cookbook : Install bound methods in an instance</span>
<span class="c1">#   http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/223613</span>
<span class="c1">#</span>
<span class="c1"># That code was a little fragile, though, so the following changes</span>
<span class="c1"># have been wrung on it:</span>
<span class="c1">#</span>
<span class="c1"># * Switched the installmethod() &quot;object&quot; and &quot;function&quot; arguments,</span>
<span class="c1">#   so the order reflects that the left-hand side is the thing being</span>
<span class="c1">#   &quot;assigned to&quot; and the right-hand side is the value being assigned.</span>
<span class="c1">#</span>
<span class="c1"># * Changed explicit type-checking to the &quot;try: klass = object.__class__&quot;</span>
<span class="c1">#   block in installmethod() below so that it still works with the</span>
<span class="c1">#   old-style classes that SCons uses.</span>
<span class="c1">#</span>
<span class="c1"># * Replaced the by-hand creation of methods and functions with use of</span>
<span class="c1">#   the &quot;new&quot; module, as alluded to in Alex Martelli&#39;s response to the</span>
<span class="c1">#   following Cookbook post:</span>
<span class="c1">#</span>
<span class="c1">#   ASPN: Python Cookbook : Dynamically added methods to a class</span>
<span class="c1">#   http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/81732</span>

<div class="viewcode-block" id="AddMethod"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.AddMethod">[docs]</a><span class="k">def</span> <span class="nf">AddMethod</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds either a bound method to an instance or the function itself (or an unbound method in Python 2) to a class.</span>
<span class="sd">    If name is ommited the name of the specified function</span>
<span class="sd">    is used by default.</span>

<span class="sd">    Example::</span>

<span class="sd">        a = A()</span>
<span class="sd">        def f(self, x, y):</span>
<span class="sd">        self.z = x + y</span>
<span class="sd">        AddMethod(f, A, &quot;add&quot;)</span>
<span class="sd">        a.add(2, 4)</span>
<span class="sd">        print(a.z)</span>
<span class="sd">        AddMethod(lambda self, i: self.l[i], a, &quot;listIndex&quot;)</span>
<span class="sd">        print(a.listIndex(5))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">function</span> <span class="o">=</span> <span class="n">RenameFunction</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># Note the Python version checks - WLB</span>
    <span class="c1"># Python 3.3 dropped the 3rd parameter from types.MethodType</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">:</span>
        <span class="c1"># &quot;obj&quot; is an instance, so it gets a bound method.</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Handle classes</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">function</span>

    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="RenameFunction"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.RenameFunction">[docs]</a><span class="k">def</span> <span class="nf">RenameFunction</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a function identical to the specified function, but with</span>
<span class="sd">    the specified name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FunctionType</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
                        <span class="n">function</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">function</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span></div>


<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span> <span class="s1">&#39;md5&#39;</span><span class="p">):</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">MD5signature</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate md5 signature of a string</span>

<span class="sd">        :param s: either string or bytes. Normally should be bytes</span>
<span class="sd">        :return: String of hex digits representing the signature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">MD5filesignature</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">65536</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the md5 signature of a file</span>

<span class="sd">        :param fname: file to hash</span>
<span class="sd">        :param chunksize: chunk size to read</span>
<span class="sd">        :return: String of Hex digits representing the signature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">blck</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">blck</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">blck</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># if md5 algorithm not available, just return data unmodified</span>
    <span class="c1"># could add alternative signature scheme here</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="MD5signature"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.MD5signature">[docs]</a>    <span class="k">def</span> <span class="nf">MD5signature</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="MD5filesignature"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.MD5filesignature">[docs]</a>    <span class="k">def</span> <span class="nf">MD5filesignature</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">65536</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="MD5collect"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.MD5collect">[docs]</a><span class="k">def</span> <span class="nf">MD5collect</span><span class="p">(</span><span class="n">signatures</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collects a list of signatures into an aggregate signature.</span>

<span class="sd">    signatures - a list of signatures</span>
<span class="sd">    returns - the aggregate signature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signatures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">signatures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MD5signature</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">signatures</span><span class="p">))</span></div>


<div class="viewcode-block" id="silent_intern"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.silent_intern">[docs]</a><span class="k">def</span> <span class="nf">silent_intern</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform sys.intern() on the passed argument and return the result.</span>
<span class="sd">    If the input is ineligible the original argument is</span>
<span class="sd">    returned and no exception is thrown.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">intern</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span></div>


<span class="c1"># From Dinu C. Gherman,</span>
<span class="c1"># Python Cookbook, second edition, recipe 6.17, p. 277.</span>
<span class="c1"># Also:</span>
<span class="c1"># http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/68205</span>
<span class="c1"># ASPN: Python Cookbook: Null Object Design Pattern</span>

<div class="viewcode-block" id="Null"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.Null">[docs]</a><span class="k">class</span> <span class="nc">Null</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Null objects always and reliably &quot;do nothing.&quot; &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;_instance&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Null</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Null(0x</span><span class="si">%08X</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="NullSeq"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.NullSeq">[docs]</a><span class="k">class</span> <span class="nc">NullSeq</span><span class="p">(</span><span class="n">Null</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A Null object that can also be iterated over. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(())</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="k">del</span> <span class="n">__revision__</span>


<div class="viewcode-block" id="to_bytes"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.to_bytes">[docs]</a><span class="k">def</span> <span class="nf">to_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;None&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
        <span class="c1"># if already bytes return.</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="to_str"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.to_str">[docs]</a><span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="cmp"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.cmp">[docs]</a><span class="k">def</span> <span class="nf">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define cmp because it&#39;s no longer available in python3</span>
<span class="sd">    Works under python 2 as well</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_env_bool"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.get_env_bool">[docs]</a><span class="k">def</span> <span class="nf">get_env_bool</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a construction variable to bool.</span>

<span class="sd">    If the value of *name* in *env* is &#39;true&#39;, &#39;yes&#39;, &#39;y&#39;, &#39;on&#39; (case</span>
<span class="sd">    insensitive) or anything convertible to int that yields non-zero then</span>
<span class="sd">    return True; if &#39;false&#39;, &#39;no&#39;, &#39;n&#39;, &#39;off&#39; (case insensitive)</span>
<span class="sd">    or a number that converts to integer zero return False.</span>
<span class="sd">    Otherwise, return *default*.</span>

<span class="sd">    Args:</span>
<span class="sd">        env: construction environment, or any dict-like object</span>
<span class="sd">        name: name of the variable</span>
<span class="sd">        default: value to return if *name* not in *env* or cannot</span>
<span class="sd">          be converted (default: False)</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: the &quot;truthiness&quot; of *name*</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span></div>


<div class="viewcode-block" id="get_os_env_bool"><a class="viewcode-back" href="../../../SCons/#SCons.Builder.get_os_env_bool">[docs]</a><span class="k">def</span> <span class="nf">get_os_env_bool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert an environment variable to bool.</span>

<span class="sd">    Conversion is the same as for :func:`get_env_bool`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_env_bool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<span class="c1"># Local Variables:</span>
<span class="c1"># tab-width:4</span>
<span class="c1"># indent-tabs-mode:nil</span>
<span class="c1"># End:</span>
<span class="c1"># vim: set expandtab tabstop=4 shiftwidth=4:</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, SCons Project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>