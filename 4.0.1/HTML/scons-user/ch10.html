<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 10. Controlling a Build From the Command Line</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 4.0.1"><link rel="up" href="index.html" title="SCons 4.0.1"><link rel="prev" href="ch09s04.html" title="9.4. Printing Detailed Build Status: the GetBuildFailures Function"><link rel="next" href="ch10s02.html" title="10.2. Command-Line variable=value Build Variables"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 10. Controlling a Build From the Command Line</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09s04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch10s02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 10. Controlling a Build From the Command Line"><div class="titlepage"><div><div><h2 class="title"><a name="chap-command-line"></a>Chapter 10. Controlling a Build From the Command Line</h2></div></div></div><p>

  <span class="application">SCons</span> provides a number of ways
  for the writer of the <code class="filename">SConscript</code> files
  to give the users who will run <span class="application">SCons</span>
  a great deal of control over the build execution.
  The arguments that the user can specify on
  the command line are broken down into three types:

  </p><div class="variablelist"><dl><dt><span class="term">Options</span></dt><dd><p>

    Command-line options always begin with
    one or two <code class="literal">-</code> (hyphen) characters.
    <span class="application">SCons</span> provides ways for you to examine
    and set options values from within your <code class="filename">SConscript</code> files,
    as well as the ability to define your own
    custom options.
    See <a class="xref" href="ch10.html#sect-command-line-options" title="10.1. Command-Line Options">Section 10.1, &#8220;Command-Line Options&#8221;</a>, below.

    </p></dd><dt><span class="term">Variables</span></dt><dd><p>

    Any command-line argument containing an <code class="literal">=</code>
    (equal sign) is considered a variable setting with the form
    <code class="varname">variable</code>=<em class="replaceable"><code>value</code></em>.
    <span class="application">SCons</span> provides direct access to
    all of the command-line variable settings,
    the ability to apply command-line variable settings
    to construction environments,
    and functions for configuring
    specific types of variables
    (Boolean values, path names, etc.)
    with automatic validation of the user's specified values.
    See <a class="xref" href="ch10s02.html" title="10.2. Command-Line variable=value Build Variables">Section 10.2, &#8220;Command-Line <code class="varname">variable</code>=<em class="replaceable"><code>value</code></em> Build Variables&#8221;</a>, below.

    </p></dd><dt><span class="term">Targets</span></dt><dd><p>

    Any command-line argument that is not an option
    or a variable setting
    (does not begin with a hyphen
    and does not contain an equal sign)
    is considered a target that the user
    (presumably) wants <span class="application">SCons</span> to build.
    A list of Node objects representing
    the target or targets to build.
    <span class="application">SCons</span> provides access to the list of specified targets,
    as well as ways to set the default list of targets
    from within the <code class="filename">SConscript</code> files.
    See <a class="xref" href="ch10s03.html" title="10.3. Command-Line Targets">Section 10.3, &#8220;Command-Line Targets&#8221;</a>, below.

    </p></dd></dl></div><div class="section" title="10.1. Command-Line Options"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect-command-line-options"></a>10.1. Command-Line Options</h2></div></div></div><p>

    <span class="application">SCons</span> has many <span class="emphasis"><em>command-line options</em></span>
    that control its behavior.
    A <span class="application">SCons</span> <span class="emphasis"><em>command-line option</em></span>
    always begins with one or two hyphen (<code class="literal">-</code>)
    characters.

    </p><div class="section" title="10.1.1. Not Having to Specify Command-Line Options Each Time: the SCONSFLAGS Environment Variable"><div class="titlepage"><div><div><h3 class="title"><a name="idp140430764978328"></a>10.1.1. Not Having to Specify Command-Line Options Each Time:  the <code class="varname">SCONSFLAGS</code> Environment Variable</h3></div></div></div><p>

      Users may find themselves supplying
      the same command-line options every time
      they run <span class="application">SCons</span>.
      For example, you might find it saves time
      to specify a value of <code class="option">-j 2</code>
      to have <span class="application">SCons</span> run up to two build commands in parallel.
      To avoid having to type <code class="option">-j 2</code> by hand
      every time,
      you can set the external environment variable
      <code class="varname">SCONSFLAGS</code> to a string containing
      command-line options that you want <span class="application">SCons</span> to use.

      </p><p>

      If, for example,
      you're using a POSIX shell that's
      compatible with the Bourne shell,
      and you always want <span class="application">SCons</span> to use the
      <code class="option">-Q</code> option,
      you can set the <code class="varname">SCONSFLAGS</code>
      environment as follows:

      </p><pre class="screen">% <strong class="userinput"><code>scons</code></strong>
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
    ... [build output] ...
scons: done building targets.
% <strong class="userinput"><code>export SCONSFLAGS="-Q"</code></strong>
% <strong class="userinput"><code>scons</code></strong>
    ... [build output] ...
</pre><p>

      Users of <span class="application">csh</span>-style shells on POSIX systems
      can set the <code class="varname">SCONSFLAGS</code> environment variable as follows:

      </p><pre class="screen">
$ <strong class="userinput"><code>setenv SCONSFLAGS "-Q"</code></strong>
      </pre><p>

      Windows users may typically want to set the
      <code class="varname">SCONSFLAGS</code> in the appropriate tab of the
      <code class="literal">System Properties</code> window.

      </p></div><div class="section" title="10.1.2. Getting Values Set by Command-Line Options: the GetOption Function"><div class="titlepage"><div><div><h3 class="title"><a name="idp140430764990008"></a>10.1.2. Getting Values Set by Command-Line Options:  the <code class="function">GetOption</code> Function</h3></div></div></div><p>

      <span class="application">SCons</span> provides the <a class="link" href="apd.html#f-GetOption"><code class="function">GetOption</code></a> function
      to get the values set by the various command-line options.

      </p><p>

      One use case for <code class="function">GetOption</code> is to check whether or not
      the <code class="option">-h</code> or <code class="option">--help</code> option
      has been specified.
      Normally, <span class="application">SCons</span> does not print its help text
      until after it has read all of the SConscript files,
      because it's possible that help text has been added
      by some subsidiary SConscript file deep in the
      source tree hierarchy.
      Of course, reading all of the SConscript files
      takes extra time.
      If you know that your configuration does not define
      any additional help text in subsidiary SConscript files,
      you can speed up the command-line help available to users
      by using the <code class="function">GetOption</code> function to load the
      subsidiary SConscript files only if the
      the user has <span class="emphasis"><em>not</em></span> specified
      the <code class="option">-h</code> or <code class="option">--help</code> option,
      like so:

      </p><pre class="programlisting">
if not GetOption('help'):
    SConscript('src/SConscript', export='env')
      </pre><p>

      In general, the string that you pass to the
      <code class="function">GetOption</code> function to fetch the value of a command-line
      option setting is the same as the "most common" long option name
      (beginning with two hyphen characters),
      although there are some exceptions.
      The list of <span class="application">SCons</span> command-line options
      and the <code class="function">GetOption</code> strings for fetching them,
      are available in the
      <a class="xref" href="ch10.html#sect-command-line-option-strings" title="10.1.4. Strings for Getting or Setting Values of SCons Command-Line Options">Section 10.1.4, &#8220;Strings for Getting or Setting Values of <span class="application">SCons</span> Command-Line Options&#8221;</a> section,
      below.

      </p><p>

      <code class="function">GetOption</code> can be used to retrieve the values of options
      defined by calls to <a class="link" href="apd.html#f-AddOption"><code class="function">AddOption</code></a>. A <code class="function">GetOption</code> call
      must appear after the <code class="function">AddOption</code> call for that option.
      If the <code class="function">AddOption</code> call supplied a <em class="parameter"><code>dest</code></em>
      keyword argument, a string with that name is what to pass
      as the argument to <code class="function">GetOption</code>, otherwise it is a
      (possibly modified) version of the first long option name -
      see <a class="link" href="apd.html#f-AddOption"><code class="function">AddOption</code></a>.

      </p></div><div class="section" title="10.1.3. Setting Values of Command-Line Options: the SetOption Function"><div class="titlepage"><div><div><h3 class="title"><a name="idp140430765004504"></a>10.1.3. Setting Values of Command-Line Options:  the <code class="function">SetOption</code> Function</h3></div></div></div><p>

      You can also set the values of <span class="application">SCons</span>
      command-line options from within the <code class="filename">SConscript</code> files
      by using the <a class="link" href="apd.html#f-SetOption"><code class="function">SetOption</code></a> function.
      The strings that you use to set the values of <span class="application">SCons</span>
      command-line options are available in the
      <a class="xref" href="ch10.html#sect-command-line-option-strings" title="10.1.4. Strings for Getting or Setting Values of SCons Command-Line Options">Section 10.1.4, &#8220;Strings for Getting or Setting Values of <span class="application">SCons</span> Command-Line Options&#8221;</a> section,
      below.

      </p><p>

      One use of the <code class="function">SetOption</code> function is to
      specify a value for the <code class="option">-j</code>
      or <code class="option">--jobs</code> option,
      so that users get the improved performance
      of a parallel build without having to specify the option by hand.
      A complicating factor is that a good value
      for the <code class="option">-j</code> option is
      somewhat system-dependent.
      One rough guideline is that the more processors
      your system has,
      the higher you want to set the
      <code class="option">-j</code> value,
      in order to take advantage of the number of CPUs.

      </p><p>

      For example, suppose the administrators
      of your development systems
      have standardized on setting a
      <code class="envar">NUM_CPU</code> environment variable
      to the number of processors on each system.
      A little bit of Python code
      to access the environment variable
      and the <code class="function">SetOption</code> function
      provide the right level of flexibility:

      </p><pre class="programlisting">
import os
num_cpu = int(os.environ.get('NUM_CPU', 2))
SetOption('num_jobs', num_cpu)
print("running with -j %s"%GetOption('num_jobs'))
        </pre><p>

      The above snippet of code
      sets the value of the <code class="option">--jobs</code> option
      to the value specified in the
      <code class="varname">NUM_CPU</code> environment variable.
      (This is one of the exception cases
      where the string is spelled differently from
      the from command-line option.
      The string for fetching or setting the <code class="option">--jobs</code>
      value is <code class="literal">num_jobs</code>
      for historical reasons.)
      The code in this example prints the <code class="literal">num_jobs</code>
      value for illustrative purposes.
      It uses a default value of <code class="literal">2</code>
      to provide some minimal parallelism even on
      single-processor systems:

      </p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
running with -j 2
scons: `.' is up to date.
</pre><p>

      But if the <code class="envar">NUM_CPU</code>
      environment variable is set,
      then we use that for the default number of jobs:

      </p><pre class="screen">% <strong class="userinput"><code>export NUM_CPU="4"</code></strong>
% <strong class="userinput"><code>scons -Q</code></strong>
running with -j 4
scons: `.' is up to date.
</pre><p>

      But any explicit
      <code class="option">-j</code> or <code class="option">--jobs</code>
      value the user specifies an the command line is used first,
      regardless of whether or not
      the <code class="envar">NUM_CPU</code> environment
      variable is set:

      </p><pre class="screen">% <strong class="userinput"><code>scons -Q -j 7</code></strong>
running with -j 7
scons: `.' is up to date.
% <strong class="userinput"><code>export NUM_CPU="4"</code></strong>
% <strong class="userinput"><code>scons -Q -j 3</code></strong>
running with -j 3
scons: `.' is up to date.
</pre></div><div class="section" title="10.1.4. Strings for Getting or Setting Values of SCons Command-Line Options"><div class="titlepage"><div><div><h3 class="title"><a name="sect-command-line-option-strings"></a>10.1.4. Strings for Getting or Setting Values of <span class="application">SCons</span> Command-Line Options</h3></div></div></div><p>

      The strings that you can pass to the <a class="link" href="apd.html#f-GetOption"><code class="function">GetOption</code></a>
      and <a class="link" href="apd.html#f-SetOption"><code class="function">SetOption</code></a> functions usually correspond to the
      first long-form option name
      (beginning with two hyphen characters:  <code class="literal">--</code>),
      after replacing any remaining hyphen characters
      with underscores.

      </p><p>

      <code class="function">SetOption</code> is not currently supported for
      options added with <code class="function">AddOption</code>.

      </p><p>

      The full list of strings and the variables they
      correspond to is as follows:

      </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">String for <code class="function">GetOption</code> and <code class="function">SetOption</code></th><th align="left">Command-Line Option(s)</th></tr></thead><tbody><tr><td align="left"><code class="literal">cache_debug</code></td><td align="left"><code class="option">--cache-debug</code></td></tr><tr><td align="left"><code class="literal">cache_disable</code></td><td align="left"><code class="option">--cache-disable</code></td></tr><tr><td align="left"><code class="literal">cache_force</code></td><td align="left"><code class="option">--cache-force</code></td></tr><tr><td align="left"><code class="literal">cache_show</code></td><td align="left"><code class="option">--cache-show</code></td></tr><tr><td align="left"><code class="literal">clean</code></td><td align="left"><code class="option">-c</code>,
           <code class="option">--clean</code>,
           <code class="option">--remove</code></td></tr><tr><td align="left"><code class="literal">config</code></td><td align="left"><code class="option">--config</code></td></tr><tr><td align="left"><code class="literal">directory</code></td><td align="left"><code class="option">-C</code>,
             <code class="option">--directory</code></td></tr><tr><td align="left"><code class="literal">diskcheck</code></td><td align="left"><code class="option">--diskcheck</code></td></tr><tr><td align="left"><code class="literal">duplicate</code></td><td align="left"><code class="option">--duplicate</code></td></tr><tr><td align="left"><code class="literal">file</code></td><td align="left"><code class="option">-f</code>,
             <code class="option">--file</code>,
             <code class="option">--makefile </code>,
             <code class="option">--sconstruct</code></td></tr><tr><td align="left"><code class="literal">help</code></td><td align="left"><code class="option">-h</code>,
             <code class="option">--help</code></td></tr><tr><td align="left"><code class="literal">ignore_errors</code></td><td align="left"><code class="option">--ignore-errors</code></td></tr><tr><td align="left"><code class="literal">implicit_cache</code></td><td align="left"><code class="option">--implicit-cache</code></td></tr><tr><td align="left"><code class="literal">implicit_deps_changed</code></td><td align="left"><code class="option">--implicit-deps-changed</code></td></tr><tr><td align="left"><code class="literal">implicit_deps_unchanged</code></td><td align="left"><code class="option">--implicit-deps-unchanged</code></td></tr><tr><td align="left"><code class="literal">interactive</code></td><td align="left"><code class="option">--interact</code>,
             <code class="option">--interactive</code></td></tr><tr><td align="left"><code class="literal">keep_going</code></td><td align="left"><code class="option">-k</code>,
             <code class="option">--keep-going</code></td></tr><tr><td align="left"><code class="literal">max_drift</code></td><td align="left"><code class="option">--max-drift</code></td></tr><tr><td align="left"><code class="literal">no_exec</code></td><td align="left"><code class="option">-n</code>,
             <code class="option">--no-exec</code>,
             <code class="option">--just-print</code>,
             <code class="option">--dry-run</code>,
             <code class="option">--recon</code></td></tr><tr><td align="left"><code class="literal">no_site_dir</code></td><td align="left"><code class="option">--no-site-dir</code></td></tr><tr><td align="left"><code class="literal">num_jobs</code></td><td align="left"><code class="option">-j</code>,
             <code class="option">--jobs</code></td></tr><tr><td align="left"><code class="literal">profile_file</code></td><td align="left"><code class="option">--profile</code></td></tr><tr><td align="left"><code class="literal">question</code></td><td align="left"><code class="option">-q</code>,
             <code class="option">--question</code></td></tr><tr><td align="left"><code class="literal">random</code></td><td align="left"><code class="option">--random</code></td></tr><tr><td align="left"><code class="literal">repository</code></td><td align="left"><code class="option">-Y</code>,
             <code class="option">--repository</code>,
             <code class="option">--srcdir</code></td></tr><tr><td align="left"><code class="literal">silent</code></td><td align="left"><code class="option">-s</code>,
             <code class="option">--silent</code>,
             <code class="option">--quiet</code></td></tr><tr><td align="left"><code class="literal">site_dir</code></td><td align="left"><code class="option">--site-dir</code></td></tr><tr><td align="left"><code class="literal">stack_size</code></td><td align="left"><code class="option">--stack-size</code></td></tr><tr><td align="left"><code class="literal">taskmastertrace_file</code></td><td align="left"><code class="option">--taskmastertrace</code></td></tr><tr><td align="left"><code class="literal">warn</code></td><td align="left"><code class="option">--warn</code> <code class="option">--warning</code></td></tr></tbody></table></div></div><div class="section" title="10.1.5. Adding Custom Command-Line Options: the AddOption Function"><div class="titlepage"><div><div><h3 class="title"><a name="idp140430764736440"></a>10.1.5. Adding Custom Command-Line Options:  the <code class="function">AddOption</code> Function</h3></div></div></div><p>

      <span class="application">SCons</span> also allows you to define your own
      command-line options with the <a class="link" href="apd.html#f-AddOption"><code class="function">AddOption</code></a> function.
      The <code class="function">AddOption</code> function takes the same arguments
      as the <code class="function">add_option</code> method
      from the standard Python library module <span class="emphasis"><em>optparse</em></span>.
      <sup>[<a name="idp140430764740248" href="#ftn.idp140430764740248" class="footnote">2</a>]</sup>
      </p><p>
      Once you have added a custom command-line option
      with the <code class="function">AddOption</code> function,
      the value of the option (if any) is immediately available
      using the standard <a class="link" href="apd.html#f-GetOption"><code class="function">GetOption</code></a> function.
      The argument to <code class="function">GetOption</code> must be the name of the
      variable which will hold the option,
      which is the value of the <em class="parameter"><code>dest</code></em>
      keyword parameter, if given. If not given, it is the name
      (without the leading hyphens) of the first long option name
      given to <code class="function">AddOption</code>
      after replacing any remaining hyphen characters
      with underscores, since hyphens are not legal in Python
      identifier names.

      </p><p>
      <code class="function">SetOption</code> is not currently supported for
      options added with <code class="function">AddOption</code>.
      
      </p><p>

      One useful example of using this functionality
      is to provide a <code class="option">--prefix</code> for users:

      </p><pre class="programlisting">
AddOption(
    '--prefix',
    dest='prefix',
    type='string',
    nargs=1,
    action='store',
    metavar='DIR',
    help='installation prefix',
)

env = Environment(PREFIX=GetOption('prefix'))

installed_foo = env.Install('$PREFIX/usr/bin', 'foo.in')
Default(installed_foo)
        </pre><p>

      The above code uses the <code class="function">GetOption</code> function
      to set the <code class="envar">$PREFIX</code>
      construction variable to any
      value that the user specifies with a command-line
      option of <code class="option">--prefix</code>.
      Because <code class="envar">$PREFIX</code>
      will expand to a null string if it's not initialized,
      running <span class="application">SCons</span> without the
      option of <code class="option">--prefix</code>
      will install the file in the
      <code class="filename">/usr/bin/</code> directory:

      </p><pre class="screen">% <strong class="userinput"><code>scons -Q -n</code></strong>
Install file: "foo.in" as "/usr/bin/foo.in"
</pre><p>

      But specifying <code class="option">--prefix=/tmp/install</code>
      on the command line causes the file to be installed in the
      <code class="filename">/tmp/install/usr/bin/</code> directory:

      </p><pre class="screen">% <strong class="userinput"><code>scons -Q -n --prefix=/tmp/install</code></strong>
Install file: "foo.in" as "/tmp/install/usr/bin/foo.in"
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Option-arguments separated from long options by whitespace,
      rather than by an <code class="literal">=</code>, cannot be correctly
      resolved by <span class="application">SCons</span>.
      While <code class="option">--input=ARG</code>
      is clearly opt followed by arg, for <code class="option">--input ARG</code>
      it is not possible to tell without instructions whether
      <em class="parameter"><code>ARG</code></em> is an argument belonging to the
      <em class="parameter"><code>input</code></em> option or a positional argument.
      <span class="application">SCons</span> treats positional arguments as either
      command-line build options or command-line targets
      which are made available for use in an <code class="filename">SConscript</code>
      (see the immediately following sections for details).
      Thus, they must be collected before <code class="filename">SConscript</code> processing
      takes place. Since <code class="function">AddOption</code> calls, which provide
      the processing instructions to resolve any ambiguity,
      happen in an <code class="filename">SConscript</code>,
      <span class="application">SCons</span> does not know in time
      for options added this way, and unexpected things will happen,
      such as option-arguments assigned as targets and/or exceptions
      due to missing option-arguments.
      </p><p>
      As a result, this usage style should be avoided when invoking
      <span class="command"><strong>scons</strong></span>.  For single-argument
      options, use the <code class="option">--input=ARG</code> form on the
      command line. For multiple-argument options
      (<em class="parameter"><code>nargs</code></em> greater than one),
      set <em class="parameter"><code>nargs</code></em> to one in
      <code class="function">AddOption</code> calls and either: combine the option-arguments into one word
      with a separator, and parse the result in your own code
      (see the built-in <code class="option">--debug</code> option, which
      allows specifying multiple arguments as a single comma-separated
      word, for an example of such usage); or allow the option to
      be specified multiple times by setting
      <code class="literal">action='append'</code>. Both methods can be
      supported at the same time.
      </p></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.idp140430764740248" href="#idp140430764740248" class="para">2</a>] </sup>
      The <code class="function">AddOption</code> function is,
      in fact, implemented using a subclass
      of <code class="classname">optparse.OptionParser</code>.
      </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09s04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch10s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.4. Printing Detailed Build Status:  the <code class="function">GetBuildFailures</code> Function </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 10.2. Command-Line <code class="varname">variable</code>=<em class="replaceable"><code>value</code></em> Build Variables</td></tr></table></div></body></html>
