<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>17.2. Simple project</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 3.0.2"><link rel="up" href="ch17.html" title="Chapter 17. Internationalization and localization with gettext"><link rel="prev" href="ch17.html" title="Chapter 17. Internationalization and localization with gettext"><link rel="next" href="ch18.html" title="Chapter 18. Writing Your Own Builders"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.2. Simple project</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch17.html">Prev</a> </td><th width="60%" align="center">Chapter 17. Internationalization and localization with gettext</th><td width="20%" align="right"> <a accesskey="n" href="ch18.html">Next</a></td></tr></table><hr></div><div class="section" title="17.2. Simple project"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140272271629776"></a>17.2. Simple project</h2></div></div></div><p>
    Let's start with a very simple project, the "Hello world" program 
    for example
    
    </p><pre class="programlisting">
/* hello.c */
#include &lt;stdio.h&gt;
int main(int argc, char* argv[])
{
  printf("Hello world\n");
  return 0;
}
    </pre><p>
    

    Prepare a <code class="filename">SConstruct</code> to compile the program
    as usual.
    
    </p><pre class="programlisting">
# SConstruct
env = Environment()
hello = Program(["hello.c"])
    </pre><p>
    
    </p><p>
    Now we'll convert the project to a multi-lingual one. If you don't
    already have <a class="ulink" href="http://www.gnu.org/software/gettext/manual/gettext.html" target="_top">GNU gettext
    utilities</a> installed, install them from your preffered
    package repository, or download from <a class="ulink" href="http://ftp.gnu.org/gnu/gettext/" target="_top">
    http://ftp.gnu.org/gnu/gettext/</a>. For the purpose of this example,
    you should have following three locales installed on your system:
    <code class="literal">en_US</code>, <code class="literal">de_DE</code> and
    <code class="literal">pl_PL</code>. On debian, for example, you may enable certain
    locales through <span class="command"><strong>dpkg-reconfigure locales</strong></span>.
    </p><p>
    First prepare the <code class="filename">hello.c</code> program for
    internationalization. Change the previous code so it reads as follows:
    
    </p><pre class="programlisting">
/* hello.c */
#include &lt;stdio.h&gt;
#include &lt;libintl.h&gt;
#include &lt;locale.h&gt;
int main(int argc, char* argv[])
{
  bindtextdomain("hello", "locale");
  setlocale(LC_ALL, "");
  textdomain("hello");
  printf(gettext("Hello world\n"));
  return 0;
}
    </pre><p>
    
    Detailed recipes for such conversion can
    be found at <a class="ulink" href="http://www.gnu.org/software/gettext/manual/gettext.html#Sources" target="_top">
    http://www.gnu.org/software/gettext/manual/gettext.html#Sources</a>.
    The <code class="function">gettext("...")</code> has two purposes.
    First, it marks messages for the <span class="command"><strong>xgettext(1)</strong></span> program, which
    we will use to extract from the sources the messages for localization.
    Second, it calls the <code class="literal">gettext</code> library internals to
    translate the message at runtime.
    </p><p> 
    Now we shall instruct SCons how to generate and maintain translation files.
    For that, use the <a class="link" href="apb.html#b-Translate"><code class="function">Translate</code></a> builder and <a class="link" href="apb.html#b-MOFiles"><code class="function">MOFiles</code></a> builder.
    The first one takes source files, extracts internationalized
    messages from them, creates so-called <code class="literal">POT</code> file
    (translation template), and then creates <code class="literal">PO</code> translation
    files, one for each requested language. Later, during the development
    lifecycle, the builder keeps all these files up-to date. The
    <a class="link" href="apb.html#b-MOFiles"><code class="function">MOFiles</code></a> builder compiles the <code class="literal">PO</code> files to binary
    form. Then install the <code class="literal">MO</code> files under directory
    called <code class="filename">locale</code>.
    </p><p>  The completed 
    <code class="filename">SConstruct</code> is as follows:
    
    </p><pre class="programlisting">
# SConstruct
env = Environment( tools = ['default', 'gettext'] )
hello = env.Program(["hello.c"])
env['XGETTEXTFLAGS'] = [
  '--package-name=%s' % 'hello',
  '--package-version=%s' % '1.0',
]
po = env.Translate(["pl","en", "de"], ["hello.c"], POAUTOINIT = 1)
mo = env.MOFiles(po)
InstallAs(["locale/en/LC_MESSAGES/hello.mo"], ["en.mo"])
InstallAs(["locale/pl/LC_MESSAGES/hello.mo"], ["pl.mo"])
InstallAs(["locale/de/LC_MESSAGES/hello.mo"], ["de.mo"])
    </pre><p>
    
    </p><p>
    Generate the translation files with <span class="command"><strong>scons po-update</strong></span>.
    You should see the output from SCons simillar to this:
    </p><pre class="screen">
user@host:$ scons po-update
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
Entering '/home/ptomulik/projects/tmp'
xgettext --package-name=hello --package-version=1.0 -o - hello.c
Leaving '/home/ptomulik/projects/tmp'
Writting 'messages.pot' (new file)
msginit --no-translator -l pl -i messages.pot -o pl.po
Created pl.po.
msginit --no-translator -l en -i messages.pot -o en.po
Created en.po.
msginit --no-translator -l de -i messages.pot -o de.po
Created de.po.
scons: done building targets.
    </pre><p>
    </p><p>
    If everything is right, you should see following new files.
    </p><pre class="screen">
user@host:$ ls *.po*
de.po  en.po  messages.pot  pl.po
    </pre><p>
    </p><p>
    Open <code class="filename">en.po</code> in <span class="command"><strong>poedit</strong></span> and provide
    the English translation to message <code class="literal">"Hello world\n"</code>. Do the
    same for <code class="filename">de.po</code> (deutsch) and
    <code class="filename">pl.po</code> (polish). Let the translations be, for example:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
        <code class="literal">en: "Welcome to beautiful world!\n"</code>
      </p></li><li class="listitem"><p>
        <code class="literal">de: "Hallo Welt!\n"</code>
      </p></li><li class="listitem"><p>
        <code class="literal">pl: "Witaj swiecie!\n"</code>
      </p></li></ul></div><p>
    </p><p>
    Now compile the project by executing <span class="command"><strong>scons</strong></span>. The
    output should be similar to this:
    </p><pre class="screen">
user@host:$ scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
msgfmt -c -o de.mo de.po
msgfmt -c -o en.mo en.po
gcc -o hello.o -c hello.c
gcc -o hello hello.o
Install file: "de.mo" as "locale/de/LC_MESSAGES/hello.mo"
Install file: "en.mo" as "locale/en/LC_MESSAGES/hello.mo"
msgfmt -c -o pl.mo pl.po
Install file: "pl.mo" as "locale/pl/LC_MESSAGES/hello.mo"
scons: done building targets.
    </pre><p>
    SCons automatically compiled the <code class="literal">PO</code> files to binary format
    <code class="literal">MO</code>, and the <code class="literal">InstallAs</code> lines installed
    these files under <code class="filename">locale</code> folder.
    </p><p>
    Your program should be now ready. You may try it as follows (linux):
    </p><pre class="screen">
user@host:$ LANG=en_US.UTF-8 ./hello
Welcome to beautiful world
    </pre><p>
    </p><pre class="screen">
user@host:$ LANG=de_DE.UTF-8 ./hello
Hallo Welt
    </pre><p>
    </p><pre class="screen">
user@host:$ LANG=pl_PL.UTF-8 ./hello
Witaj swiecie
    </pre><p>
    </p><p>
    To demonstrate the further life of translation files, let's change Polish
    translation (<span class="command"><strong>poedit pl.po</strong></span>) to <code class="literal">"Witaj drogi
    swiecie\n"</code>. Run <span class="command"><strong>scons</strong></span> to see how scons
    reacts to this
    </p><pre class="screen">
user@host:$scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
msgfmt -c -o pl.mo pl.po
Install file: "pl.mo" as "locale/pl/LC_MESSAGES/hello.mo"
scons: done building targets.
    </pre><p>
    </p><p>
    Now, open <code class="filename">hello.c</code> and add another one
    <code class="literal">printf</code> line with new message.
    
    </p><pre class="programlisting">
/* hello.c */
#include &lt;stdio.h&gt;
#include &lt;libintl.h&gt;
#include &lt;locale.h&gt;
int main(int argc, char* argv[])
{
  bindtextdomain("hello", "locale");
  setlocale(LC_ALL, "");
  textdomain("hello");
  printf(gettext("Hello world\n"));
  printf(gettext("and good bye\n"));
  return 0;
}
    </pre><p>
    
    </p><p>
    Compile project with <span class="command"><strong>scons</strong></span>. This time, the
    <span class="command"><strong>msgmerge(1)</strong></span> program is used by SCons to update
    <code class="literal">PO</code> file. The output from compilation is like:
    </p><pre class="screen">
user@host:$scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
Entering '/home/ptomulik/projects/tmp'
xgettext --package-name=hello --package-version=1.0 -o - hello.c
Leaving '/home/ptomulik/projects/tmp'
Writting 'messages.pot' (messages in file were outdated)
msgmerge --update de.po messages.pot
... done.
msgfmt -c -o de.mo de.po
msgmerge --update en.po messages.pot
... done.
msgfmt -c -o en.mo en.po
gcc -o hello.o -c hello.c
gcc -o hello hello.o
Install file: "de.mo" as "locale/de/LC_MESSAGES/hello.mo"
Install file: "en.mo" as "locale/en/LC_MESSAGES/hello.mo"
msgmerge --update pl.po messages.pot
... done.
msgfmt -c -o pl.mo pl.po
Install file: "pl.mo" as "locale/pl/LC_MESSAGES/hello.mo"
scons: done building targets.
    </pre><p>
    </p><p>
    The next example demonstrates what happens if we change the source code
    in such way that the internationalized messages do not change. The answer
    is that none of translation files (<code class="literal">POT</code>,
    <code class="literal">PO</code>) are touched (i.e. no content changes, no
    creation/modification time changed and so on). Let's append another
    line to the program (after the last printf), so its code becomes:
    
    </p><pre class="programlisting">
/* hello.c */
#include &lt;stdio.h&gt;
#include &lt;libintl.h&gt;
#include &lt;locale.h&gt;
int main(int argc, char* argv[])
{
  bindtextdomain("hello", "locale");
  setlocale(LC_ALL, "");
  textdomain("hello");
  printf(gettext("Hello world\n"));
  printf(gettext("and good bye\n"));
  printf("----------------\n");
  return a;
}
    </pre><p>
    
    Compile the project. You'll see on your screen
    </p><pre class="screen">
user@host:$scons
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
Entering '/home/ptomulik/projects/tmp'
xgettext --package-name=hello --package-version=1.0 -o - hello.c
Leaving '/home/ptomulik/projects/tmp'
Not writting 'messages.pot' (messages in file found to be up-to-date)
gcc -o hello.o -c hello.c
gcc -o hello hello.o
scons: done building targets.
    </pre><p>
    As you see, the internationalized messages ditn't change, so the
    <code class="literal">POT</code> and the rest of translation files have not
    even been touched.
    </p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch17.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch17.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch18.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 17. Internationalization and localization with gettext </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 18. Writing Your Own Builders</td></tr></table></div></body></html>
