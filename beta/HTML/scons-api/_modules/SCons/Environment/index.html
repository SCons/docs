

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCons.Environment &mdash; SCons 4.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../" class="icon icon-home"> SCons
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons/">SCons package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Action">SCons.Action module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Builder">SCons.Builder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.CacheDir">SCons.CacheDir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Conftest">SCons.Conftest module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Debug">SCons.Debug module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Defaults">SCons.Defaults module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Environment">SCons.Environment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Errors">SCons.Errors module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Executor">SCons.Executor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Job">SCons.Job module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Memoize">SCons.Memoize module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.PathList">SCons.PathList module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConf">SCons.SConf module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConsign">SCons.SConsign module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Subst">SCons.Subst module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Taskmaster">SCons.Taskmaster module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons/#generic-taskmaster-module-for-the-scons-build-engine">Generic Taskmaster module for the SCons build engine.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Util">SCons.Util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Warnings">SCons.Warnings module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.cpp">SCons.cpp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.dblite">SCons.dblite module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.exitfuncs">SCons.exitfuncs module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.compat/#module-SCons.compat">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Alias">SCons.Node.Alias module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.FS">SCons.Node.FS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Python">SCons.Node.Python module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.aix">SCons.Platform.aix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.cygwin">SCons.Platform.cygwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.darwin">SCons.Platform.darwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.hpux">SCons.Platform.hpux module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.irix">SCons.Platform.irix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.mingw">SCons.Platform.mingw module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.os2">SCons.Platform.os2 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.posix">SCons.Platform.posix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.sunos">SCons.Platform.sunos module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.virtualenv">SCons.Platform.virtualenv module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.win32">SCons.Platform.win32 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.C">SCons.Scanner.C module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.D">SCons.Scanner.D module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Dir">SCons.Scanner.Dir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Fortran">SCons.Scanner.Fortran module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.IDL">SCons.Scanner.IDL module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.LaTeX">SCons.Scanner.LaTeX module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Prog">SCons.Scanner.Prog module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.RC">SCons.Scanner.RC module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.SWIG">SCons.Scanner.SWIG module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Interactive">SCons.Script.Interactive module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Main">SCons.Script.Main module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConsOptions">SCons.Script.SConsOptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConscript">SCons.Script.SConscript module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Tool/#module-SCons.Tool">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.BoolVariable">SCons.Variables.BoolVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.EnumVariable">SCons.Variables.EnumVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.ListVariable">SCons.Variables.ListVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PackageVariable">SCons.Variables.PackageVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PathVariable">SCons.Variables.PathVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">SCons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../">Docs</a> &raquo;</li>
        
          <li><a href="../../">Module code</a> &raquo;</li>
        
      <li>SCons.Environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SCons.Environment</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;SCons.Environment</span>

<span class="sd">Base class for construction Environments.  These are</span>
<span class="sd">the primary objects used to communicate dependency and</span>
<span class="sd">construction information to the build engine.</span>

<span class="sd">Keyword arguments supplied when the construction Environment</span>
<span class="sd">is created are construction variables used to initialize the</span>
<span class="sd">Environment</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#</span>
<span class="c1"># __COPYRIGHT__</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining</span>
<span class="c1"># a copy of this software and associated documentation files (the</span>
<span class="c1"># &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="c1"># without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="c1"># distribute, sublicense, and/or sell copies of the Software, and to</span>
<span class="c1"># permit persons to whom the Software is furnished to do so, subject to</span>
<span class="c1"># the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included</span>
<span class="c1"># in all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY</span>
<span class="c1"># KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE</span>
<span class="c1"># WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="c1"># NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE</span>
<span class="c1"># LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="c1"># OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="c1"># WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="n">__revision__</span> <span class="o">=</span> <span class="s2">&quot;__FILE__ __REVISION__ __DATE__ __DEVELOPER__&quot;</span>


<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserDict</span>

<span class="kn">import</span> <span class="nn">SCons.Action</span>
<span class="kn">import</span> <span class="nn">SCons.Builder</span>
<span class="kn">import</span> <span class="nn">SCons.Debug</span>
<span class="kn">from</span> <span class="nn">SCons.Debug</span> <span class="kn">import</span> <span class="n">logInstanceCreation</span>
<span class="kn">import</span> <span class="nn">SCons.Defaults</span>
<span class="kn">from</span> <span class="nn">SCons.Errors</span> <span class="kn">import</span> <span class="n">UserError</span><span class="p">,</span> <span class="n">BuildError</span>
<span class="kn">import</span> <span class="nn">SCons.Memoize</span>
<span class="kn">import</span> <span class="nn">SCons.Node</span>
<span class="kn">import</span> <span class="nn">SCons.Node.Alias</span>
<span class="kn">import</span> <span class="nn">SCons.Node.FS</span>
<span class="kn">import</span> <span class="nn">SCons.Node.Python</span>
<span class="kn">import</span> <span class="nn">SCons.Platform</span>
<span class="kn">import</span> <span class="nn">SCons.SConf</span>
<span class="kn">import</span> <span class="nn">SCons.SConsign</span>
<span class="kn">import</span> <span class="nn">SCons.Subst</span>
<span class="kn">import</span> <span class="nn">SCons.Tool</span>
<span class="kn">import</span> <span class="nn">SCons.Util</span>
<span class="kn">import</span> <span class="nn">SCons.Warnings</span>

<div class="viewcode-block" id="_Null"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._Null">[docs]</a><span class="k">class</span> <span class="nc">_Null</span><span class="p">:</span>
    <span class="k">pass</span></div>

<span class="n">_null</span> <span class="o">=</span> <span class="n">_Null</span>

<span class="n">_warn_copy_deprecated</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">_warn_source_signatures_deprecated</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">_warn_target_signatures_deprecated</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">CleanTargets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">CalculatorArgs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">semi_deepcopy</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">semi_deepcopy</span>
<span class="n">semi_deepcopy_dict</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">semi_deepcopy_dict</span>

<div class="viewcode-block" id="alias_builder"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.alias_builder">[docs]</a><span class="k">def</span> <span class="nf">alias_builder</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="n">AliasBuilder</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="n">action</span> <span class="o">=</span> <span class="n">alias_builder</span><span class="p">,</span>
                                     <span class="n">target_factory</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Alias</span><span class="o">.</span><span class="n">default_ans</span><span class="o">.</span><span class="n">Alias</span><span class="p">,</span>
                                     <span class="n">source_factory</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">Entry</span><span class="p">,</span>
                                     <span class="n">multi</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                     <span class="n">is_explicit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AliasBuilder&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="apply_tools"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.apply_tools">[docs]</a><span class="k">def</span> <span class="nf">apply_tools</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">):</span>
    <span class="c1"># Store the toolpath in the Environment.</span>
    <span class="k">if</span> <span class="n">toolpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;toolpath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">toolpath</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># Filter out null tools from the list.</span>
    <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="n">tools</span> <span class="k">if</span> <span class="n">_f</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">toolargs</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># should be a dict of kw args</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">toolargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span></div>

<span class="c1"># These names are (or will be) controlled by SCons; users should never</span>
<span class="c1"># set or override them.  This warning can optionally be turned off,</span>
<span class="c1"># but scons will still ignore the illegal variable names even if it&#39;s off.</span>
<span class="n">reserved_construction_var_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;CHANGED_SOURCES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CHANGED_TARGETS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SOURCE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SOURCES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TARGET&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TARGETS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UNCHANGED_SOURCES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UNCHANGED_TARGETS&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">future_reserved_construction_var_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#&#39;HOST_OS&#39;,</span>
    <span class="c1">#&#39;HOST_ARCH&#39;,</span>
    <span class="c1">#&#39;HOST_CPU&#39;,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="copy_non_reserved_keywords"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.copy_non_reserved_keywords">[docs]</a><span class="k">def</span> <span class="nf">copy_non_reserved_keywords</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">semi_deepcopy</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">reserved_construction_var_names</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Ignoring attempt to set reserved variable `$</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
            <span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">ReservedVariableWarning</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="_set_reserved"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._set_reserved">[docs]</a><span class="k">def</span> <span class="nf">_set_reserved</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Ignoring attempt to set reserved variable `$</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
    <span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">ReservedVariableWarning</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="_set_future_reserved"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._set_future_reserved">[docs]</a><span class="k">def</span> <span class="nf">_set_future_reserved</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;`$</span><span class="si">%s</span><span class="s2">&#39; will be reserved in a future release and setting it will become ignored&quot;</span>
    <span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Warnings</span><span class="o">.</span><span class="n">FutureReservedVariableWarning</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="_set_BUILDERS"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._set_BUILDERS">[docs]</a><span class="k">def</span> <span class="nf">_set_BUILDERS</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">bd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">bd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">BuilderDict</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">bd</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">is_a_Builder</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a Builder.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">bd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="_del_SCANNERS"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._del_SCANNERS">[docs]</a><span class="k">def</span> <span class="nf">_del_SCANNERS</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">env</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">()</span></div>

<div class="viewcode-block" id="_set_SCANNERS"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._set_SCANNERS">[docs]</a><span class="k">def</span> <span class="nf">_set_SCANNERS</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">env</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">()</span></div>

<div class="viewcode-block" id="_delete_duplicates"><a class="viewcode-back" href="../../../SCons/#SCons.Environment._delete_duplicates">[docs]</a><span class="k">def</span> <span class="nf">_delete_duplicates</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">keep_last</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete duplicates from a sequence, keeping the first or last.&quot;&quot;&quot;</span>
    <span class="n">seen</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
    <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">keep_last</span><span class="p">:</span>           <span class="c1"># reverse in &amp; out, then keep first</span>
        <span class="n">l</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># probably unhashable.  Just keep it.</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep_last</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span></div>



<span class="c1"># The following is partly based on code in a comment added by Peter</span>
<span class="c1"># Shannon at the following page (there called the &quot;transplant&quot; class):</span>
<span class="c1">#</span>
<span class="c1"># ASPN : Python Cookbook : Dynamically added methods to a class</span>
<span class="c1"># http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/81732</span>
<span class="c1">#</span>
<span class="c1"># We had independently been using the idiom as BuilderWrapper, but</span>
<span class="c1"># factoring out the common parts into this base class, and making</span>
<span class="c1"># BuilderWrapper a subclass that overrides __call__() to enforce specific</span>
<span class="c1"># Builder calling conventions, simplified some of our higher-layer code.</span>

<div class="viewcode-block" id="MethodWrapper"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.MethodWrapper">[docs]</a><span class="k">class</span> <span class="nc">MethodWrapper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic Wrapper class that associates a method (which can</span>
<span class="sd">    actually be any callable) with an object.  As part of creating this</span>
<span class="sd">    MethodWrapper object an attribute with the specified (by default,</span>
<span class="sd">    the name of the supplied method) is added to the underlying object.</span>
<span class="sd">    When that new &quot;method&quot; is called, our __call__() method adds the</span>
<span class="sd">    object as the first argument, simulating the Python behavior of</span>
<span class="sd">    supplying &quot;self&quot; on method calls.</span>

<span class="sd">    We hang on to the name by which the method was added to the underlying</span>
<span class="sd">    base class so that we can provide a method to &quot;clone&quot; ourselves onto</span>
<span class="sd">    a new underlying object being copied (without which we wouldn&#39;t need</span>
<span class="sd">    to save that info).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="nb">object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="MethodWrapper.clone"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.MethodWrapper.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an object that re-binds the underlying &quot;method&quot; to</span>
<span class="sd">        the specified new object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">new_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="BuilderWrapper"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.BuilderWrapper">[docs]</a><span class="k">class</span> <span class="nc">BuilderWrapper</span><span class="p">(</span><span class="n">MethodWrapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A MethodWrapper subclass that that associates an environment with</span>
<span class="sd">    a Builder.</span>

<span class="sd">    This mainly exists to wrap the __call__() function so that all calls</span>
<span class="sd">    to Builders can have their argument lists massaged in the same way</span>
<span class="sd">    (treat a lone argument as the source, treat two arguments as target</span>
<span class="sd">    then source, make sure both target and source are lists) without</span>
<span class="sd">    having to have cut-and-paste code to do it.</span>

<span class="sd">    As a bit of obsessive backwards compatibility, we also intercept</span>
<span class="sd">    attempts to get or set the &quot;env&quot; or &quot;builder&quot; attributes, which were</span>
<span class="sd">    the names we used before we put the common functionality into the</span>
<span class="sd">    MethodWrapper base class.  We&#39;ll keep this around for a while in case</span>
<span class="sd">    people shipped Tool modules that reached into the wrapper (like the</span>
<span class="sd">    Tool/qt.py module does, or did).  There shouldn&#39;t be a lot attribute</span>
<span class="sd">    fetching or setting on these, so a little extra work shouldn&#39;t hurt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">target</span>
            <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">MethodWrapper</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;BuilderWrapper </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;env&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;builder&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;env&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;builder&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="c1"># This allows a Builder to be executed directly</span>
    <span class="c1"># through the Environment to which it&#39;s attached.</span>
    <span class="c1"># In practice, we shouldn&#39;t need this, because</span>
    <span class="c1"># builders actually get executed through a Node.</span>
    <span class="c1"># But we do have a unit test for this, and can&#39;t</span>
    <span class="c1"># yet rule out that it would be useful in the</span>
    <span class="c1"># future, so leave it for now.</span>
    <span class="c1">#def execute(self, **kw):</span>
    <span class="c1">#    kw[&#39;env&#39;] = self.env</span>
    <span class="c1">#    self.builder.execute(**kw)</span>

<div class="viewcode-block" id="BuilderDict"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.BuilderDict">[docs]</a><span class="k">class</span> <span class="nc">BuilderDict</span><span class="p">(</span><span class="n">UserDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a dictionary-like class used by an Environment to hold</span>
<span class="sd">    the Builders.  We need to do this because every time someone changes</span>
<span class="sd">    the Builders in the Environment&#39;s BUILDERS dictionary, we must</span>
<span class="sd">    update the Environment&#39;s attributes.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="c1"># Set self.env before calling the superclass initialization,</span>
        <span class="c1"># because it will end up calling our other methods, which will</span>
        <span class="c1"># need to point the values in this dictionary to self.env.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="n">UserDict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__semi_deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># These cannot be copied since they would both modify the same builder object, and indeed</span>
        <span class="c1"># just copying would modify the original builder</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;cannot semi_deepcopy a BuilderDict&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">method</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">RemoveMethod</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">UserDict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="n">BuilderWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">UserDict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

<div class="viewcode-block" id="BuilderDict.update"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.BuilderDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div></div>



<span class="n">_is_valid_var</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[_a-zA-Z]\w*$&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="is_valid_construction_var"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.is_valid_construction_var">[docs]</a><span class="k">def</span> <span class="nf">is_valid_construction_var</span><span class="p">(</span><span class="n">varstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return if the specified string is a legitimate construction</span>
<span class="sd">    variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_is_valid_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">varstr</span><span class="p">)</span></div>



<div class="viewcode-block" id="SubstitutionEnvironment"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment">[docs]</a><span class="k">class</span> <span class="nc">SubstitutionEnvironment</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for different flavors of construction environments.</span>

<span class="sd">    This class contains a minimal set of methods that handle construction</span>
<span class="sd">    variable expansion and conversion of strings to Nodes, which may or</span>
<span class="sd">    may not be actually useful as a stand-alone class.  Which methods</span>
<span class="sd">    ended up in this class is pretty arbitrary right now.  They&#39;re</span>
<span class="sd">    basically the ones which we&#39;ve empirically determined are common to</span>
<span class="sd">    the different construction environment subclasses, and most of the</span>
<span class="sd">    others that use or touch the underlying dictionary of construction</span>
<span class="sd">    variables.</span>

<span class="sd">    Eventually, this class should contain all the methods that we</span>
<span class="sd">    determine are necessary for a &quot;minimal&quot; interface to the build engine.</span>
<span class="sd">    A full &quot;native Python&quot; SCons environment has gotten pretty heavyweight</span>
<span class="sd">    with all of the methods and Tools and construction variables we&#39;ve</span>
<span class="sd">    jammed in there, so it would be nice to have a lighter weight</span>
<span class="sd">    alternative for interfaces that don&#39;t need all of the bells and</span>
<span class="sd">    whistles.  (At some point, we&#39;ll also probably rename this class</span>
<span class="sd">    &quot;Base,&quot; since that more reflects what we want this class to become,</span>
<span class="sd">    but because we&#39;ve released comments that tell people to subclass</span>
<span class="sd">    Environment.Base to create their own flavors of construction</span>
<span class="sd">    environment, we&#39;ll save that for a future refactoring when this</span>
<span class="sd">    class actually becomes useful.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of an underlying SubstitutionEnvironment class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Environment.SubstitutionEnvironment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">get_default_fs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ans</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Alias</span><span class="o">.</span><span class="n">default_ans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup_list</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">arg2nodes_lookups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_special</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#self._memo = {}</span>

<div class="viewcode-block" id="SubstitutionEnvironment._init_special"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment._init_special">[docs]</a>    <span class="k">def</span> <span class="nf">_init_special</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initial the dispatch tables for special handling of</span>
<span class="sd">        special construction variables.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_del</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_del</span><span class="p">[</span><span class="s1">&#39;SCANNERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_del_SCANNERS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">reserved_construction_var_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_set_reserved</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">future_reserved_construction_var_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_set_future_reserved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_set_BUILDERS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="p">[</span><span class="s1">&#39;SCANNERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_set_SCANNERS</span>

        <span class="c1"># Freeze the keys of self._special_set in a list for use by</span>
        <span class="c1"># methods that need to check.  (Empirically, list scanning has</span>
        <span class="c1"># gotten better than dict.has_key() in Python 2.5.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_special_set_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_dict</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">special</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_del</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">special</span><span class="p">:</span>
            <span class="n">special</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># This is heavily used.  This implementation is the best we have</span>
        <span class="c1"># according to the timings in bench/env.__setitem__.py.</span>
        <span class="c1">#</span>
        <span class="c1"># The &quot;key in self._special_set_keys&quot; test here seems to perform</span>
        <span class="c1"># pretty well for the number of keys we have.  A hard-coded</span>
        <span class="c1"># list works a little better in Python 2.5, but that has the</span>
        <span class="c1"># disadvantage of maybe getting out of sync if we ever add more</span>
        <span class="c1"># variable names.  Using self._special_set.has_key() works a</span>
        <span class="c1"># little better in Python 2.4, but is worse than this test.</span>
        <span class="c1"># So right now it seems like a good trade-off, but feel free to</span>
        <span class="c1"># revisit this with bench/env.__setitem__.py as needed (and</span>
        <span class="c1"># as newer versions of Python come out).</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_set_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_special_set</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we already have the entry, then it&#39;s obviously a valid</span>
            <span class="c1"># key and we don&#39;t need to check.  If we do check, using a</span>
            <span class="c1"># global, pre-compiled regular expression directly is more</span>
            <span class="c1"># efficient than calling another function or a method.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> \
               <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_valid_var</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Illegal construction variable `</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="SubstitutionEnvironment.get"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the get() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.has_key"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.has_key">[docs]</a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the has_key() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="SubstitutionEnvironment.keys"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the keys() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.values"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the values() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.items"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the items() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.arg2nodes"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.arg2nodes">[docs]</a>    <span class="k">def</span> <span class="nf">arg2nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">node_factory</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">lookup_list</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node_factory</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">node_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span>
        <span class="k">if</span> <span class="n">lookup_list</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">lookup_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup_list</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lookup_list</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">l</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                        <span class="c1"># n = self.subst(n, raw=1, **kw)</span>
                        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">node_factory</span><span class="p">:</span>
                            <span class="n">n</span> <span class="o">=</span> <span class="n">node_factory</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                        <span class="n">nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">node_factory</span><span class="p">:</span>
                    <span class="c1"># v = node_factory(self.subst(v, raw=1, **kw))</span>
                    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">node_factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                        <span class="n">nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nodes</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.gvars"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.gvars">[docs]</a>    <span class="k">def</span> <span class="nf">gvars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.lvars"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.lvars">[docs]</a>    <span class="k">def</span> <span class="nf">lvars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.subst"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.subst">[docs]</a>    <span class="k">def</span> <span class="nf">subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursively interpolates construction variables from the</span>
<span class="sd">        Environment into the specified string, returning the expanded</span>
<span class="sd">        result.  Construction variables are specified by a $ prefix</span>
<span class="sd">        in the string and begin with an initial underscore or</span>
<span class="sd">        alphabetic character followed by any number of underscores</span>
<span class="sd">        or alphanumeric characters.  The construction variable names</span>
<span class="sd">        may be surrounded by curly braces to separate the name from</span>
<span class="sd">        trailing characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gvars</span><span class="p">()</span>
        <span class="n">lvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lvars</span><span class="p">()</span>
        <span class="n">lvars</span><span class="p">[</span><span class="s1">&#39;__env__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">lvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">get_lvars</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">gvars</span><span class="p">,</span> <span class="n">lvars</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.subst_kw"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.subst_kw">[docs]</a>    <span class="k">def</span> <span class="nf">subst_kw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">nkw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="n">nkw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">nkw</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.subst_list"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.subst_list">[docs]</a>    <span class="k">def</span> <span class="nf">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls through to SCons.Subst.scons_subst_list().  See</span>
<span class="sd">        the documentation for that function.&quot;&quot;&quot;</span>
        <span class="n">gvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gvars</span><span class="p">()</span>
        <span class="n">lvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lvars</span><span class="p">()</span>
        <span class="n">lvars</span><span class="p">[</span><span class="s1">&#39;__env__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">lvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">get_lvars</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst_list</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">gvars</span><span class="p">,</span> <span class="n">lvars</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.subst_path"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.subst_path">[docs]</a>    <span class="k">def</span> <span class="nf">subst_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Substitute a path list, turning EntryProxies into Nodes</span>
<span class="sd">        and leaving Nodes (and other objects) as-is.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;This is the &quot;string conversion&quot; routine that we have our</span>
<span class="sd">            substitutions use to return Nodes, not strings.  This relies</span>
<span class="sd">            on the fact that an EntryProxy object has a get() method that</span>
<span class="sd">            returns the underlying Node that it wraps, which is a bit of</span>
<span class="sd">            architectural dependence that we might need to break or modify</span>
<span class="sd">            in the future in response to additional requirements.&quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">get</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_String_for_subst</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">get</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">conv</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># We have an object plus a string, or multiple</span>
                        <span class="c1"># objects that we need to smush together.  No choice</span>
                        <span class="c1"># but to make them into a string.</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_String_for_subst</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

    <span class="n">subst_target_source</span> <span class="o">=</span> <span class="n">subst</span>

<div class="viewcode-block" id="SubstitutionEnvironment.backtick"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.backtick">[docs]</a>    <span class="k">def</span> <span class="nf">backtick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="c1"># common arguments</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;stdin&#39;</span> <span class="p">:</span> <span class="s1">&#39;devnull&#39;</span><span class="p">,</span>
               <span class="s1">&#39;stdout&#39;</span> <span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
               <span class="s1">&#39;stderr&#39;</span> <span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
               <span class="s1">&#39;universal_newlines&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
             <span class="p">}</span>
        <span class="c1"># if the command is a list, assume it&#39;s been quoted</span>
        <span class="c1"># othewise force a shell</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">command</span><span class="p">):</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;shell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># run constructed command</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">_subproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; exited </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">status</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.AddMethod"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.AddMethod">[docs]</a>    <span class="k">def</span> <span class="nf">AddMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the specified function as a method of this construction</span>
<span class="sd">        environment with the specified name.  If the name is omitted,</span>
<span class="sd">        the default name is the name of the function itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">MethodWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.RemoveMethod"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.RemoveMethod">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the specified function&#39;s MethodWrapper from the</span>
<span class="sd">        added_methods list, so we don&#39;t re-bind it when making a clone.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">dm</span> <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span> <span class="k">if</span> <span class="n">dm</span><span class="o">.</span><span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">function</span><span class="p">]</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.Override"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.Override">[docs]</a>    <span class="k">def</span> <span class="nf">Override</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce a modified environment whose variables are overridden by</span>
<span class="sd">        the overrides dictionaries.  &quot;overrides&quot; is a dictionary that</span>
<span class="sd">        will override the variables of this environment.</span>

<span class="sd">        This function is much more efficient than Clone() or creating</span>
<span class="sd">        a new Environment because it doesn&#39;t copy the construction</span>
<span class="sd">        environment dictionary, it just wraps the underlying construction</span>
<span class="sd">        environment, and doesn&#39;t even create a wrapper object if there</span>
<span class="sd">        are no overrides.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overrides</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span>
        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">merges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;parse_flags&#39;</span><span class="p">:</span>
                <span class="n">merges</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">overrides</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst_once</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">OverrideEnvironment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">merges</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">MergeFlags</span><span class="p">(</span><span class="n">merges</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.ParseFlags"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.ParseFlags">[docs]</a>    <span class="k">def</span> <span class="nf">ParseFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">flags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the set of flags and return a dict with the flags placed</span>
<span class="sd">        in the appropriate entry.  The flags are treated as a typical</span>
<span class="sd">        set of command-line flags for a GNU-like toolchain and used to</span>
<span class="sd">        populate the entries in the dict immediately below.  If one of</span>
<span class="sd">        the flag strings begins with a bang (exclamation mark), it is</span>
<span class="sd">        assumed to be a command and the rest of the string is executed;</span>
<span class="sd">        the result of that evaluation is then added to the dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ASFLAGS&#39;</span>       <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CFLAGS&#39;</span>        <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CCFLAGS&#39;</span>       <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CXXFLAGS&#39;</span>      <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CPPDEFINES&#39;</span>    <span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;CPPFLAGS&#39;</span>      <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CPPPATH&#39;</span>       <span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;FRAMEWORKPATH&#39;</span> <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;FRAMEWORKS&#39;</span>    <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;LIBPATH&#39;</span>       <span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;LIBS&#39;</span>          <span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;LINKFLAGS&#39;</span>     <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="s1">&#39;RPATH&#39;</span>         <span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">do_parse</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="c1"># if arg is a sequence, recurse with each element</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span> <span class="n">do_parse</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># if arg is a command, execute it</span>
            <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backtick</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

            <span class="c1"># utility function to deal with -D option</span>
            <span class="k">def</span> <span class="nf">append_define</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:])])</span>

            <span class="c1"># Loop through the flags and add them to the appropriate option.</span>
            <span class="c1"># This tries to strike a balance between checking for all possible</span>
            <span class="c1"># flags and keeping the logic to a finite size, so it doesn&#39;t</span>
            <span class="c1"># check for some that don&#39;t occur often.  It particular, if the</span>
            <span class="c1"># flag is not known to occur in a config script and there&#39;s a way</span>
            <span class="c1"># of passing the flag to the right place (by wrapping it in a -W</span>
            <span class="c1"># flag, for example) we don&#39;t check for it.  Note that most</span>
            <span class="c1"># preprocessor options are not handled, since unhandled options</span>
            <span class="c1"># are placed in CCFLAGS, so unless the preprocessor is invoked</span>
            <span class="c1"># separately, these flags will still get to the preprocessor.</span>
            <span class="c1"># Other options not currently handled:</span>
            <span class="c1">#  -iqoutedir      (preprocessor search path)</span>
            <span class="c1">#  -u symbol       (linker undefined symbol)</span>
            <span class="c1">#  -s              (linker strip files)</span>
            <span class="c1">#  -static*        (linker static binding)</span>
            <span class="c1">#  -shared*        (linker dynamic binding)</span>
            <span class="c1">#  -symbolic       (linker global binding)</span>
            <span class="c1">#  -R dir          (deprecated linker rpath)</span>
            <span class="c1"># IBM compilers may also accept -qframeworkdir=foo</span>

            <span class="n">params</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># for multi-word args</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">append_next_arg_to</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">:</span>
                        <span class="n">append_define</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-include&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-include&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-imacros&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-imacros&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-isysroot&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-isysroot&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-isystem&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-isystem&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-iquote&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-iquote&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-idirafter&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-idirafter&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">append_next_arg_to</span> <span class="o">==</span> <span class="s1">&#39;-arch&#39;</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;-arch&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="n">append_next_arg_to</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">]:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LIBS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;-dylib_file&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;LINKFLAGS&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-L&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LIBPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;LIBPATH&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-l&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LIBS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;LIBS&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-I&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CPPPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;CPPPATH&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wa,&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;ASFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wl,&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wl,-rpath=&#39;</span><span class="p">:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;RPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span>
                    <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wl,-R,&#39;</span><span class="p">:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;RPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span>
                    <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wl,-R&#39;</span><span class="p">:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;RPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-Wp,&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CPPFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-D&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="n">append_define</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;CPPDEFINES&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;-framework&#39;</span><span class="p">:</span>
                    <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;FRAMEWORKS&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-frameworkdir=&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FRAMEWORKPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">14</span><span class="p">:])</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-F&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FRAMEWORKPATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="s1">&#39;FRAMEWORKPATH&#39;</span>
                <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-mno-cygwin&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;-pthread&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;-openmp&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;-fmerge-all-constants&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;-fopenmp&#39;</span><span class="p">]:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;-mwindows&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-std=&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;++&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">[</span><span class="mi">5</span><span class="p">:]:</span>
                        <span class="n">key</span><span class="o">=</span><span class="s1">&#39;CXXFLAGS&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">key</span><span class="o">=</span><span class="s1">&#39;CFLAGS&#39;</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;LINKFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-include&#39;</span><span class="p">,</span> <span class="s1">&#39;-imacros&#39;</span><span class="p">,</span> <span class="s1">&#39;-isysroot&#39;</span><span class="p">,</span> <span class="s1">&#39;-isystem&#39;</span><span class="p">,</span> <span class="s1">&#39;-iquote&#39;</span><span class="p">,</span> <span class="s1">&#39;-idirafter&#39;</span><span class="p">,</span> <span class="s1">&#39;-arch&#39;</span><span class="p">]:</span>
                    <span class="n">append_next_arg_to</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CCFLAGS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
            <span class="n">do_parse</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span></div>

<div class="viewcode-block" id="SubstitutionEnvironment.MergeFlags"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.SubstitutionEnvironment.MergeFlags">[docs]</a>    <span class="k">def</span> <span class="nf">MergeFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge the dict in args into the construction variables of this</span>
<span class="sd">        env, or the passed-in dict.  If args is not a dict, it is</span>
<span class="sd">        converted into a dict using ParseFlags.  If unique is not set,</span>
<span class="sd">        the flags are appended rather than merged.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ParseFlags</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unique</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">orig</span><span class="p">:</span>
                    <span class="n">orig</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># Add orig and value.  The logic here was lifted from</span>
                    <span class="c1"># part of env.Append() (see there for a lot of comments</span>
                    <span class="c1"># about the order in which things are tried) and is</span>
                    <span class="c1"># used mainly to handle coercion of strings to CLVar to</span>
                    <span class="c1"># &quot;do the right thing&quot; given (e.g.) an original CCFLAGS</span>
                    <span class="c1"># string variable like &#39;-pipe -Wall&#39;.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">orig</span> <span class="o">=</span> <span class="n">orig</span> <span class="o">+</span> <span class="n">value</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">add_to_orig</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">append</span>
                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="n">value</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
                            <span class="n">orig</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">add_to_orig</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;PATH&#39;</span><span class="p">:</span>
                <span class="c1">### keep left-most occurence</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">orig</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">### keep right-most occurence</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">orig</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="default_decide_source"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.default_decide_source">[docs]</a><span class="k">def</span> <span class="nf">default_decide_source</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">decide_source</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="default_decide_target"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.default_decide_target">[docs]</a><span class="k">def</span> <span class="nf">default_decide_target</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">decide_target</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>


<div class="viewcode-block" id="default_copy_from_cache"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.default_copy_from_cache">[docs]</a><span class="k">def</span> <span class="nf">default_copy_from_cache</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">copy_from_cache</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>


<div class="viewcode-block" id="Base"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base">[docs]</a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">SubstitutionEnvironment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for &quot;real&quot; construction Environments.</span>

<span class="sd">    These are the primary objects used to communicate dependency</span>
<span class="sd">    and construction information to the build engine.</span>

<span class="sd">    Keyword arguments supplied when the construction Environment</span>
<span class="sd">    is created are construction variables used to initialize the</span>
<span class="sd">    Environment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#######################################################################</span>
    <span class="c1"># This is THE class for interacting with the SCons build engine,</span>
    <span class="c1"># and it contains a lot of stuff, so we&#39;re going to try to keep this</span>
    <span class="c1"># a little organized by grouping the methods.</span>
    <span class="c1">#######################################################################</span>

    <span class="c1">#######################################################################</span>
    <span class="c1"># Methods that make an Environment act like a dictionary.  These have</span>
    <span class="c1"># the expected standard names for Python mapping objects.  Note that</span>
    <span class="c1"># we don&#39;t actually make an Environment a subclass of UserDict for</span>
    <span class="c1"># performance reasons.  Note also that we only supply methods for</span>
    <span class="c1"># dictionary functionality that we actually need and use.</span>
    <span class="c1">#######################################################################</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">platform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">toolpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parse_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kw</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of a basic SCons construction environment.</span>

<span class="sd">        Sets up special construction variables like BUILDER,</span>
<span class="sd">        PLATFORM, etc., and searches for and applies available Tools.</span>

<span class="sd">        Note that we do *not* call the underlying base class</span>
<span class="sd">        (SubsitutionEnvironment) initialization, because we need to</span>
<span class="sd">        initialize things in a very specific order that doesn&#39;t work</span>
<span class="sd">        with the much simpler base class initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Environment.Base&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">get_default_fs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ans</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Alias</span><span class="o">.</span><span class="n">default_ans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookup_list</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">arg2nodes_lookups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="n">semi_deepcopy</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">ConstructionEnvironment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_special</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># We don&#39;t use AddMethod, or define these as methods in this</span>
        <span class="c1"># class, because we *don&#39;t* want these functions to be bound</span>
        <span class="c1"># methods.  They need to operate independently so that the</span>
        <span class="c1"># settings will work properly regardless of whether a given</span>
        <span class="c1"># target ends up being built with a Base environment or an</span>
        <span class="c1"># OverrideEnvironment or what have you.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decide_target</span> <span class="o">=</span> <span class="n">default_decide_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decide_source</span> <span class="o">=</span> <span class="n">default_decide_source</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_cache</span> <span class="o">=</span> <span class="n">default_copy_from_cache</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BuilderDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">platform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PLATFORM&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">platform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">platform</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">Platform</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">platform</span><span class="p">):</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">Platform</span><span class="p">(</span><span class="n">platform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;PLATFORM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">platform</span><span class="p">)</span>
        <span class="n">platform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;HOST_OS&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOST_OS&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;HOST_ARCH&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOST_ARCH&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Now set defaults for TARGET_{OS|ARCH}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;TARGET_OS&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TARGET_OS&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;TARGET_ARCH&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TARGET_ARCH&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>


        <span class="c1"># Apply the passed-in and customizable variables to the</span>
        <span class="c1"># environment before calling the tools, because they may use</span>
        <span class="c1"># some of them during initialization.</span>
        <span class="k">if</span> <span class="s1">&#39;options&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="c1"># Backwards compatibility:  they may stll be using the</span>
            <span class="c1"># old &quot;options&quot; keyword.</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">save</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">save</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No value may have been set if they tried to pass in a</span>
                <span class="c1"># reserved variable name like TARGETS.</span>
                <span class="k">pass</span>

        <span class="n">SCons</span><span class="o">.</span><span class="n">Tool</span><span class="o">.</span><span class="n">Initializers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TOOLS&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
        <span class="n">apply_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">)</span>

        <span class="c1"># Now restore the passed-in and customized variables</span>
        <span class="c1"># to the environment, since the values the user set explicitly</span>
        <span class="c1"># should override any values set by the tools.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">save</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># Finally, apply any flags to be merged in</span>
        <span class="k">if</span> <span class="n">parse_flags</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">MergeFlags</span><span class="p">(</span><span class="n">parse_flags</span><span class="p">)</span>

    <span class="c1">#######################################################################</span>
    <span class="c1"># Utility methods that are primarily for internal use by SCons.</span>
    <span class="c1"># These begin with lower-case letters.</span>
    <span class="c1">#######################################################################</span>

<div class="viewcode-block" id="Base.get_builder"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_builder">[docs]</a>    <span class="k">def</span> <span class="nf">get_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch the builder with the specified name from the environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Base.get_CacheDir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_CacheDir">[docs]</a>    <span class="k">def</span> <span class="nf">get_CacheDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CacheDir_path</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">_CacheDir_path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_CacheDir_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_CacheDir</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">CacheDir</span><span class="o">.</span><span class="n">CacheDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_CacheDir_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_CacheDir</span> <span class="o">=</span> <span class="n">cd</span>
        <span class="k">return</span> <span class="n">cd</span></div>

<div class="viewcode-block" id="Base.get_factory"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_factory">[docs]</a>    <span class="k">def</span> <span class="nf">get_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;File&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a factory function for creating Nodes for this</span>
<span class="sd">        construction environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_node</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">Base</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># The specified factory isn&#39;t a Node itself--it&#39;s</span>
            <span class="c1"># most likely None, or possibly a callable.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_node</span><span class="p">:</span>
                <span class="c1"># The specified factory is a Node (sub)class.  Try to</span>
                <span class="c1"># return the FS method that corresponds to the Node&#39;s</span>
                <span class="c1"># name--that is, we return self.fs.Dir if they want a Dir,</span>
                <span class="c1"># self.fs.File for a File, etc.</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">factory</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">factory</span><span class="p">:</span>
            <span class="c1"># They passed us None, or we picked up a name from a specified</span>
            <span class="c1"># class, so return the FS method.  (Note that we *don&#39;t*</span>
            <span class="c1"># use our own self.{Dir,File} methods because that would</span>
            <span class="c1"># cause env.subst() to be called twice on the file name,</span>
            <span class="c1"># interfering with files that have $$ in them.)</span>
            <span class="n">factory</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">factory</span></div>

<div class="viewcode-block" id="Base._gsm"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._gsm">[docs]</a>    <span class="nd">@SCons</span><span class="o">.</span><span class="n">Memoize</span><span class="o">.</span><span class="n">CountMethodCall</span>
    <span class="k">def</span> <span class="nf">_gsm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;_gsm&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scanners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;SCANNERS&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reverse the scanner list so that, if multiple scanners</span>
            <span class="c1"># claim they can scan the same suffix, earlier scanners</span>
            <span class="c1"># in the list will overwrite later scanners, so that</span>
            <span class="c1"># the result looks like a &quot;first match&quot; to the user.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">scanners</span><span class="p">):</span>
                <span class="n">scanners</span> <span class="o">=</span> <span class="p">[</span><span class="n">scanners</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scanners</span> <span class="o">=</span> <span class="n">scanners</span><span class="p">[:]</span> <span class="c1"># copy so reverse() doesn&#39;t mod original</span>
            <span class="n">scanners</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">scanner</span> <span class="ow">in</span> <span class="n">scanners</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">scanner</span><span class="o">.</span><span class="n">get_skeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PLATFORM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scanner</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;_gsm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.get_scanner"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_scanner">[docs]</a>    <span class="k">def</span> <span class="nf">get_scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skey</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the appropriate scanner given a key (usually a file suffix).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">skey</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;PLATFORM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">skey</span> <span class="o">=</span> <span class="n">skey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gsm</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.scanner_map_delete"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.scanner_map_delete">[docs]</a>    <span class="k">def</span> <span class="nf">scanner_map_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the cached scanner map (if we need to).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memo</span><span class="p">[</span><span class="s1">&#39;_gsm&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Base._update"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._update">[docs]</a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method to update an environment&#39;s consvar dict directly.</span>

<span class="sd">        Bypasses the normal checks that occur when users try to set items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._update_onlynew"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._update_onlynew">[docs]</a>    <span class="k">def</span> <span class="nf">_update_onlynew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method to add new items to an environment&#39;s consvar dict.</span>

<span class="sd">        Only adds items from `other` whose keys do not already appear in</span>
<span class="sd">        the existing dict; values from `other` are not used for replacement.</span>
<span class="sd">        Bypasses the normal checks that occur when users try to set items.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>


<div class="viewcode-block" id="Base.get_src_sig_type"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_src_sig_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_src_sig_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_sig_type</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">src_sig_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">src_sig_type</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Base.get_tgt_sig_type"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.get_tgt_sig_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_tgt_sig_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_sig_type</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">tgt_sig_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tgt_sig_type</span> <span class="o">=</span> <span class="n">t</span>
            <span class="k">return</span> <span class="n">t</span></div>

    <span class="c1">#######################################################################</span>
    <span class="c1"># Public methods for manipulating an Environment.  These begin with</span>
    <span class="c1"># upper-case letters.  The essential characteristic of methods in</span>
    <span class="c1"># this section is that they do *not* have corresponding same-named</span>
    <span class="c1"># global functions.  For example, a stand-alone Append() function</span>
    <span class="c1"># makes no sense, because Append() is all about appending values to</span>
    <span class="c1"># an Environment&#39;s construction variables.</span>
    <span class="c1">#######################################################################</span>

<div class="viewcode-block" id="Base.Append"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Append">[docs]</a>    <span class="k">def</span> <span class="nf">Append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append values to existing construction variables</span>
<span class="sd">        in an Environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># It would be easier on the eyes to write this using</span>
            <span class="c1"># &quot;continue&quot; statements whenever we finish processing an item,</span>
            <span class="c1"># but Python 1.5.2 apparently doesn&#39;t let you use &quot;continue&quot;</span>
            <span class="c1"># within try:-except: blocks, so we have to nest our code.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span> <span class="ow">and</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No existing variable in the environment, so just set</span>
                <span class="c1"># it to the new value.</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span> <span class="ow">and</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check if the original looks like a dictionary.</span>
                    <span class="c1"># If it is, we can&#39;t just try adding the value because</span>
                    <span class="c1"># dictionaries don&#39;t have __add__() methods, and</span>
                    <span class="c1"># things like UserList will incorrectly coerce the</span>
                    <span class="c1"># original dict to a list (which we don&#39;t want).</span>
                    <span class="n">update_dict</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">update</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Most straightforward:  just try to add them</span>
                        <span class="c1"># together.  This will work in most cases, when the</span>
                        <span class="c1"># original and new values are of compatible types.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig</span> <span class="o">+</span> <span class="n">val</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Check if the original is a list.</span>
                            <span class="n">add_to_orig</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">append</span>
                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="c1"># The original isn&#39;t a list, but the new</span>
                            <span class="c1"># value is (by process of elimination),</span>
                            <span class="c1"># so insert the original in the new value</span>
                            <span class="c1"># (if there&#39;s one to insert) and replace</span>
                            <span class="c1"># the variable with it.</span>
                            <span class="k">if</span> <span class="n">orig</span><span class="p">:</span>
                                <span class="n">val</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># The original is a list, so append the new</span>
                            <span class="c1"># value to it (if there&#39;s a value to append).</span>
                            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">add_to_orig</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># The original looks like a dictionary, so update it</span>
                    <span class="c1"># based on what we think the value looks like.</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">:</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">orig</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
                            <span class="n">orig</span> <span class="o">=</span> <span class="n">tmp</span>
                            <span class="n">orig</span> <span class="o">+=</span> <span class="n">val</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">orig</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">update_dict</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="n">orig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">orig</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="c1"># allow Dirs and strings beginning with # for top-relative</span>
    <span class="c1"># Note this uses the current env&#39;s fs (in self).</span>
<div class="viewcode-block" id="Base._canonicalize"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._canonicalize">[docs]</a>    <span class="k">def</span> <span class="nf">_canonicalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">path</span><span class="p">):</span> <span class="c1"># typically a Dir</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="Base.AppendENVPath"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.AppendENVPath">[docs]</a>    <span class="k">def</span> <span class="nf">AppendENVPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">envname</span> <span class="o">=</span> <span class="s1">&#39;ENV&#39;</span><span class="p">,</span>
                      <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append path elements to the path &#39;name&#39; in the &#39;ENV&#39;</span>
<span class="sd">        dictionary for this environment.  Will only add any particular</span>
<span class="sd">        path once, and will normpath and normcase all paths to help</span>
<span class="sd">        assure this.  This can also handle the case where the env</span>
<span class="sd">        variable is a list instead of a string.</span>

<span class="sd">        If delete_existing is 0, a newpath which is already in the path</span>
<span class="sd">        will not be moved to the end (it will be left where it is).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">envname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">]:</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="n">nv</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">AppendPath</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">delete_existing</span><span class="p">,</span>
                                   <span class="n">canonicalize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_canonicalize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">envname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv</span></div>

<div class="viewcode-block" id="Base.AppendUnique"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.AppendUnique">[docs]</a>    <span class="k">def</span> <span class="nf">AppendUnique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append values to existing construction variables</span>
<span class="sd">        in an Environment, if they&#39;re not already there.</span>
<span class="sd">        If delete_existing is 1, removes existing values first, so</span>
<span class="sd">        values move to end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_delete_duplicates</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">delete_existing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">and</span> \
                 <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
                        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Tuple</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">tmp</span>
                    <span class="c1"># Construct a list of (key, value) tuples.</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dk</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="n">tmp</span>
                    <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dk</span><span class="p">,)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
                            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Tuple</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                    <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
                            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Tuple</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="n">tmp</span>
                        <span class="c1"># Construct a list of (key, value) tuples.</span>
                        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="n">tmp</span>
                        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">,)]</span>
                        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                            <span class="n">dk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">,</span> <span class="n">dk</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="n">val</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="n">val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># By elimination, val is not a list.  Since dk is a</span>
                        <span class="c1"># list, wrap val in a list first.</span>
                        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                            <span class="n">dk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">,</span> <span class="n">dk</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;CPPDEFINES&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                            <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dk</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,))</span>
                            <span class="n">dk</span> <span class="o">=</span> <span class="n">tmp</span>
                        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                                <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="n">tmp</span>
                    <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dk</span> <span class="o">+</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Clone"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Clone">[docs]</a>    <span class="k">def</span> <span class="nf">Clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[],</span> <span class="n">toolpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_flags</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of a construction Environment.</span>

<span class="sd">        The copy is like a Python &quot;deep copy&quot;--that is, independent</span>
<span class="sd">        copies are made recursively of each objects--except that</span>
<span class="sd">        a reference is copied when an object is not deep-copyable</span>
<span class="sd">        (like a function).  There are no references to any mutable</span>
<span class="sd">        objects in the original Environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">builders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">clone</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># BUILDERS is not safe to do a simple copy</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">_dict</span> <span class="o">=</span> <span class="n">semi_deepcopy_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">])</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BuilderDict</span><span class="p">(</span><span class="n">builders</span><span class="p">,</span> <span class="n">clone</span><span class="p">)</span>

        <span class="c1"># Check the methods added via AddMethod() and re-bind them to</span>
        <span class="c1"># the cloned environment.  Only do this if the attribute hasn&#39;t</span>
        <span class="c1"># been overwritten by the user explicitly and still points to</span>
        <span class="c1"># the added method.</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">added_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">added_methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mw</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mw</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">clone</span><span class="o">.</span><span class="n">added_methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mw</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">clone</span><span class="p">))</span>

        <span class="n">clone</span><span class="o">.</span><span class="n">_memo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Apply passed-in variables before the tools</span>
        <span class="c1"># so the tools can use the new variables</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst_once</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="o">**</span><span class="n">new</span><span class="p">)</span>

        <span class="n">apply_tools</span><span class="p">(</span><span class="n">clone</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">)</span>

        <span class="c1"># apply them again in case the tools overwrote them</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="o">**</span><span class="n">new</span><span class="p">)</span>

        <span class="c1"># Finally, apply any flags to be merged in</span>
        <span class="k">if</span> <span class="n">parse_flags</span><span class="p">:</span> <span class="n">clone</span><span class="o">.</span><span class="n">MergeFlags</span><span class="p">(</span><span class="n">parse_flags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Environment.EnvironmentClone&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Base._changed_build"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_build">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dependency</span><span class="o">.</span><span class="n">changed_state</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decide_source</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._changed_content"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_content">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dependency</span><span class="o">.</span><span class="n">changed_content</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._changed_source"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_source">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">target_env</span> <span class="o">=</span> <span class="n">dependency</span><span class="o">.</span><span class="n">get_build_env</span><span class="p">()</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">target_env</span><span class="o">.</span><span class="n">get_tgt_sig_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_env</span><span class="o">.</span><span class="n">decide_source</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_env</span><span class="o">.</span><span class="n">decide_target</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._changed_timestamp_then_content"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_timestamp_then_content">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_timestamp_then_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dependency</span><span class="o">.</span><span class="n">changed_timestamp_then_content</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._changed_timestamp_newer"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_timestamp_newer">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_timestamp_newer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dependency</span><span class="o">.</span><span class="n">changed_timestamp_newer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._changed_timestamp_match"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._changed_timestamp_match">[docs]</a>    <span class="k">def</span> <span class="nf">_changed_timestamp_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dependency</span><span class="o">.</span><span class="n">changed_timestamp_match</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prev_ni</span><span class="p">,</span> <span class="n">repo_node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._copy_from_cache"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._copy_from_cache">[docs]</a>    <span class="k">def</span> <span class="nf">_copy_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._copy2_from_cache"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._copy2_from_cache">[docs]</a>    <span class="k">def</span> <span class="nf">_copy2_from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Decider"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Decider">[docs]</a>    <span class="k">def</span> <span class="nf">Decider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="n">copy_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy2_from_cache</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;MD5&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">md5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;MD5 signatures are not available in this version of Python.&quot;</span><span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed_content</span>
        <span class="k">elif</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;MD5-timestamp&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed_timestamp_then_content</span>
        <span class="k">elif</span> <span class="n">function</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;timestamp-newer&#39;</span><span class="p">,</span> <span class="s1">&#39;make&#39;</span><span class="p">):</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed_timestamp_newer</span>
            <span class="n">copy_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_from_cache</span>
        <span class="k">elif</span> <span class="n">function</span> <span class="o">==</span> <span class="s1">&#39;timestamp-match&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changed_timestamp_match</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Unknown Decider value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">function</span><span class="p">))</span>

        <span class="c1"># We don&#39;t use AddMethod because we don&#39;t want to turn the</span>
        <span class="c1"># function, which only expects three arguments, into a bound</span>
        <span class="c1"># method, which would add self as an initial, fourth argument.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decide_target</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decide_source</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_from_cache</span> <span class="o">=</span> <span class="n">copy_function</span></div>


<div class="viewcode-block" id="Base.Detect"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Detect">[docs]</a>    <span class="k">def</span> <span class="nf">Detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">progs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the first available program from one or more possibilities.</span>

<span class="sd">        Args:</span>
<span class="sd">            progs (str or list): one or more command names to check for</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">progs</span><span class="p">):</span>
            <span class="n">progs</span> <span class="o">=</span> <span class="p">[</span><span class="n">progs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">prog</span> <span class="ow">in</span> <span class="n">progs</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WhereIs</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">:</span> <span class="k">return</span> <span class="n">prog</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Base.Dictionary"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Dictionary">[docs]</a>    <span class="k">def</span> <span class="nf">Dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return construction variables from an environment.</span>

<span class="sd">        Args:</span>
<span class="sd">          \*args (optional): variable names to look up</span>

<span class="sd">        Returns:</span>
<span class="sd">          If `args` omitted, the dictionary of all construction variables.</span>
<span class="sd">          If one arg, the corresponding value is returned.</span>
<span class="sd">          If more than one arg, a list of values is returned.</span>

<span class="sd">        Raises:</span>
<span class="sd">          KeyError: if any of `args` is not in the construction environment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>
        <span class="n">dlist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dlist</span> <span class="o">=</span> <span class="n">dlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dlist</span></div>


<div class="viewcode-block" id="Base.Dump"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Dump">[docs]</a>    <span class="k">def</span> <span class="nf">Dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pretty&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return construction variables serialized to a string.</span>

<span class="sd">        Args:</span>
<span class="sd">          key (optional): if None, format the whole dict of variables.</span>
<span class="sd">            Else format the value of `key` (Default value = None)</span>
<span class="sd">          format (str, optional): specify the format to serialize to.</span>
<span class="sd">            `&quot;pretty&quot;` generates a pretty-printed string,</span>
<span class="sd">            `&quot;json&quot;` a JSON-formatted string.</span>
<span class="sd">            (Default value = `&quot;pretty&quot;`)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">cvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;pretty&#39;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pprint</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># TODO: pprint doesn&#39;t do a nice job on path-style values</span>
            <span class="c1"># if the paths contain spaces (i.e. Windows), because the</span>
            <span class="c1"># algorithm tries to break lines on spaces, while breaking</span>
            <span class="c1"># on the path-separator would be more &quot;natural&quot;. Is there</span>
            <span class="c1"># a better way to format those?</span>
            <span class="k">return</span> <span class="n">pp</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">cvars</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">json</span>
            <span class="k">def</span> <span class="nf">non_serializable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cvars</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">non_serializable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported serialization format: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">fmt</span><span class="p">)</span></div>


<div class="viewcode-block" id="Base.FindIxes"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.FindIxes">[docs]</a>    <span class="k">def</span> <span class="nf">FindIxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search a list of paths for something that matches the prefix and suffix.</span>

<span class="sd">        Args:</span>
<span class="sd">          paths: the list of paths or nodes.</span>
<span class="sd">          prefix: construction variable for the prefix.</span>
<span class="sd">          suffix: construction variable for the suffix.</span>

<span class="sd">        Returns: the matched path or None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">prefix</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="nb">dir</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]</span> <span class="o">==</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">):]</span> <span class="o">==</span> <span class="n">suffix</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="Base.ParseConfig"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.ParseConfig">[docs]</a>    <span class="k">def</span> <span class="nf">ParseConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the specified function to parse the output of the command</span>
<span class="sd">        in order to modify the current environment.  The &#39;command&#39; can</span>
<span class="sd">        be a string or a list of strings representing a command and</span>
<span class="sd">        its arguments.  &#39;Function&#39; is an optional argument that takes</span>
<span class="sd">        the environment, the output of the command, and the unique flag.</span>
<span class="sd">        If no function is specified, MergeFlags, which treats the output</span>
<span class="sd">        as the result of a typical &#39;X-config&#39; command (i.e. gtk-config),</span>
<span class="sd">        will merge the output into the appropriate variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">parse_conf</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">MergeFlags</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">parse_conf</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backtick</span><span class="p">(</span><span class="n">command</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.ParseDepends"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.ParseDepends">[docs]</a>    <span class="k">def</span> <span class="nf">ParseDepends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_one</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a mkdep-style file for explicit dependencies.  This is</span>
<span class="sd">        completely abusable, and should be unnecessary in the &quot;normal&quot;</span>
<span class="sd">        case of proper SCons configuration, but it may help make</span>
<span class="sd">        the transition from a Make hierarchy easier for some people</span>
<span class="sd">        to swallow.  It can also be genuinely useful when using a tool</span>
<span class="sd">        that can write a .d file, but for which writing a scanner would</span>
<span class="sd">        be too complicated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">LogicalLines</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">must_exist</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;#&#39;</span><span class="p">]</span>
        <span class="n">tdlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">target</span><span class="p">,</span> <span class="n">depends</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Throws AttributeError if line isn&#39;t a string.  Can throw</span>
                <span class="c1"># ValueError if line doesn&#39;t split into two or more elements.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tdlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">depends</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">only_one</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tdlist</span><span class="p">:</span>
                <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">td</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                            <span class="s2">&quot;More than one dependency target found in `</span><span class="si">%s</span><span class="s2">&#39;:  </span><span class="si">%s</span><span class="s2">&quot;</span>
                                            <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">depends</span> <span class="ow">in</span> <span class="n">tdlist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Depends</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">depends</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Platform"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Platform">[docs]</a>    <span class="k">def</span> <span class="nf">Platform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">platform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Platform</span><span class="o">.</span><span class="n">Platform</span><span class="p">(</span><span class="n">platform</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Prepend"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Prepend">[docs]</a>    <span class="k">def</span> <span class="nf">Prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepend values to existing construction variables</span>
<span class="sd">        in an Environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># It would be easier on the eyes to write this using</span>
            <span class="c1"># &quot;continue&quot; statements whenever we finish processing an item,</span>
            <span class="c1"># but Python 1.5.2 apparently doesn&#39;t let you use &quot;continue&quot;</span>
            <span class="c1"># within try:-except: blocks, so we have to nest our code.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># No existing variable in the environment, so just set</span>
                <span class="c1"># it to the new value.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check if the original looks like a dictionary.</span>
                    <span class="c1"># If it is, we can&#39;t just try adding the value because</span>
                    <span class="c1"># dictionaries don&#39;t have __add__() methods, and</span>
                    <span class="c1"># things like UserList will incorrectly coerce the</span>
                    <span class="c1"># original dict to a list (which we don&#39;t want).</span>
                    <span class="n">update_dict</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">update</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Most straightforward:  just try to add them</span>
                        <span class="c1"># together.  This will work in most cases, when the</span>
                        <span class="c1"># original and new values are of compatible types.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">orig</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Check if the added value is a list.</span>
                            <span class="n">add_to_val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">append</span>
                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="c1"># The added value isn&#39;t a list, but the</span>
                            <span class="c1"># original is (by process of elimination),</span>
                            <span class="c1"># so insert the the new value in the original</span>
                            <span class="c1"># (if there&#39;s one to insert).</span>
                            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">orig</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># The added value is a list, so append</span>
                            <span class="c1"># the original to it (if there&#39;s a value</span>
                            <span class="c1"># to append).</span>
                            <span class="k">if</span> <span class="n">orig</span><span class="p">:</span>
                                <span class="n">add_to_val</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># The original looks like a dictionary, so update it</span>
                    <span class="c1"># based on what we think the value looks like.</span>
                    <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                            <span class="n">orig</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">update_dict</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="n">orig</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">orig</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.PrependENVPath"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.PrependENVPath">[docs]</a>    <span class="k">def</span> <span class="nf">PrependENVPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">envname</span> <span class="o">=</span> <span class="s1">&#39;ENV&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">,</span>
                       <span class="n">delete_existing</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepend path elements to the path &#39;name&#39; in the &#39;ENV&#39;</span>
<span class="sd">        dictionary for this environment.  Will only add any particular</span>
<span class="sd">        path once, and will normpath and normcase all paths to help</span>
<span class="sd">        assure this.  This can also handle the case where the env</span>
<span class="sd">        variable is a list instead of a string.</span>

<span class="sd">        If delete_existing is 0, a newpath which is already in the path</span>
<span class="sd">        will not be moved to the front (it will be left where it is).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">envname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">]:</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="n">nv</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">PrependPath</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">delete_existing</span><span class="p">,</span>
                                    <span class="n">canonicalize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_canonicalize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">envname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">envname</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv</span></div>

<div class="viewcode-block" id="Base.PrependUnique"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.PrependUnique">[docs]</a>    <span class="k">def</span> <span class="nf">PrependUnique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepend values to existing construction variables</span>
<span class="sd">        in an Environment, if they&#39;re not already there.</span>
<span class="sd">        If delete_existing is 1, removes existing values first, so</span>
<span class="sd">        values move to front.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_delete_duplicates</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="ow">not</span> <span class="n">delete_existing</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">and</span> \
                 <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Dict</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                    <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">dk</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                    <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">dk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">dk</span><span class="p">):</span>
                    <span class="c1"># By elimination, val is not a list.  Since dk is a</span>
                    <span class="c1"># list, wrap val in a list first.</span>
                    <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">+</span> <span class="n">dk</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">+</span> <span class="n">dk</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
                        <span class="n">dk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dk</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">dk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Replace"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Replace">[docs]</a>    <span class="k">def</span> <span class="nf">Replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace existing construction variables in an Environment</span>
<span class="sd">        with new construction variables and/or values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kwbd</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwbd</span> <span class="o">=</span> <span class="n">BuilderDict</span><span class="p">(</span><span class="n">kwbd</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="s1">&#39;BUILDERS&#39;</span><span class="p">,</span> <span class="n">kwbd</span><span class="p">)</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">semi_deepcopy</span><span class="p">(</span><span class="n">kw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner_map_delete</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.ReplaceIxes"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.ReplaceIxes">[docs]</a>    <span class="k">def</span> <span class="nf">ReplaceIxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">old_prefix</span><span class="p">,</span> <span class="n">old_suffix</span><span class="p">,</span> <span class="n">new_prefix</span><span class="p">,</span> <span class="n">new_suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace old_prefix with new_prefix and old_suffix with new_suffix.</span>

<span class="sd">        env - Environment used to interpolate variables.</span>
<span class="sd">        path - the path that will be modified.</span>
<span class="sd">        old_prefix - construction variable for the old prefix.</span>
<span class="sd">        old_suffix - construction variable for the old suffix.</span>
<span class="sd">        new_prefix - construction variable for the new prefix.</span>
<span class="sd">        new_suffix - construction variable for the new suffix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">old_prefix</span><span class="p">)</span>
        <span class="n">old_suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">old_suffix</span><span class="p">)</span>

        <span class="n">new_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">new_prefix</span><span class="p">)</span>
        <span class="n">new_suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">new_suffix</span><span class="p">)</span>

        <span class="nb">dir</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">old_prefix</span><span class="p">)]</span> <span class="o">==</span> <span class="n">old_prefix</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">old_prefix</span><span class="p">):]</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">old_suffix</span><span class="p">):]</span> <span class="o">==</span> <span class="n">old_suffix</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">old_suffix</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">new_prefix</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="n">new_suffix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.SetDefault"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.SetDefault">[docs]</a>    <span class="k">def</span> <span class="nf">SetDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base._find_toolpath_dir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base._find_toolpath_dir">[docs]</a>    <span class="k">def</span> <span class="nf">_find_toolpath_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tp</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">tp</span><span class="p">))</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">()</span></div>

<div class="viewcode-block" id="Base.Tool"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Tool">[docs]</a>    <span class="k">def</span> <span class="nf">Tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">toolpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">tool</span><span class="p">):</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toolpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toolpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolpath&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">toolpath</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_toolpath_dir</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">))</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Tool</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.WhereIs"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.WhereIs">[docs]</a>    <span class="k">def</span> <span class="nf">WhereIs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Find prog in the path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ENV&#39;</span><span class="p">][</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pathext</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ENV&#39;</span><span class="p">][</span><span class="s1">&#39;PATHEXT&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">pathext</span><span class="p">):</span>
            <span class="n">pathext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">pathext</span><span class="p">)</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">CLVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">prog</span><span class="p">))</span> <span class="c1"># support &quot;program --with-args&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">WhereIs</span><span class="p">(</span><span class="n">prog</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path</span><span class="p">,</span> <span class="n">pathext</span><span class="p">,</span> <span class="n">reject</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span> <span class="k">return</span> <span class="n">path</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1">#######################################################################</span>
    <span class="c1"># Public methods for doing real &quot;SCons stuff&quot; (manipulating</span>
    <span class="c1"># dependencies, setting attributes on targets, etc.).  These begin</span>
    <span class="c1"># with upper-case letters.  The essential characteristic of methods</span>
    <span class="c1"># in this section is that they all *should* have corresponding</span>
    <span class="c1"># same-named global functions.</span>
    <span class="c1">#######################################################################</span>

<div class="viewcode-block" id="Base.Action"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Action">[docs]</a>    <span class="k">def</span> <span class="nf">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">subst_string</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">subst_string</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
        <span class="n">nkw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">nkw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.AddPreAction"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.AddPreAction">[docs]</a>    <span class="k">def</span> <span class="nf">AddPreAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]:</span>
            <span class="n">uniq</span><span class="p">[</span><span class="n">executor</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="n">uniq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">add_pre_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span></div>

<div class="viewcode-block" id="Base.AddPostAction"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.AddPostAction">[docs]</a>    <span class="k">def</span> <span class="nf">AddPostAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]:</span>
            <span class="n">uniq</span><span class="p">[</span><span class="n">executor</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="n">uniq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">add_post_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span></div>

<div class="viewcode-block" id="Base.Alias"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Alias">[docs]</a>    <span class="k">def</span> <span class="nf">Alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">[],</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ans</span><span class="o">.</span><span class="n">Alias</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="n">source</span> <span class="k">if</span> <span class="n">_f</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="p">:</span>
                <span class="c1"># There are no source files and no action, so just</span>
                <span class="c1"># return a target list of classic Alias Nodes, without</span>
                <span class="c1"># any builder.  The externally visible effect is that</span>
                <span class="c1"># this will make the wrapping Script.BuildTask class</span>
                <span class="c1"># say that there&#39;s &quot;Nothing to be done&quot; for this Alias,</span>
                <span class="c1"># instead of that it&#39;s &quot;up to date.&quot;</span>
                <span class="k">return</span> <span class="n">tlist</span>

            <span class="c1"># No action, but there are sources.  Re-call all the target</span>
            <span class="c1"># builders to add the sources to each target.</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
                <span class="n">bld</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">get_builder</span><span class="p">(</span><span class="n">AliasBuilder</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">nkw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">nkw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;action&#39;</span>            <span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">action</span><span class="p">),</span>
            <span class="s1">&#39;source_factory&#39;</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">,</span>
            <span class="s1">&#39;multi&#39;</span>             <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;is_explicit&#39;</span>       <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">bld</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="o">**</span><span class="n">nkw</span><span class="p">)</span>

        <span class="c1"># Apply the Builder separately to each target so that the Aliases</span>
        <span class="c1"># stay separate.  If we did one &quot;normal&quot; Builder call with the</span>
        <span class="c1"># whole target list, then all of the target Aliases would be</span>
        <span class="c1"># associated under a single Executor.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="c1"># Calling the convert() method will cause a new Executor to be</span>
            <span class="c1"># created from scratch, so we have to explicitly initialize</span>
            <span class="c1"># it with the target&#39;s existing sources, plus our new ones,</span>
            <span class="c1"># so nothing gets lost.</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">get_builder</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">AliasBuilder</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">bld</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">action</span> <span class="o">+</span> <span class="n">action</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="o">**</span><span class="n">nkw</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">sources</span> <span class="o">+</span> <span class="n">source</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.AlwaysBuild"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.AlwaysBuild">[docs]</a>    <span class="k">def</span> <span class="nf">AlwaysBuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_always_build</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Builder"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Builder">[docs]</a>    <span class="k">def</span> <span class="nf">Builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">nkw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="o">**</span><span class="n">nkw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.CacheDir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.CacheDir">[docs]</a>    <span class="k">def</span> <span class="nf">CacheDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">SCons.CacheDir</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CacheDir_path</span> <span class="o">=</span> <span class="n">path</span></div>

<div class="viewcode-block" id="Base.Clean"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Clean">[docs]</a>    <span class="k">def</span> <span class="nf">Clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">CleanTargets</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">flist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">CleanTargets</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">CleanTargets</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">flist</span></div>

<div class="viewcode-block" id="Base.Configure"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Configure">[docs]</a>    <span class="k">def</span> <span class="nf">Configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nkw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_depth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;custom_tests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;custom_tests&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">SConf</span><span class="o">.</span><span class="n">SConf</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">nkw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Command"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Command">[docs]</a>    <span class="k">def</span> <span class="nf">Command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds the supplied target files from the supplied</span>
<span class="sd">        source files using the supplied action.  Action may</span>
<span class="sd">        be any type that the Builder constructor will accept</span>
<span class="sd">        for an action.&quot;&quot;&quot;</span>
        <span class="n">bkw</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
            <span class="s1">&#39;target_factory&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">,</span>
            <span class="s1">&#39;source_factory&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># source scanner</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bkw</span><span class="p">[</span><span class="s1">&#39;source_scanner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;source_scanner&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;source_scanner&#39;</span><span class="p">]</span>

        <span class="c1"># target scanner</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bkw</span><span class="p">[</span><span class="s1">&#39;target_scanner&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;target_scanner&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;target_scanner&#39;</span><span class="p">]</span>

        <span class="c1"># source factory</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bkw</span><span class="p">[</span><span class="s1">&#39;source_factory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;source_factory&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;source_factory&#39;</span><span class="p">]</span>

        <span class="c1"># target factory</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bkw</span><span class="p">[</span><span class="s1">&#39;target_factory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;target_factory&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;target_factory&#39;</span><span class="p">]</span>

        <span class="n">bld</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="o">**</span><span class="n">bkw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Depends"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Depends">[docs]</a>    <span class="k">def</span> <span class="nf">Depends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">dependency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Explicity specify that &#39;target&#39;s depend on &#39;dependency&#39;.&quot;&quot;&quot;</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">dlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">add_dependency</span><span class="p">(</span><span class="n">dlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Dir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Dir">[docs]</a>    <span class="k">def</span> <span class="nf">Dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Sequence</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.PyPackageDir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.PyPackageDir">[docs]</a>    <span class="k">def</span> <span class="nf">PyPackageDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modulename</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">modulename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Sequence</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PyPackageDir</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PyPackageDir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.NoClean"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.NoClean">[docs]</a>    <span class="k">def</span> <span class="nf">NoClean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tags a target so that it will not be cleaned by -c&quot;&quot;&quot;</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_noclean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.NoCache"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.NoCache">[docs]</a>    <span class="k">def</span> <span class="nf">NoCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tags a target so that it will not be cached&quot;&quot;&quot;</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_nocache</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Entry"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Entry">[docs]</a>    <span class="k">def</span> <span class="nf">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Sequence</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Environment"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Environment">[docs]</a>    <span class="k">def</span> <span class="nf">Environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.Execute"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Execute">[docs]</a>    <span class="k">def</span> <span class="nf">Execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Directly execute an action through an Environment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">action</span><span class="p">([],</span> <span class="p">[],</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">BuildError</span><span class="p">):</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">errstr</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">errstr</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;scons: *** </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">errstr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Base.File"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.File">[docs]</a>    <span class="k">def</span> <span class="nf">File</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_Sequence</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.FindFile"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.FindFile">[docs]</a>    <span class="k">def</span> <span class="nf">FindFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">dirs</span><span class="p">):</span>
        <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">find_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.Flatten"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Flatten">[docs]</a>    <span class="k">def</span> <span class="nf">Flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.GetBuildPath"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.GetBuildPath">[docs]</a>    <span class="k">def</span> <span class="nf">GetBuildPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Base.Glob"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Glob">[docs]</a>    <span class="k">def</span> <span class="nf">Glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">ondisk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">ondisk</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">strings</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Ignore"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Ignore">[docs]</a>    <span class="k">def</span> <span class="nf">Ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">dependency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ignore a dependency.&quot;&quot;&quot;</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">dlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">add_ignore</span><span class="p">(</span><span class="n">dlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Literal"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Literal">[docs]</a>    <span class="k">def</span> <span class="nf">Literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">Literal</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Local"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Local">[docs]</a>    <span class="k">def</span> <span class="nf">Local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targ</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
                <span class="n">targ</span><span class="o">.</span><span class="n">set_local</span><span class="p">()</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">targ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">):</span>
                   <span class="n">t</span><span class="o">.</span><span class="n">set_local</span><span class="p">()</span>
                   <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Base.Precious"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Precious">[docs]</a>    <span class="k">def</span> <span class="nf">Precious</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_precious</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Pseudo"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Pseudo">[docs]</a>    <span class="k">def</span> <span class="nf">Pseudo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_pseudo</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Repository"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Repository">[docs]</a>    <span class="k">def</span> <span class="nf">Repository</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">dirs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dirs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Repository</span><span class="p">(</span><span class="o">*</span><span class="n">dirs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.Requires"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Requires">[docs]</a>    <span class="k">def</span> <span class="nf">Requires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">prerequisite</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specify that &#39;prerequisite&#39; must be built before &#39;target&#39;,</span>
<span class="sd">        (but &#39;target&#39; does not actually depend on &#39;prerequisite&#39;</span>
<span class="sd">        and need not be rebuilt if it changes).&quot;&quot;&quot;</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">prerequisite</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">add_prerequisite</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tlist</span></div>

<div class="viewcode-block" id="Base.Scanner"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Scanner">[docs]</a>    <span class="k">def</span> <span class="nf">Scanner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">nargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">nkw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Scanner</span><span class="o">.</span><span class="n">Base</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">nkw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.SConsignFile"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.SConsignFile">[docs]</a>    <span class="k">def</span> <span class="nf">SConsignFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;.sconsign&quot;</span><span class="p">,</span> <span class="n">dbm_module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">SConstruct_dir</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">sconsign_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sconsign_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sconsign_dir</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">Mkdir</span><span class="p">(</span><span class="n">sconsign_dir</span><span class="p">))</span>
        <span class="n">SCons</span><span class="o">.</span><span class="n">SConsign</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dbm_module</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.SideEffect"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.SideEffect">[docs]</a>    <span class="k">def</span> <span class="nf">SideEffect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side_effect</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tell scons that side_effects are built as side</span>
<span class="sd">        effects of building targets.&quot;&quot;&quot;</span>
        <span class="n">side_effects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">side_effect</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">side_effect</span> <span class="ow">in</span> <span class="n">side_effects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">side_effect</span><span class="o">.</span><span class="n">multiple_side_effect_has_builder</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Multiple ways to build the same target were specified for: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">side_effect</span><span class="p">))</span>
            <span class="n">side_effect</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
            <span class="n">side_effect</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Precious</span><span class="p">(</span><span class="n">side_effect</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">side_effects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">side_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">side_effects</span></div>

<div class="viewcode-block" id="Base.Split"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Split">[docs]</a>    <span class="k">def</span> <span class="nf">Split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function converts a string or list into a list of strings</span>
<span class="sd">        or Nodes.  This makes things easier for users by allowing files to</span>
<span class="sd">        be specified as a white-space separated list to be split.</span>

<span class="sd">        The input rules are:</span>
<span class="sd">            - A single string containing names separated by spaces. These will be</span>
<span class="sd">              split apart at the spaces.</span>
<span class="sd">            - A single Node instance</span>
<span class="sd">            - A list containing either strings or Node instances. Any strings</span>
<span class="sd">              in the list are not split at spaces.</span>

<span class="sd">        In all cases, the function returns a list of Nodes and strings.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_List</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">,</span> <span class="n">arg</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">is_String</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">arg</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Base.Value"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.Value">[docs]</a>    <span class="k">def</span> <span class="nf">Value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">built_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">Python</span><span class="o">.</span><span class="n">ValueWithMemo</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">built_value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.VariantDir"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.VariantDir">[docs]</a>    <span class="k">def</span> <span class="nf">VariantDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant_dir</span><span class="p">,</span> <span class="n">src_dir</span><span class="p">,</span> <span class="n">duplicate</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">variant_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">src_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">VariantDir</span><span class="p">(</span><span class="n">variant_dir</span><span class="p">,</span> <span class="n">src_dir</span><span class="p">,</span> <span class="n">duplicate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Base.FindSourceFiles"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.FindSourceFiles">[docs]</a>    <span class="k">def</span> <span class="nf">FindSourceFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a list of all source files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2nodes</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">Entry</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">build_source</span><span class="p">(</span><span class="n">ss</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">Dir</span><span class="p">):</span>
                    <span class="n">build_source</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">all_children</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">has_builder</span><span class="p">():</span>
                    <span class="n">build_source</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">(),</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Node</span><span class="o">.</span><span class="n">FS</span><span class="o">.</span><span class="n">File</span><span class="p">):</span>
                    <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">build_source</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">all_children</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">final_source</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">node</span> <span class="o">!=</span> <span class="n">node</span><span class="o">.</span><span class="n">srcnode</span><span class="p">():</span>
              <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">srcnode</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">final_source</span><span class="p">,</span> <span class="n">sources</span><span class="p">))</span>
        <span class="c1"># remove duplicates</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sources</span><span class="p">))</span></div>

<div class="viewcode-block" id="Base.FindInstalledFiles"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.Base.FindInstalledFiles">[docs]</a>    <span class="k">def</span> <span class="nf">FindInstalledFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the list of all targets of the Install and InstallAs Builder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">SCons.Tool</span> <span class="kn">import</span> <span class="n">install</span>
        <span class="k">if</span> <span class="n">install</span><span class="o">.</span><span class="n">_UNIQUE_INSTALLED_FILES</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">install</span><span class="o">.</span><span class="n">_UNIQUE_INSTALLED_FILES</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">uniquer_hashables</span><span class="p">(</span><span class="n">install</span><span class="o">.</span><span class="n">_INSTALLED_FILES</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">install</span><span class="o">.</span><span class="n">_UNIQUE_INSTALLED_FILES</span></div></div>


<div class="viewcode-block" id="OverrideEnvironment"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment">[docs]</a><span class="k">class</span> <span class="nc">OverrideEnvironment</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A proxy that overrides variables in a wrapped construction</span>
<span class="sd">    environment by returning values from an overrides dictionary in</span>
<span class="sd">    preference to values from the underlying subject environment.</span>

<span class="sd">    This is a lightweight (I hope) proxy that passes through most use of</span>
<span class="sd">    attributes to the underlying Environment.Base class, but has just</span>
<span class="sd">    enough additional methods defined to act like a real construction</span>
<span class="sd">    environment with overridden values.  It can wrap either a Base</span>
<span class="sd">    construction environment, or another OverrideEnvironment, which</span>
<span class="sd">    can in turn nest arbitrary OverrideEnvironments...</span>

<span class="sd">    Note that we do *not* call the underlying base class</span>
<span class="sd">    (SubsitutionEnvironment) initialization, because we get most of those</span>
<span class="sd">    from proxying the attributes of the subject construction environment.</span>
<span class="sd">    But because we subclass SubstitutionEnvironment, this class also</span>
<span class="sd">    has inherited arg2nodes() and subst*() methods; those methods can&#39;t</span>
<span class="sd">    be proxied because they need *this* object&#39;s methods to fetch the</span>
<span class="sd">    values from the overrides dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Environment.OverrideEnvironment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="k">if</span> <span class="n">overrides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overrides</span>

    <span class="c1"># Methods that make this class act like a proxy.</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1"># Here we check if attr is one of the Wrapper classes. For</span>
        <span class="c1"># example when a pseudo-builder is being called from an</span>
        <span class="c1"># OverrideEnvironment.</span>
        <span class="c1">#</span>
        <span class="c1"># These wrappers when they&#39;re constructed capture the</span>
        <span class="c1"># Environment they are being constructed with and so will not</span>
        <span class="c1"># have access to overrided values. So we rebuild them with the</span>
        <span class="c1"># OverrideEnvironment so they have access to overrided values.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="n">MethodWrapper</span><span class="p">,</span> <span class="n">BuilderWrapper</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1"># Methods that make this class act like a dictionary.</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_construction_var</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Illegal construction variable `</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deleted</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">deleted</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="OverrideEnvironment.get"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the get() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="OverrideEnvironment.has_key"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.has_key">[docs]</a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the has_key() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="OverrideEnvironment.Dictionary"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.Dictionary">[docs]</a>    <span class="k">def</span> <span class="nf">Dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="OverrideEnvironment.items"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the items() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

<div class="viewcode-block" id="OverrideEnvironment.keys"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the keys() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="OverrideEnvironment.values"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emulates the values() method of dictionaries.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>

    <span class="c1"># Overridden private construction environment methods.</span>
<div class="viewcode-block" id="OverrideEnvironment._update"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment._update">[docs]</a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="OverrideEnvironment._update_onlynew"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment._update_onlynew">[docs]</a>    <span class="k">def</span> <span class="nf">_update_onlynew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>

<div class="viewcode-block" id="OverrideEnvironment.gvars"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.gvars">[docs]</a>    <span class="k">def</span> <span class="nf">gvars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gvars</span><span class="p">()</span></div>

<div class="viewcode-block" id="OverrideEnvironment.lvars"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.lvars">[docs]</a>    <span class="k">def</span> <span class="nf">lvars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lvars</span><span class="p">()</span>
        <span class="n">lvars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">lvars</span></div>

    <span class="c1"># Overridden public construction environment methods.</span>
<div class="viewcode-block" id="OverrideEnvironment.Replace"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.OverrideEnvironment.Replace">[docs]</a>    <span class="k">def</span> <span class="nf">Replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">copy_non_reserved_keywords</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;overrides&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">semi_deepcopy</span><span class="p">(</span><span class="n">kw</span><span class="p">))</span></div></div>


<span class="c1"># The entry point that will be used by the external world</span>
<span class="c1"># to refer to a construction environment.  This allows the wrapper</span>
<span class="c1"># interface to extend a construction environment for its own purposes</span>
<span class="c1"># by subclassing SCons.Environment.Base and then assigning the</span>
<span class="c1"># class to SCons.Environment.Environment.</span>

<span class="n">Environment</span> <span class="o">=</span> <span class="n">Base</span>


<div class="viewcode-block" id="NoSubstitutionProxy"><a class="viewcode-back" href="../../../SCons/#SCons.Environment.NoSubstitutionProxy">[docs]</a><span class="k">def</span> <span class="nf">NoSubstitutionProxy</span><span class="p">(</span><span class="n">subject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An entry point for returning a proxy subclass instance that overrides</span>
<span class="sd">    the subst*() methods so they don&#39;t actually perform construction</span>
<span class="sd">    variable substitution.  This is specifically intended to be the shim</span>
<span class="sd">    layer in between global function calls (which don&#39;t want construction</span>
<span class="sd">    variable substitution) and the DefaultEnvironment() (which would</span>
<span class="sd">    substitute variables if left to its own devices).</span>

<span class="sd">    We have to wrap this in a function that allows us to delay definition of</span>
<span class="sd">    the class until it&#39;s necessary, so that when it subclasses Environment</span>
<span class="sd">    it will pick up whatever Environment subclass the wrapper interface</span>
<span class="sd">    might have assigned to SCons.Environment.Environment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">_NoSubstitutionProxy</span><span class="p">(</span><span class="n">Environment</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;__subject&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">executor_to_lvars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwdict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;executor&#39;</span> <span class="ow">in</span> <span class="n">kwdict</span><span class="p">:</span>
                <span class="n">kwdict</span><span class="p">[</span><span class="s1">&#39;lvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwdict</span><span class="p">[</span><span class="s1">&#39;executor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lvars</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">kwdict</span><span class="p">[</span><span class="s1">&#39;executor&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwdict</span><span class="p">[</span><span class="s1">&#39;lvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">def</span> <span class="nf">raw_to_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span>
        <span class="k">def</span> <span class="nf">subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>
        <span class="k">def</span> <span class="nf">subst_kw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">kw</span>
        <span class="k">def</span> <span class="nf">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
            <span class="n">nkw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;gvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executor_to_lvars</span><span class="p">(</span><span class="n">nkw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_to_mode</span><span class="p">(</span><span class="n">nkw</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst_list</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">nkw</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">subst_target_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
            <span class="n">nkw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">nkw</span><span class="p">[</span><span class="s1">&#39;gvars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executor_to_lvars</span><span class="p">(</span><span class="n">nkw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_to_mode</span><span class="p">(</span><span class="n">nkw</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">scons_subst</span><span class="p">(</span><span class="o">*</span><span class="n">nargs</span><span class="p">,</span> <span class="o">**</span><span class="n">nkw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_NoSubstitutionProxy</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span></div>

<span class="c1"># Local Variables:</span>
<span class="c1"># tab-width:4</span>
<span class="c1"># indent-tabs-mode:nil</span>
<span class="c1"># End:</span>
<span class="c1"># vim: set expandtab tabstop=4 shiftwidth=4:</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, SCons Project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>