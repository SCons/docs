

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SCons.Action &mdash; SCons 4.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../" class="icon icon-home"> SCons
          

          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons/">SCons package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons">Module contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Action">SCons.Action module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Builder">SCons.Builder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.CacheDir">SCons.CacheDir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Conftest">SCons.Conftest module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Debug">SCons.Debug module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Defaults">SCons.Defaults module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Environment">SCons.Environment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Errors">SCons.Errors module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Executor">SCons.Executor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Job">SCons.Job module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Memoize">SCons.Memoize module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.PathList">SCons.PathList module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConf">SCons.SConf module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.SConsign">SCons.SConsign module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Subst">SCons.Subst module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Taskmaster">SCons.Taskmaster module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Util">SCons.Util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.Warnings">SCons.Warnings module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.cpp">SCons.cpp module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.dblite">SCons.dblite module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons/#module-SCons.exitfuncs">SCons.exitfuncs module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.compat/">SCons.compat package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.compat/#module-SCons.compat">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Node/">SCons.Node package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Alias">SCons.Node.Alias module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.FS">SCons.Node.FS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node.Python">SCons.Node.Python module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Node/#module-SCons.Node">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Platform/">SCons.Platform package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.aix">SCons.Platform.aix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.cygwin">SCons.Platform.cygwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.darwin">SCons.Platform.darwin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.hpux">SCons.Platform.hpux module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.irix">SCons.Platform.irix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.mingw">SCons.Platform.mingw module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.os2">SCons.Platform.os2 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.posix">SCons.Platform.posix module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.sunos">SCons.Platform.sunos module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.virtualenv">SCons.Platform.virtualenv module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform.win32">SCons.Platform.win32 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Platform/#module-SCons.Platform">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Scanner/">SCons.Scanner package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.C">SCons.Scanner.C module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.D">SCons.Scanner.D module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Dir">SCons.Scanner.Dir module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Fortran">SCons.Scanner.Fortran module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.IDL">SCons.Scanner.IDL module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.LaTeX">SCons.Scanner.LaTeX module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.Prog">SCons.Scanner.Prog module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.RC">SCons.Scanner.RC module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner.SWIG">SCons.Scanner.SWIG module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Scanner/#module-SCons.Scanner">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Script/">SCons.Script package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Interactive">SCons.Script.Interactive module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.Main">SCons.Script.Main module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConsOptions">SCons.Script.SConsOptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script.SConscript">SCons.Script.SConscript module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Script/#module-SCons.Script">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Tool/">SCons.Tool package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Tool/#module-SCons.Tool">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../SCons.Variables/">SCons.Variables package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.BoolVariable">SCons.Variables.BoolVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.EnumVariable">SCons.Variables.EnumVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.ListVariable">SCons.Variables.ListVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PackageVariable">SCons.Variables.PackageVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables.PathVariable">SCons.Variables.PathVariable module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SCons.Variables/#module-SCons.Variables">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">SCons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../">Docs</a> &raquo;</li>
        
          <li><a href="../../">Module code</a> &raquo;</li>
        
      <li>SCons.Action</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SCons.Action</h1><div class="highlight"><pre>
<span></span><span class="c1"># MIT License</span>
<span class="c1">#</span>
<span class="c1"># Copyright The SCons Foundation</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining</span>
<span class="c1"># a copy of this software and associated documentation files (the</span>
<span class="c1"># &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="c1"># without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="c1"># distribute, sublicense, and/or sell copies of the Software, and to</span>
<span class="c1"># permit persons to whom the Software is furnished to do so, subject to</span>
<span class="c1"># the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included</span>
<span class="c1"># in all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY</span>
<span class="c1"># KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE</span>
<span class="c1"># WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="c1"># NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE</span>
<span class="c1"># LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="c1"># OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="c1"># WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="sd">&quot;&quot;&quot;SCons Actions.</span>

<span class="sd">Information about executing any sort of action that</span>
<span class="sd">can build one or more target Nodes (typically files) from one or more</span>
<span class="sd">source Nodes (also typically files) given a specific Environment.</span>

<span class="sd">The base class here is ActionBase.  The base class supplies just a few</span>
<span class="sd">utility methods and some generic methods for displaying information</span>
<span class="sd">about an Action in response to the various commands that control printing.</span>

<span class="sd">A second-level base class is _ActionAction.  This extends ActionBase</span>
<span class="sd">by providing the methods that can be used to show and perform an</span>
<span class="sd">action.  True Action objects will subclass _ActionAction; Action</span>
<span class="sd">factory class objects will subclass ActionBase.</span>

<span class="sd">The heavy lifting is handled by subclasses for the different types of</span>
<span class="sd">actions we might execute:</span>

<span class="sd">    CommandAction</span>
<span class="sd">    CommandGeneratorAction</span>
<span class="sd">    FunctionAction</span>
<span class="sd">    ListAction</span>

<span class="sd">The subclasses supply the following public interface methods used by</span>
<span class="sd">other modules:</span>

<span class="sd">    __call__()</span>
<span class="sd">        THE public interface, &quot;calling&quot; an Action object executes the</span>
<span class="sd">        command or Python function.  This also takes care of printing</span>
<span class="sd">        a pre-substitution command for debugging purposes.</span>

<span class="sd">    get_contents()</span>
<span class="sd">        Fetches the &quot;contents&quot; of an Action for signature calculation</span>
<span class="sd">        plus the varlist.  This is what gets MD5 checksummed to decide</span>
<span class="sd">        if a target needs to be rebuilt because its action changed.</span>

<span class="sd">    genstring()</span>
<span class="sd">        Returns a string representation of the Action *without*</span>
<span class="sd">        command substitution, but allows a CommandGeneratorAction to</span>
<span class="sd">        generate the right action based on the specified target,</span>
<span class="sd">        source and env.  This is used by the Signature subsystem</span>
<span class="sd">        (through the Executor) to obtain an (imprecise) representation</span>
<span class="sd">        of the Action operation for informative purposes.</span>


<span class="sd">Subclasses also supply the following methods for internal use within</span>
<span class="sd">this module:</span>

<span class="sd">    __str__()</span>
<span class="sd">        Returns a string approximation of the Action; no variable</span>
<span class="sd">        substitution is performed.</span>

<span class="sd">    execute()</span>
<span class="sd">        The internal method that really, truly, actually handles the</span>
<span class="sd">        execution of a command or Python function.  This is used so</span>
<span class="sd">        that the __call__() methods can take care of displaying any</span>
<span class="sd">        pre-substitution representations, and *then* execute an action</span>
<span class="sd">        without worrying about the specific Actions involved.</span>

<span class="sd">    get_presig()</span>
<span class="sd">        Fetches the &quot;contents&quot; of a subclass for signature calculation.</span>
<span class="sd">        The varlist is added to this to produce the Action&#39;s contents.</span>
<span class="sd">        TODO(?): Change this to always return bytes and not str?</span>

<span class="sd">    strfunction()</span>
<span class="sd">        Returns a substituted string representation of the Action.</span>
<span class="sd">        This is used by the _ActionAction.show() command to display the</span>
<span class="sd">        command/function that will be executed to generate the target(s).</span>

<span class="sd">There is a related independent ActionCaller class that looks like a</span>
<span class="sd">regular Action, and which serves as a wrapper for arbitrary functions</span>
<span class="sd">that we want to let the user specify the arguments to now, but actually</span>
<span class="sd">execute later (when an out-of-date check determines that it&#39;s needed to</span>
<span class="sd">be executed, for example).  Objects of this class are returned by an</span>
<span class="sd">ActionFactory class that provides a __call__() method as a convenient</span>
<span class="sd">way for wrapping up the functions.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">DEVNULL</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">SCons.Debug</span>
<span class="kn">from</span> <span class="nn">SCons.Debug</span> <span class="kn">import</span> <span class="n">logInstanceCreation</span>
<span class="kn">import</span> <span class="nn">SCons.Errors</span>
<span class="kn">import</span> <span class="nn">SCons.Util</span>
<span class="kn">import</span> <span class="nn">SCons.Subst</span>

<span class="c1"># we use these a lot, so try to optimize them</span>
<span class="kn">from</span> <span class="nn">SCons.Util</span> <span class="kn">import</span> <span class="n">is_String</span><span class="p">,</span> <span class="n">is_List</span>

<div class="viewcode-block" id="_null"><a class="viewcode-back" href="../../../SCons/#SCons.Action._null">[docs]</a><span class="k">class</span> <span class="nc">_null</span><span class="p">:</span>
    <span class="k">pass</span></div>

<span class="n">print_actions</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">execute_actions</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">print_actions_presub</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Use pickle protocol 1 when pickling functions for signature</span>
<span class="c1"># otherwise python3 and python2 will yield different pickles</span>
<span class="c1"># for the same object.</span>
<span class="c1"># This is due to default being 1 for python 2.7, and 3 for 3.x</span>
<span class="c1"># TODO: We can roll this forward to 2 (if it has value), but not</span>
<span class="c1"># before a deprecation cycle as the sconsigns will change</span>
<span class="n">ACTION_SIGNATURE_PICKLE_PROTOCOL</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="rfile"><a class="viewcode-back" href="../../../SCons/#SCons.Action.rfile">[docs]</a><span class="k">def</span> <span class="nf">rfile</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">rfile</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span></div>


<div class="viewcode-block" id="default_exitstatfunc"><a class="viewcode-back" href="../../../SCons/#SCons.Action.default_exitstatfunc">[docs]</a><span class="k">def</span> <span class="nf">default_exitstatfunc</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span></div>

<span class="n">strip_quotes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[</span><span class="se">\&#39;</span><span class="s1">&quot;](.*)[</span><span class="se">\&#39;</span><span class="s1">&quot;]$&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="_callable_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action._callable_contents">[docs]</a><span class="k">def</span> <span class="nf">_callable_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the signature contents of a callable Python object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test if obj is a method.</span>
        <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__func__</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Test if obj is a callable object.</span>
            <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="fm">__call__</span><span class="o">.</span><span class="vm">__func__</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Test if obj is a code object.</span>
                <span class="k">return</span> <span class="n">_code_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Test if obj is a function object.</span>
                <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="_object_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action._object_contents">[docs]</a><span class="k">def</span> <span class="nf">_object_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the signature contents of any Python object.</span>

<span class="sd">    We have to handle the case where object contains a code object</span>
<span class="sd">    since it can be pickled directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test if obj is a method.</span>
        <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__func__</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Test if obj is a callable object.</span>
            <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="fm">__call__</span><span class="o">.</span><span class="vm">__func__</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Test if obj is a code object.</span>
                <span class="k">return</span> <span class="n">_code_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Test if obj is a function object.</span>
                    <span class="k">return</span> <span class="n">_function_contents</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ae</span><span class="p">:</span>
                    <span class="c1"># Should be a pickle-able Python object.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_object_instance_content</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                        <span class="c1"># pickling an Action instance or object doesn&#39;t yield a stable</span>
                        <span class="c1"># content as instance property may be dumped in different orders</span>
                        <span class="c1"># return pickle.dumps(obj, ACTION_SIGNATURE_PICKLE_PROTOCOL)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">PicklingError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="c1"># This is weird, but it seems that nested classes</span>
                        <span class="c1"># are unpickable. The Python docs say it should</span>
                        <span class="c1"># always be a PicklingError, but some Python</span>
                        <span class="c1"># versions seem to return TypeError.  Just do</span>
                        <span class="c1"># the best we can.</span>
                        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="_code_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action._code_contents">[docs]</a><span class="k">def</span> <span class="nf">_code_contents</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">docstring</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the signature contents of a code object.</span>

<span class="sd">    By providing direct access to the code object of the</span>
<span class="sd">    function, Python makes this extremely easy.  Hooray!</span>

<span class="sd">    Unfortunately, older versions of Python include line</span>
<span class="sd">    number indications in the compiled byte code.  Boo!</span>
<span class="sd">    So we remove the line number byte codes to prevent</span>
<span class="sd">    recompilations from moving a Python function.</span>

<span class="sd">    See:</span>
<span class="sd">      - https://docs.python.org/2/library/inspect.html</span>
<span class="sd">      - http://python-reference.readthedocs.io/en/latest/docs/code/index.html</span>

<span class="sd">    For info on what each co\_ variable provides</span>

<span class="sd">    The signature is as follows (should be byte/chars):</span>
<span class="sd">    co_argcount, len(co_varnames), len(co_cellvars), len(co_freevars),</span>
<span class="sd">    ( comma separated signature for each object in co_consts ),</span>
<span class="sd">    ( comma separated signature for each object in co_names ),</span>
<span class="sd">    ( The bytecode with line number bytecodes removed from  co_code )</span>

<span class="sd">    co_argcount - Returns the number of positional arguments (including arguments with default values).</span>
<span class="sd">    co_varnames - Returns a tuple containing the names of the local variables (starting with the argument names).</span>
<span class="sd">    co_cellvars - Returns a tuple containing the names of local variables that are referenced by nested functions.</span>
<span class="sd">    co_freevars - Returns a tuple containing the names of free variables. (?)</span>
<span class="sd">    co_consts   - Returns a tuple containing the literals used by the bytecode.</span>
<span class="sd">    co_names    - Returns a tuple containing the names used by the bytecode.</span>
<span class="sd">    co_code     - Returns a string representing the sequence of bytecode instructions.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># contents = []</span>

    <span class="c1"># The code contents depends on the number of local variables</span>
    <span class="c1"># but not their actual names.</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">)),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_cellvars</span><span class="p">)),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">)),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># The code contents depends on any constants accessed by the</span>
    <span class="c1"># function. Note that we have to call _object_contents on each</span>
    <span class="c1"># constants because the code object of nested functions can</span>
    <span class="c1"># show-up among the constants.</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">_object_contents</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">code</span><span class="o">.</span><span class="n">co_consts</span> <span class="k">if</span> <span class="n">cc</span> <span class="o">!=</span> <span class="n">docstring</span><span class="p">]</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,(&#39;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="c1"># The code contents depends on the variable names used to</span>
    <span class="c1"># accessed global variable, as changing the variable name changes</span>
    <span class="c1"># the variable actually accessed and therefore changes the</span>
    <span class="c1"># function result.</span>
    <span class="n">z</span><span class="o">=</span> <span class="p">[</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">_object_contents</span><span class="p">(</span><span class="n">cc</span><span class="p">))</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">code</span><span class="o">.</span><span class="n">co_names</span><span class="p">]</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,(&#39;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="c1"># The code contents depends on its actual code!!!</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,(&#39;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_code</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">contents</span></div>


<div class="viewcode-block" id="_function_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action._function_contents">[docs]</a><span class="k">def</span> <span class="nf">_function_contents</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The signature is as follows (should be byte/chars):</span>
<span class="sd">    &lt; _code_contents (see above) from func.__code__ &gt;</span>
<span class="sd">    ,( comma separated _object_contents for function argument defaults)</span>
<span class="sd">    ,( comma separated _object_contents for any closure contents )</span>


<span class="sd">    See also: https://docs.python.org/3/reference/datamodel.html</span>
<span class="sd">      - func.__code__     - The code object representing the compiled function body.</span>
<span class="sd">      - func.__defaults__ - A tuple containing default argument values for those arguments that have defaults, or None if no arguments have a default value</span>
<span class="sd">      - func.__closure__  - None or a tuple of cells that contain bindings for the function&#39;s free variables.</span>

<span class="sd">    :Returns:</span>
<span class="sd">      Signature contents of a function. (in bytes)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_code_contents</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)]</span>

    <span class="c1"># The function contents depends on the value of defaults arguments</span>
    <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">:</span>

        <span class="n">function_defaults_contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_object_contents</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">]</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,(&#39;</span><span class="p">)</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">function_defaults_contents</span><span class="p">))</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

        <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,()&#39;</span><span class="p">)</span>

    <span class="c1"># The function contents depends on the closure captured cell values.</span>
    <span class="n">closure</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span> <span class="ow">or</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">closure_contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_object_contents</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">closure</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">closure_contents</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,(&#39;</span><span class="p">)</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">closure_contents</span><span class="p">))</span>
    <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="n">retval</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retval</span></div>


<div class="viewcode-block" id="_object_instance_content"><a class="viewcode-back" href="../../../SCons/#SCons.Action._object_instance_content">[docs]</a><span class="k">def</span> <span class="nf">_object_instance_content</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns consistant content for a action class or an instance thereof</span>

<span class="sd">    :Parameters:</span>
<span class="sd">      - `obj` Should be either and action class or an instance thereof</span>

<span class="sd">    :Returns:</span>
<span class="sd">      bytearray or bytes representing the obj suitable for generating a signature from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;N.&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">BaseStringTypes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">inst_class</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="n">inst_class_name</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">inst_class_module</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">inst_class_hierarchy</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getclasstree</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,])),</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="c1"># print(&quot;ICH:%s : %s&quot;%(inst_class_hierarchy, repr(obj)))</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;__&#39;</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">p</span><span class="p">)))</span> <span class="p">]</span>
    <span class="n">properties</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">properties_str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>
    <span class="n">properties_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">properties_str</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">p</span><span class="p">))]</span>
    <span class="n">methods</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">method_contents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="c1"># print(&quot;Method:%s&quot;%m)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">_function_contents</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
        <span class="c1"># print(&quot;[%s-&gt;]V:%s [%s]&quot;%(m,v,type(v)))</span>
        <span class="n">method_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">retval</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;{&#39;</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_class_name</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_class_module</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;}[[&#39;</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_class_hierarchy</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;]]{{&#39;</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">method_contents</span><span class="p">))</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;}}{{{&quot;</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">properties_bytes</span><span class="p">)</span>
    <span class="n">retval</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;}}}&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retval</span></div>

    <span class="c1"># print(&quot;class          :%s&quot;%inst_class)</span>
    <span class="c1"># print(&quot;class_name     :%s&quot;%inst_class_name)</span>
    <span class="c1"># print(&quot;class_module   :%s&quot;%inst_class_module)</span>
    <span class="c1"># print(&quot;Class hier     :\n%s&quot;%pp.pformat(inst_class_hierarchy))</span>
    <span class="c1"># print(&quot;Inst Properties:\n%s&quot;%pp.pformat(properties))</span>
    <span class="c1"># print(&quot;Inst Methods   :\n%s&quot;%pp.pformat(methods))</span>

<div class="viewcode-block" id="_actionAppend"><a class="viewcode-back" href="../../../SCons/#SCons.Action._actionAppend">[docs]</a><span class="k">def</span> <span class="nf">_actionAppend</span><span class="p">(</span><span class="n">act1</span><span class="p">,</span> <span class="n">act2</span><span class="p">):</span>
    <span class="c1"># This function knows how to slap two actions together.</span>
    <span class="c1"># Mainly, it handles ListActions by concatenating into</span>
    <span class="c1"># a single ListAction.</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">act1</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">act2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a2</span>
    <span class="k">if</span> <span class="n">a2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">ListAction</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">ListAction</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ListAction</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">list</span> <span class="o">+</span> <span class="n">a2</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ListAction</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">list</span> <span class="o">+</span> <span class="p">[</span> <span class="n">a2</span> <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">ListAction</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ListAction</span><span class="p">([</span> <span class="n">a1</span> <span class="p">]</span> <span class="o">+</span> <span class="n">a2</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ListAction</span><span class="p">([</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="p">])</span></div>


<div class="viewcode-block" id="_do_create_keywords"><a class="viewcode-back" href="../../../SCons/#SCons.Action._do_create_keywords">[docs]</a><span class="k">def</span> <span class="nf">_do_create_keywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This converts any arguments after the action argument into</span>
<span class="sd">    their equivalent keywords and adds them to the kw argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;varlist&#39;</span><span class="p">,</span> <span class="p">())</span>
    <span class="c1"># prevent varlist=&quot;FOO&quot; from being interpreted as [&#39;F&#39;, &#39;O&#39;, &#39;O&#39;]</span>
    <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">,)</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;varlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
        <span class="c1"># turn positional args into equivalent keywords</span>
        <span class="n">cmdstrfunc</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cmdstrfunc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">is_String</span><span class="p">(</span><span class="n">cmdstrfunc</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;cmdstr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmdstrfunc</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">cmdstrfunc</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;strfunction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmdstrfunc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span>
                <span class="s1">&#39;Invalid command display variable type. &#39;</span>
                <span class="s1">&#39;You must either pass a string or a callback which &#39;</span>
                <span class="s1">&#39;accepts (target, source, env) as parameters.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;varlist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">+</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;varlist&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strfunction&#39;</span><span class="p">,</span> <span class="n">_null</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_null</span> \
                      <span class="ow">and</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmdstr&#39;</span><span class="p">,</span> <span class="n">_null</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_null</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span>
            <span class="s1">&#39;Cannot have both strfunction and cmdstr args to Action()&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="_do_create_action"><a class="viewcode-back" href="../../../SCons/#SCons.Action._do_create_action">[docs]</a><span class="k">def</span> <span class="nf">_do_create_action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the actual &quot;implementation&quot; for the</span>
<span class="sd">    Action factory method, below.  This handles the</span>
<span class="sd">    fact that passing lists to Action() itself has</span>
<span class="sd">    different semantics than passing lists as elements</span>
<span class="sd">    of lists.</span>

<span class="sd">    The former will create a ListAction, the latter</span>
<span class="sd">    will create a CommandAction by converting the inner</span>
<span class="sd">    list elements to strings.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">ActionBase</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">act</span>

    <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
        <span class="n">var</span><span class="o">=</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">get_environment_var</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="p">:</span>
            <span class="c1"># This looks like a string that is purely an Environment</span>
            <span class="c1"># variable reference, like &quot;$FOO&quot; or &quot;${FOO}&quot;.  We do</span>
            <span class="c1"># something special here...we lazily evaluate the contents</span>
            <span class="c1"># of that Environment variable, so a user could put something</span>
            <span class="c1"># like a function or a CommandGenerator in that variable</span>
            <span class="c1"># instead of a string.</span>
            <span class="k">return</span> <span class="n">LazyAction</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandAction</span><span class="p">(</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1"># The list of string commands may include a LazyAction, so we</span>
        <span class="c1"># reprocess them via _do_create_list_action.</span>
        <span class="k">return</span> <span class="n">_do_create_list_action</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CommandAction</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;generator&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;generator&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">gen</span><span class="p">:</span>
            <span class="n">action_type</span> <span class="o">=</span> <span class="n">CommandGeneratorAction</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action_type</span> <span class="o">=</span> <span class="n">FunctionAction</span>
        <span class="k">return</span> <span class="n">action_type</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

    <span class="c1"># Catch a common error case with a nice message:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t know how to create an Action from a number (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">act</span><span class="p">)</span>
    <span class="c1"># Else fail silently (???)</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="_do_create_list_action"><a class="viewcode-back" href="../../../SCons/#SCons.Action._do_create_list_action">[docs]</a><span class="k">def</span> <span class="nf">_do_create_list_action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A factory for list actions.  Convert the input list into Actions</span>
<span class="sd">    and then wrap them in a ListAction.&quot;&quot;&quot;</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">act</span><span class="p">:</span>
        <span class="n">aa</span> <span class="o">=</span> <span class="n">_do_create_action</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">aa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">acts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">acts</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ListAction</span><span class="p">([])</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">acts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ListAction</span><span class="p">(</span><span class="n">acts</span><span class="p">)</span></div>


<div class="viewcode-block" id="Action"><a class="viewcode-back" href="../../../SCons/#SCons.Action.Action">[docs]</a><span class="k">def</span> <span class="nf">Action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A factory for action objects.&quot;&quot;&quot;</span>
    <span class="c1"># Really simple: the _do_create_* routines do the heavy lifting.</span>
    <span class="n">_do_create_keywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">act</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_do_create_list_action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_do_create_action</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="ActionBase"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase">[docs]</a><span class="k">class</span> <span class="nc">ActionBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for all types of action objects that can be held by</span>
<span class="sd">    other objects (Builders, Executors, etc.)  This provides the</span>
<span class="sd">    common methods for manipulating and combining those actions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span>

<div class="viewcode-block" id="ActionBase.no_batch_key"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.no_batch_key">[docs]</a>    <span class="k">def</span> <span class="nf">no_batch_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="n">batch_key</span> <span class="o">=</span> <span class="n">no_batch_key</span>

<div class="viewcode-block" id="ActionBase.genstring"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.genstring">[docs]</a>    <span class="k">def</span> <span class="nf">genstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ActionBase.get_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.get_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_presig</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Make a copy and put in bytearray, without this the contents returned by get_presig</span>
            <span class="c1"># can be changed by the logic below, appending with each call and causing very</span>
            <span class="c1"># hard to track down issues...</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># At this point everything should be a bytearray</span>

        <span class="c1"># This should never happen, as the Action() factory should wrap</span>
        <span class="c1"># the varlist, but just in case an action is created directly,</span>
        <span class="c1"># we duplicate this check here.</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_varlist</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">vl</span><span class="p">):</span> <span class="n">vl</span> <span class="o">=</span> <span class="p">(</span><span class="n">vl</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">:</span>
            <span class="c1"># do the subst this way to ignore $(...$) parts:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">subst_target_source</span><span class="p">(</span><span class="s1">&#39;${&#39;</span><span class="o">+</span><span class="n">v</span><span class="o">+</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;WE SHOULD NEVER GET HERE result should be bytearray not:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                <span class="c1"># result.append(SCons.Util.to_bytes(env.subst_target_source(&#39;${&#39;+v+&#39;}&#39;, SCons.Subst.SUBST_SIG, target, source)))</span>


        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;WE SHOULD NEVER GET HERE - #2 result should be bytearray not:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">))</span></div>
            <span class="c1"># return b&#39;&#39;.join(result)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_actionAppend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_actionAppend</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="ActionBase.presub_lines"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.presub_lines">[docs]</a>    <span class="k">def</span> <span class="nf">presub_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="c1"># CommandGeneratorAction needs a real environment</span>
        <span class="c1"># in order to return the proper string here, since</span>
        <span class="c1"># it may call LazyAction, which looks up a key</span>
        <span class="c1"># in that env.  So we temporarily remember the env here,</span>
        <span class="c1"># and CommandGeneratorAction will use this env</span>
        <span class="c1"># when it calls its _generate method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presub_env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presub_env</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># don&#39;t need this any more</span>
        <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="ActionBase.get_varlist"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.get_varlist">[docs]</a>    <span class="k">def</span> <span class="nf">get_varlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">varlist</span></div>

<div class="viewcode-block" id="ActionBase.get_targets"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionBase.get_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the type of targets ($TARGETS, $CHANGED_TARGETS) used</span>
<span class="sd">        by this action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span></div></div>


<div class="viewcode-block" id="_ActionAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action._ActionAction">[docs]</a><span class="k">class</span> <span class="nc">_ActionAction</span><span class="p">(</span><span class="n">ActionBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for actions that create output objects.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmdstr</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">strfunction</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">varlist</span><span class="o">=</span><span class="p">(),</span>
                       <span class="n">presub</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">chdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exitstatfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">batch_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="s1">&#39;$TARGETS&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="o">=</span> <span class="n">cmdstr</span>
        <span class="k">if</span> <span class="n">strfunction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_null</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strfunction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span> <span class="o">=</span> <span class="n">strfunction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varlist</span> <span class="o">=</span> <span class="n">varlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presub</span> <span class="o">=</span> <span class="n">presub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chdir</span> <span class="o">=</span> <span class="n">chdir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exitstatfunc</span><span class="p">:</span>
            <span class="n">exitstatfunc</span> <span class="o">=</span> <span class="n">default_exitstatfunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exitstatfunc</span> <span class="o">=</span> <span class="n">exitstatfunc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="k">if</span> <span class="n">batch_key</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">batch_key</span><span class="p">):</span>
                <span class="c1"># They have set batch_key, but not to their own</span>
                <span class="c1"># callable.  The default behavior here will batch</span>
                <span class="c1"># *all* targets+sources using this action, separated</span>
                <span class="c1"># for each construction environment.</span>
                <span class="k">def</span> <span class="nf">default_batch_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
                <span class="n">batch_key</span> <span class="o">=</span> <span class="n">default_batch_key</span>
            <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">AddMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_key</span><span class="p">,</span> <span class="s1">&#39;batch_key&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="_ActionAction.print_cmd_line"><a class="viewcode-back" href="../../../SCons/#SCons.Action._ActionAction.print_cmd_line">[docs]</a>    <span class="k">def</span> <span class="nf">print_cmd_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In python 3, and in some of our tests, sys.stdout is</span>
<span class="sd">        a String io object, and it takes unicode strings only</span>
<span class="sd">        This code assumes s is a regular string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span>
                               <span class="n">exitstatfunc</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                               <span class="n">presub</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                               <span class="n">show</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                               <span class="n">execute</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                               <span class="n">chdir</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                               <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">presub</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">presub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presub</span>
            <span class="k">if</span> <span class="n">presub</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
                <span class="n">presub</span> <span class="o">=</span> <span class="n">print_actions_presub</span>
        <span class="k">if</span> <span class="n">exitstatfunc</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">exitstatfunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exitstatfunc</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="n">print_actions</span>
        <span class="k">if</span> <span class="n">execute</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">execute</span> <span class="o">=</span> <span class="n">execute_actions</span>
        <span class="k">if</span> <span class="n">chdir</span> <span class="ow">is</span> <span class="n">_null</span><span class="p">:</span>
            <span class="n">chdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chdir</span>
        <span class="n">save_cwd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">chdir</span><span class="p">:</span>
            <span class="n">save_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">chdir</span><span class="o">.</span><span class="n">get_abspath</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_String</span><span class="p">(</span><span class="n">chdir</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                        <span class="n">chdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">batches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">chdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">presub</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
            <span class="n">l</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">presub_lines</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;Building </span><span class="si">%s</span><span class="s2"> with action:</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chdir</span><span class="p">:</span>
                    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;os.chdir(</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">chdir</span><span class="p">))</span> <span class="o">+</span> <span class="n">cmd</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">get</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">print_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_cmd_line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">print_func</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;PRINT_CMD_LINE_FUNC&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">print_func</span><span class="p">:</span>
                        <span class="n">print_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_cmd_line</span>
                <span class="n">print_func</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">execute</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chdir</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">chdir</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">exitstatfunc</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">stat</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">s</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stat</span> <span class="o">=</span> <span class="n">s</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stat</span> <span class="o">=</span> <span class="n">exitstatfunc</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">save_cwd</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">save_cwd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="ow">and</span> <span class="n">save_cwd</span><span class="p">:</span>
            <span class="n">print_func</span><span class="p">(</span><span class="s1">&#39;os.chdir(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">save_cwd</span><span class="p">),</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stat</span></div>


<div class="viewcode-block" id="_string_from_cmd_list"><a class="viewcode-back" href="../../../SCons/#SCons.Action._string_from_cmd_list">[docs]</a><span class="k">def</span> <span class="nf">_string_from_cmd_list</span><span class="p">(</span><span class="n">cmd_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a list of command line arguments and returns a pretty</span>
<span class="sd">    representation for printing.&quot;&quot;&quot;</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cmd_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">arg</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span></div>

<span class="n">default_ENV</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="get_default_ENV"><a class="viewcode-back" href="../../../SCons/#SCons.Action.get_default_ENV">[docs]</a><span class="k">def</span> <span class="nf">get_default_ENV</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fiddlin&#39; little function that has an &#39;import SCons.Environment&#39; which</span>
<span class="sd">    can&#39;t be moved to the top level without creating an import loop.  Since</span>
<span class="sd">    this import creates a local variable named &#39;SCons&#39;, it blocks access to</span>
<span class="sd">    the global variable, so we move it here to prevent complaints about local</span>
<span class="sd">    variables being used uninitialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">default_ENV</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;ENV&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">default_ENV</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">SCons.Environment</span>
            <span class="c1"># This is a hideously expensive way to get a default shell</span>
            <span class="c1"># environment.  What it really should do is run the platform</span>
            <span class="c1"># setup to get the default ENV.  Fortunately, it&#39;s incredibly</span>
            <span class="c1"># rare for an Environment not to have a shell environment, so</span>
            <span class="c1"># we&#39;re not going to worry about it overmuch.</span>
            <span class="n">default_ENV</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">()[</span><span class="s1">&#39;ENV&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">default_ENV</span></div>


<div class="viewcode-block" id="_subproc"><a class="viewcode-back" href="../../../SCons/#SCons.Action._subproc">[docs]</a><span class="k">def</span> <span class="nf">_subproc</span><span class="p">(</span><span class="n">scons_env</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for subprocess which pulls from construction env.</span>

<span class="sd">    Use for calls to subprocess which need to interpolate values from</span>
<span class="sd">    an SCons construction environment into the environment passed to</span>
<span class="sd">    subprocess.  Adds an an error-handling argument.  Adds ability</span>
<span class="sd">    to specify std{in,out,err} with &quot;&#39;devnull&#39;&quot; tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: just uses subprocess.DEVNULL now, we can drop the &quot;devnull&quot;</span>
    <span class="c1"># string now - it is a holdover from Py2, which didn&#39;t have DEVNULL.</span>
    <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">io</span><span class="p">)</span> <span class="ow">and</span> <span class="n">io</span> <span class="o">==</span> <span class="s1">&#39;devnull&#39;</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="n">stream</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEVNULL</span>

    <span class="c1"># Figure out what shell environment to use</span>
    <span class="n">ENV</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ENV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ENV</span> <span class="o">=</span> <span class="n">get_default_ENV</span><span class="p">(</span><span class="n">scons_env</span><span class="p">)</span>

    <span class="c1"># Ensure that the ENV values are all strings:</span>
    <span class="n">new_env</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ENV</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># If the value is a list, then we assume it is a path list,</span>
            <span class="c1"># because that&#39;s a pretty common list-like value to stick</span>
            <span class="c1"># in an environment variable:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten_sequence</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">new_env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># It&#39;s either a string or something else.  If it&#39;s a string,</span>
            <span class="c1"># we still want to call str() because it might be a *Unicode*</span>
            <span class="c1"># string, which makes subprocess.Popen() gag.  If it isn&#39;t a</span>
            <span class="c1"># string or a list, then we just coerce it to a string, which</span>
            <span class="c1"># is the proper way to handle Dir and File instances and will</span>
            <span class="c1"># produce something reasonable for just about everything else:</span>
            <span class="n">new_env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_env</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pobj</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span> <span class="k">raise</span>
        <span class="c1"># return a dummy Popen instance that only returns error</span>
        <span class="k">class</span> <span class="nc">dummyPopen</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">def</span> <span class="nf">communicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">errno</span>
            <span class="n">stdin</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">class</span> <span class="nc">f</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">iter</span><span class="p">(())</span>
            <span class="n">stdout</span> <span class="o">=</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
        <span class="n">pobj</span> <span class="o">=</span> <span class="n">dummyPopen</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># clean up open file handles stored in parent&#39;s kw</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pobj</span></div>


<div class="viewcode-block" id="CommandAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction">[docs]</a><span class="k">class</span> <span class="nc">CommandAction</span><span class="p">(</span><span class="n">_ActionAction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for command-execution actions.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># Cmd can actually be a list or a single item; if it&#39;s a</span>
        <span class="c1"># single item it should be the command string to execute; if a</span>
        <span class="c1"># list then it should be the words of the command string to</span>
        <span class="c1"># execute.  Only a single command should be executed by this</span>
        <span class="c1"># object; lists of commands should be handled by embedding</span>
        <span class="c1"># these objects in a ListAction object (which the Action()</span>
        <span class="c1"># factory above does).  cmd will be passed to</span>
        <span class="c1"># Environment.subst_list() for substituting environment</span>
        <span class="c1"># variables.</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Action.CommandAction&#39;</span><span class="p">)</span>

        <span class="n">_ActionAction</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmd</span> <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">c</span><span class="p">)]:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;CommandAction should be given only &quot;</span>
                                <span class="s2">&quot;a single command&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span> <span class="o">=</span> <span class="n">cmd</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">)</span>

<div class="viewcode-block" id="CommandAction.process"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">silent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;@&#39;</span><span class="p">:</span> <span class="n">silent</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="n">ignore</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">silent</span></div>

<div class="viewcode-block" id="CommandAction.strfunction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction.strfunction">[docs]</a>    <span class="k">def</span> <span class="nf">strfunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_null</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">SCons.Subst</span> <span class="kn">import</span> <span class="n">SUBST_RAW</span>
            <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span><span class="p">,</span> <span class="n">SUBST_RAW</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span><span class="p">,</span> <span class="n">SUBST_RAW</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">c</span>
        <span class="n">cmd_list</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_string_from_cmd_list</span><span class="p">(</span><span class="n">cmd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="CommandAction.execute"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute a command action.</span>

<span class="sd">        This will handle lists of commands as well as individual commands,</span>
<span class="sd">        because construction variable substitution may turn a single</span>
<span class="sd">        &quot;command&quot; into a list.  This means that this class can actually</span>
<span class="sd">        handle lists of commands, even though that&#39;s not how we use it</span>
<span class="sd">        externally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">escape_list</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Subst</span><span class="o">.</span><span class="n">escape_list</span>
        <span class="n">flatten_sequence</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten_sequence</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;SHELL&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s1">&#39;Missing SHELL construction variable.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">spawn</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;SPAWN&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s1">&#39;Missing SPAWN construction variable.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">spawn</span><span class="p">):</span>
                <span class="n">spawn</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">spawn</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">conv</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">escape</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ESCAPE&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">ENV</span> <span class="o">=</span> <span class="n">get_default_ENV</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

        <span class="c1"># Ensure that the ENV values are all strings:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ENV</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_String</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="c1"># If the value is a list, then we assume it is a</span>
                    <span class="c1"># path list, because that&#39;s a pretty common list-like</span>
                    <span class="c1"># value to stick in an environment variable:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">flatten_sequence</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">ENV</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If it isn&#39;t a string or a list, then we just coerce</span>
                    <span class="c1"># it to a string, which is the proper way to handle</span>
                    <span class="c1"># Dir and File instances and will produce something</span>
                    <span class="c1"># reasonable for just about everything else:</span>
                    <span class="n">ENV</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
        <span class="n">cmd_list</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">rfile</span><span class="p">,</span> <span class="n">source</span><span class="p">)),</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>

        <span class="c1"># Use len() to filter out any &quot;command&quot; that&#39;s zero-length.</span>
        <span class="k">for</span> <span class="n">cmd_line</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">cmd_list</span><span class="p">):</span>
            <span class="c1"># Escape the command line for the interpreter we are using.</span>
            <span class="n">cmd_line</span> <span class="o">=</span> <span class="n">escape_list</span><span class="p">(</span><span class="n">cmd_line</span><span class="p">,</span> <span class="n">escape</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="n">escape</span><span class="p">,</span> <span class="n">cmd_line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmd_line</span><span class="p">,</span> <span class="n">ENV</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span>
                <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">BuildError</span><span class="p">(</span><span class="n">errstr</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                               <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                                               <span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                               <span class="n">command</span><span class="o">=</span><span class="n">cmd_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="CommandAction.get_presig"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction.get_presig">[docs]</a>    <span class="k">def</span> <span class="nf">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the signature contents of this action&#39;s command line.</span>

<span class="sd">        This strips $(-$) and everything in between the string,</span>
<span class="sd">        since those parts don&#39;t affect signatures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">SCons.Subst</span> <span class="kn">import</span> <span class="n">SUBST_SIG</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span>
        <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cmd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_target_source</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_target_source</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandAction.get_implicit_deps"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction.get_implicit_deps">[docs]</a>    <span class="k">def</span> <span class="nf">get_implicit_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the implicit dependencies of this action&#39;s command line.&quot;&quot;&quot;</span>
        <span class="n">icd</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IMPLICIT_COMMAND_DEPENDENCIES&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">icd</span><span class="p">)</span> <span class="ow">and</span> <span class="n">icd</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span>
            <span class="n">icd</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">icd</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">icd</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">icd</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">icd_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">icd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">icd_int</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">icd_int</span> <span class="ow">and</span> <span class="n">icd_int</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">icd</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="c1"># An integer value greater than 1 specifies the number of entries</span>
            <span class="c1"># to scan. &quot;all&quot; means to scan all.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_implicit_deps_heavyweight</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">icd_int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Everything else (usually 1 or True) means that we want</span>
            <span class="c1"># lightweight dependency scanning.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_implicit_deps_lightweight</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandAction._get_implicit_deps_lightweight"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction._get_implicit_deps_lightweight">[docs]</a>    <span class="k">def</span> <span class="nf">_get_implicit_deps_lightweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lightweight dependency scanning involves only scanning the first entry</span>
<span class="sd">        in an action string, even if it contains &amp;&amp;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">SCons.Subst</span> <span class="kn">import</span> <span class="n">SUBST_SIG</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">cmd_list</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">,</span> <span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd_list</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">,</span> <span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cmd_line</span> <span class="ow">in</span> <span class="n">cmd_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd_line</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">strip_quotes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">WhereIs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="CommandAction._get_implicit_deps_heavyweight"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandAction._get_implicit_deps_heavyweight">[docs]</a>    <span class="k">def</span> <span class="nf">_get_implicit_deps_heavyweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span>
                                       <span class="n">icd_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heavyweight dependency scanning involves scanning more than just the</span>
<span class="sd">        first entry in an action string. The exact behavior depends on the</span>
<span class="sd">        value of icd_int. Only files are taken as implicit dependencies;</span>
<span class="sd">        directories are ignored.</span>

<span class="sd">        If icd_int is an integer value, it specifies the number of entries to</span>
<span class="sd">        scan for implicit dependencies. Action strings are also scanned after</span>
<span class="sd">        a &amp;&amp;. So for example, if icd_int=2 and the action string is</span>
<span class="sd">        &quot;cd &lt;some_dir&gt; &amp;&amp; $PYTHON $SCRIPT_PATH &lt;another_path&gt;&quot;, the implicit</span>
<span class="sd">        dependencies would be the path to the python binary and the path to the</span>
<span class="sd">        script.</span>

<span class="sd">        If icd_int is None, all entries are scanned for implicit dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Avoid circular and duplicate dependencies by not providing source,</span>
        <span class="c1"># target, or executor to subst_list. This causes references to</span>
        <span class="c1"># $SOURCES, $TARGETS, and all related variables to disappear.</span>
        <span class="kn">from</span> <span class="nn">SCons.Subst</span> <span class="kn">import</span> <span class="n">SUBST_SIG</span>
        <span class="n">cmd_list</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_list</span><span class="p">,</span> <span class="n">SUBST_SIG</span><span class="p">,</span> <span class="n">conv</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">cmd_line</span> <span class="ow">in</span> <span class="n">cmd_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd_line</span><span class="p">:</span>
                <span class="n">entry_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">cmd_line</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">icd_int</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entry_count</span> <span class="o">&lt;</span> <span class="n">icd_int</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span>
                                             <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))):</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="n">strip_quotes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
                            <span class="c1"># Resolve the first entry in the command string using</span>
                            <span class="c1"># PATH, which env.WhereIs() looks in.</span>
                            <span class="c1"># For now, only match files, not directories.</span>
                            <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">entry_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">p</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">WhereIs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

                        <span class="n">entry_count</span> <span class="o">=</span> <span class="n">entry_count</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">entry_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;&amp;&amp;&#39;</span> <span class="k">else</span> <span class="n">entry_count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Despite not providing source and target to env.subst() above, we</span>
        <span class="c1"># can still end up with sources in this list. For example, files in</span>
        <span class="c1"># LIBS will still resolve in env.subst(). This won&#39;t result in</span>
        <span class="c1"># circular dependencies, but it causes problems with cache signatures</span>
        <span class="c1"># changing between full and incremental builds.</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="CommandGeneratorAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction">[docs]</a><span class="k">class</span> <span class="nc">CommandGeneratorAction</span><span class="p">(</span><span class="n">ActionBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for command-generator actions.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Action.CommandGeneratorAction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_kw</span> <span class="o">=</span> <span class="n">kw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varlist</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;varlist&#39;</span><span class="p">,</span> <span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span> <span class="s1">&#39;$TARGETS&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CommandGeneratorAction._generate"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction._generate">[docs]</a>    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">for_signature</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># ensure that target is a list, to make it easier to write</span>
        <span class="c1"># generator functions:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_List</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                             <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                             <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                             <span class="n">for_signature</span><span class="o">=</span><span class="n">for_signature</span><span class="p">)</span>
        <span class="n">gen_cmd</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">gen_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gen_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Object returned from command generator: </span><span class="si">%s</span><span class="s2"> cannot be used to create an Action.&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">gen_cmd</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presub_env</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">DefaultEnvironment</span><span class="p">()</span>
        <span class="n">act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>

<div class="viewcode-block" id="CommandGeneratorAction.batch_key"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.batch_key">[docs]</a>    <span class="k">def</span> <span class="nf">batch_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">batch_key</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandGeneratorAction.genstring"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.genstring">[docs]</a>    <span class="k">def</span> <span class="nf">genstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span><span class="o">.</span><span class="n">genstring</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">exitstatfunc</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">presub</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                 <span class="n">show</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">execute</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">chdir</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">act</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;While building `</span><span class="si">%s</span><span class="s2">&#39;: &quot;</span>
                <span class="s2">&quot;Cannot deduce file extension from source files: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">))),</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">source</span><span class="p">))))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">act</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">exitstatfunc</span><span class="p">,</span> <span class="n">presub</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">execute</span><span class="p">,</span> <span class="n">chdir</span><span class="p">,</span> <span class="n">executor</span>
        <span class="p">)</span>

<div class="viewcode-block" id="CommandGeneratorAction.get_presig"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.get_presig">[docs]</a>    <span class="k">def</span> <span class="nf">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the signature contents of this action&#39;s command line.</span>

<span class="sd">        This strips $(-$) and everything in between the string,</span>
<span class="sd">        since those parts don&#39;t affect signatures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span><span class="o">.</span><span class="n">get_presig</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandGeneratorAction.get_implicit_deps"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.get_implicit_deps">[docs]</a>    <span class="k">def</span> <span class="nf">get_implicit_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span><span class="o">.</span><span class="n">get_implicit_deps</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandGeneratorAction.get_varlist"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.get_varlist">[docs]</a>    <span class="k">def</span> <span class="nf">get_varlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span><span class="o">.</span><span class="n">get_varlist</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommandGeneratorAction.get_targets"><a class="viewcode-back" href="../../../SCons/#SCons.Action.CommandGeneratorAction.get_targets">[docs]</a>    <span class="k">def</span> <span class="nf">get_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span><span class="o">.</span><span class="n">get_targets</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LazyAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction">[docs]</a><span class="k">class</span> <span class="nc">LazyAction</span><span class="p">(</span><span class="n">CommandGeneratorAction</span><span class="p">,</span> <span class="n">CommandAction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A LazyAction is a kind of hybrid generator and command action for</span>
<span class="sd">    strings of the form &quot;$VAR&quot;.  These strings normally expand to other</span>
<span class="sd">    strings (think &quot;$CCCOM&quot; to &quot;$CC -c -o $TARGET $SOURCE&quot;), but we also</span>
<span class="sd">    want to be able to replace them with functions in the construction</span>
<span class="sd">    environment.  Consequently, we want lazy evaluation and creation of</span>
<span class="sd">    an Action in the case of the function, but that&#39;s overkill in the more</span>
<span class="sd">    normal case of expansion to other strings.</span>

<span class="sd">    So we do this with a subclass that&#39;s both a generator *and*</span>
<span class="sd">    a command action.  The overridden methods all do a quick check</span>
<span class="sd">    of the construction variable, and if it&#39;s a string we just call</span>
<span class="sd">    the corresponding CommandAction method to do the heavy lifting.</span>
<span class="sd">    If not, then we call the same-named CommandGeneratorAction method.</span>
<span class="sd">    The CommandGeneratorAction methods work by using the overridden</span>
<span class="sd">    _generate() method, that is, our own way of handling &quot;generation&quot; of</span>
<span class="sd">    an action based on what&#39;s in the construction variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Action.LazyAction&#39;</span><span class="p">)</span>
        <span class="n">CommandAction</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;${&#39;</span><span class="o">+</span><span class="n">var</span><span class="o">+</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">to_String</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_kw</span> <span class="o">=</span> <span class="n">kw</span>

<div class="viewcode-block" id="LazyAction.get_parent_class"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction.get_parent_class">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_String</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CommandAction</span>
        <span class="k">return</span> <span class="n">CommandGeneratorAction</span></div>

<div class="viewcode-block" id="LazyAction._generate_cache"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction._generate_cache">[docs]</a>    <span class="k">def</span> <span class="nf">_generate_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">env</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">gen_cmd</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">gen_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gen_cmd</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> cannot be used to create an Action.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">gen_cmd</span></div>

<div class="viewcode-block" id="LazyAction._generate"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction._generate">[docs]</a>    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">for_signature</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cache</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent_class</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="LazyAction.get_presig"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction.get_presig">[docs]</a>    <span class="k">def</span> <span class="nf">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent_class</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="LazyAction.get_varlist"><a class="viewcode-back" href="../../../SCons/#SCons.Action.LazyAction.get_varlist">[docs]</a>    <span class="k">def</span> <span class="nf">get_varlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent_class</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">get_varlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FunctionAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction">[docs]</a><span class="k">class</span> <span class="nc">FunctionAction</span><span class="p">(</span><span class="n">_ActionAction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Python function actions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execfunction</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Action.FunctionAction&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span> <span class="o">=</span> <span class="n">execfunction</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">funccontents</span> <span class="o">=</span> <span class="n">_callable_contents</span><span class="p">(</span><span class="n">execfunction</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># See if execfunction will do the heavy lifting for us.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gc</span> <span class="o">=</span> <span class="n">execfunction</span><span class="o">.</span><span class="n">get_contents</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># This is weird, just do the best we can.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">funccontents</span> <span class="o">=</span> <span class="n">_object_contents</span><span class="p">(</span><span class="n">execfunction</span><span class="p">)</span>

        <span class="n">_ActionAction</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="FunctionAction.function_name"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction.function_name">[docs]</a>    <span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;unknown_python_function&quot;</span></div>

<div class="viewcode-block" id="FunctionAction.strfunction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction.strfunction">[docs]</a>    <span class="k">def</span> <span class="nf">strfunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_null</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">SCons.Subst</span> <span class="kn">import</span> <span class="n">SUBST_RAW</span>
            <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span><span class="p">,</span> <span class="n">SUBST_RAW</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span><span class="p">,</span> <span class="n">SUBST_RAW</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">c</span>

        <span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">quote</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">str_for_display</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">str_for_display</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">str_for_display</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">s</span>
            <span class="k">return</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">strfunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span><span class="o">.</span><span class="n">strfunction</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">strfunc</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">strfunc</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">()</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">sstr</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tstr</span><span class="p">,</span> <span class="n">sstr</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ActionCaller&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(target, source, env)&quot;</span> <span class="o">%</span> <span class="n">name</span>

<div class="viewcode-block" id="FunctionAction.execute"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">exc_info</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
            <span class="n">rsources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">rfile</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execfunction</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rsources</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">SystemExit</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Errors</span><span class="o">.</span><span class="n">convert_to_BuildError</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">node</span><span class="o">=</span><span class="n">target</span>
                <span class="n">result</span><span class="o">.</span><span class="n">action</span><span class="o">=</span><span class="bp">self</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strfunction</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>

                <span class="c1"># FIXME: This maintains backward compatibility with respect to</span>
                <span class="c1"># which type of exceptions were returned by raising an</span>
                <span class="c1"># exception and which ones were returned by value. It would</span>
                <span class="c1"># probably be best to always return them by value here, but</span>
                <span class="c1"># some codes do not check the return value of Actions and I do</span>
                <span class="c1"># not have the time to modify them at this point.</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="ne">EnvironmentError</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">result</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Break the cycle between the traceback object and this</span>
            <span class="c1"># function stack frame. See the sys.exc_info() doc info for</span>
            <span class="c1"># more information about this issue.</span>
            <span class="k">del</span> <span class="n">exc_info</span></div>

<div class="viewcode-block" id="FunctionAction.get_presig"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction.get_presig">[docs]</a>    <span class="k">def</span> <span class="nf">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the signature contents of this callable action.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">funccontents</span></div>

<div class="viewcode-block" id="FunctionAction.get_implicit_deps"><a class="viewcode-back" href="../../../SCons/#SCons.Action.FunctionAction.get_implicit_deps">[docs]</a>    <span class="k">def</span> <span class="nf">get_implicit_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div></div>

<div class="viewcode-block" id="ListAction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction">[docs]</a><span class="k">class</span> <span class="nc">ListAction</span><span class="p">(</span><span class="n">ActionBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for lists of other actions.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actionlist</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Debug</span><span class="o">.</span><span class="n">track_instances</span><span class="p">:</span> <span class="n">logInstanceCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Action.ListAction&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">list_of_actions</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ActionBase</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">list_of_actions</span><span class="p">,</span> <span class="n">actionlist</span><span class="p">))</span>
        <span class="c1"># our children will have had any varlist</span>
        <span class="c1"># applied; we don&#39;t need to do it again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varlist</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="s1">&#39;$TARGETS&#39;</span>

<div class="viewcode-block" id="ListAction.genstring"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction.genstring">[docs]</a>    <span class="k">def</span> <span class="nf">genstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">genstring</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">))</span>

<div class="viewcode-block" id="ListAction.presub_lines"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction.presub_lines">[docs]</a>    <span class="k">def</span> <span class="nf">presub_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Util</span><span class="o">.</span><span class="n">flatten_sequence</span><span class="p">(</span>
            <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">presub_lines</span><span class="p">(</span><span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListAction.get_presig"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction.get_presig">[docs]</a>    <span class="k">def</span> <span class="nf">get_presig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the signature contents of this action list.</span>

<span class="sd">        Simple concatenation of the signatures of the elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get_contents</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">exitstatfunc</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">presub</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span>
                 <span class="n">show</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">execute</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">chdir</span><span class="o">=</span><span class="n">_null</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_targets</span><span class="p">()</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_all_sources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="n">act</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">exitstatfunc</span><span class="p">,</span> <span class="n">presub</span><span class="p">,</span>
                       <span class="n">show</span><span class="p">,</span> <span class="n">execute</span><span class="p">,</span> <span class="n">chdir</span><span class="p">,</span> <span class="n">executor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stat</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stat</span>
        <span class="k">return</span> <span class="mi">0</span>

<div class="viewcode-block" id="ListAction.get_implicit_deps"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction.get_implicit_deps">[docs]</a>    <span class="k">def</span> <span class="nf">get_implicit_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">get_implicit_deps</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ListAction.get_varlist"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ListAction.get_varlist">[docs]</a>    <span class="k">def</span> <span class="nf">get_varlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">get_varlist</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="ActionCaller"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller">[docs]</a><span class="k">class</span> <span class="nc">ActionCaller</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class for delaying calling an Action function with specific</span>
<span class="sd">    (positional and keyword) arguments until the Action is actually</span>
<span class="sd">    executed.</span>

<span class="sd">    This class looks to the rest of the world like a normal Action object,</span>
<span class="sd">    but what it&#39;s really doing is hanging on to the arguments until we</span>
<span class="sd">    have a target, source and env to use for the expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw</span> <span class="o">=</span> <span class="n">kw</span>

<div class="viewcode-block" id="ActionCaller.get_contents"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller.get_contents">[docs]</a>    <span class="k">def</span> <span class="nf">get_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">actfunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">actfunc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># &quot;self.actfunc&quot; is a function.</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">actfunc</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_code</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># &quot;self.actfunc&quot; is a callable object.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">actfunc</span><span class="o">.</span><span class="fm">__call__</span><span class="o">.</span><span class="vm">__func__</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_code</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># No __call__() method, so it might be a builtin</span>
                <span class="c1"># or something like that.  Do the best we can.</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">actfunc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">contents</span></div>

<div class="viewcode-block" id="ActionCaller.subst"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller.subst">[docs]</a>    <span class="k">def</span> <span class="nf">subst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="c1"># If s is a list, recursively apply subst()</span>
        <span class="c1"># to every element in the list</span>
        <span class="k">if</span> <span class="n">is_List</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Special-case hack:  Let a custom function wrapped in an</span>
        <span class="c1"># ActionCaller get at the environment through which the action</span>
        <span class="c1"># was called by using this hard-coded value as a special return.</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;$__env__&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">env</span>
        <span class="k">elif</span> <span class="n">is_String</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="ActionCaller.subst_args"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller.subst_args">[docs]</a>    <span class="k">def</span> <span class="nf">subst_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span></div>

<div class="viewcode-block" id="ActionCaller.subst_kw"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller.subst_kw">[docs]</a>    <span class="k">def</span> <span class="nf">subst_kw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kw</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_args</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">actfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="ActionCaller.strfunction"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionCaller.strfunction">[docs]</a>    <span class="k">def</span> <span class="nf">strfunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_args</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subst_kw</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">strfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">strfunc</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="ActionFactory"><a class="viewcode-back" href="../../../SCons/#SCons.Action.ActionFactory">[docs]</a><span class="k">class</span> <span class="nc">ActionFactory</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A factory class that will wrap up an arbitrary function</span>
<span class="sd">    as an SCons-executable Action object.</span>

<span class="sd">    The real heavy lifting here is done by the ActionCaller class.</span>
<span class="sd">    We just collect the (positional and keyword) arguments that we&#39;re</span>
<span class="sd">    called with and give them to the ActionCaller object we create,</span>
<span class="sd">    so it can hang onto them until it needs them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actfunc</span><span class="p">,</span> <span class="n">strfunc</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actfunc</span> <span class="o">=</span> <span class="n">actfunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strfunc</span> <span class="o">=</span> <span class="n">strfunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert</span> <span class="o">=</span> <span class="n">convert</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">ac</span> <span class="o">=</span> <span class="n">ActionCaller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">ac</span><span class="p">,</span> <span class="n">strfunction</span><span class="o">=</span><span class="n">ac</span><span class="o">.</span><span class="n">strfunction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span></div>

<span class="c1"># Local Variables:</span>
<span class="c1"># tab-width:4</span>
<span class="c1"># indent-tabs-mode:nil</span>
<span class="c1"># End:</span>
<span class="c1"># vim: set expandtab tabstop=4 shiftwidth=4:</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, SCons Project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>