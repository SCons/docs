<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 19. Pseudo-Builders: the AddMethod function</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 4.1.0.post1"><link rel="up" href="index.html" title="SCons 4.1.0.post1"><link rel="prev" href="ch18.html" title="Chapter 18. Not Writing a Builder: the Command Builder"><link rel="next" href="ch20.html" title="Chapter 20. Writing Scanners"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 19. Pseudo-Builders:  the AddMethod function</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch18.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch20.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 19. Pseudo-Builders: the AddMethod function"><div class="titlepage"><div><div><h2 class="title"><a name="chap-add-method"></a>Chapter 19. Pseudo-Builders:  the AddMethod function</h2></div></div></div><p>

  The <code class="function">AddMethod</code> function is used to add a method
  to an environment.  It's typically used to add a "pseudo-builder,"
  a function that looks like a <code class="classname">Builder</code> but
  wraps up calls to multiple other <code class="classname">Builder</code>s
  or otherwise processes its arguments
  before calling one or more <code class="classname">Builder</code>s.
  In the following example,
  we want to install the program into the standard
  <code class="filename">/usr/bin</code> directory hierarchy,
  but also copy it into a local <code class="filename">install/bin</code>
  directory from which a package might be built:

  </p><pre class="programlisting">
def install_in_bin_dirs(env, source):
    """Install source in both bin dirs"""
    i1 = env.Install("$BIN", source)
    i2 = env.Install("$LOCALBIN", source)
    return [i1[0], i2[0]] # Return a list, like a normal builder
env = Environment(BIN='/usr/bin', LOCALBIN='#install/bin')
env.AddMethod(install_in_bin_dirs, "InstallInBinDirs")
env.InstallInBinDirs(Program('hello.c')) # installs hello in both bin dirs     
     </pre><p>
  This produces the following:
  </p><pre class="screen">% <strong class="userinput"><code>scons -Q /</code></strong>
cc -o hello.o -c hello.c
cc -o hello hello.o
Install file: "hello" as "/usr/bin/hello"
Install file: "hello" as "install/bin/hello"
</pre><p>

  As mentioned, a pseudo-builder also provides more flexibility
  in parsing arguments than you can get with a <code class="classname">Builder</code>.
  The next example shows a pseudo-builder with a
  named argument that modifies the filename, and a separate argument
  for the resource file (rather than having the builder figure it out
  by file extension).  This example also demonstrates using the global
  <code class="function">AddMethod</code> function to add a method to the global Environment class,
  so it will be used in all subsequently created environments.

  </p><pre class="programlisting">
def BuildTestProg(env, testfile, resourcefile, testdir="tests"):
    """Build the test program;
    prepends "test_" to src and target,
    and puts target into testdir."""
    srcfile = "test_%s.c" % testfile
    target = "%s/test_%s" % (testdir, testfile)
    if env['PLATFORM'] == 'win32':
        resfile = env.RES(resourcefile)
        p = env.Program(target, [srcfile, resfile])
    else:
        p = env.Program(target, srcfile)
    return p
AddMethod(Environment, BuildTestProg)

env = Environment()
env.BuildTestProg('stuff', resourcefile='res.rc')
     </pre><p>
  This produces the following on Linux:
  </p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
cc -o test_stuff.o -c test_stuff.c
cc -o tests/test_stuff test_stuff.o
</pre><p>
  And the following on Windows:
  </p><pre class="screen">C:\&gt;<strong class="userinput"><code>scons -Q</code></strong>
rc /nologo /fores.res res.rc
cl /Fotest_stuff.obj /c test_stuff.c /nologo
link /nologo /OUT:tests\test_stuff.exe test_stuff.obj res.res
embedManifestExeCheck(target, source, env)
</pre><p>
  Using <code class="function">AddMethod</code> is better than just adding an instance method
  to a <span>construction environment</span> because it gets called as a proper method,
  and because <code class="function">AddMethod</code> provides for copying the method
  to any clones of the <span>construction environment</span> instance.
  </p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch18.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch20.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 18. Not Writing a Builder:  the <code class="function">Command</code> Builder </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 20. Writing Scanners</td></tr></table></div></body></html>
