<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Appendix E. Handling Common Tasks</title><link rel="stylesheet" type="text/css" href="scons.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="SCons 4.7.0"><link rel="up" href="index.html" title="SCons 4.7.0"><link rel="prev" href="apd.html" title="Appendix D. Functions and Environment Methods"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix E. Handling Common Tasks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="apd.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr></div><div class="appendix" title="Appendix E. Handling Common Tasks"><div class="titlepage"><div><div><h2 class="title"><a name="app-tasks"></a>Appendix E. Handling Common Tasks</h2></div></div></div><p>
There is a common set of simple tasks that many build configurations rely
on as they become more complex. Most build tools have special
purpose constructs for performing these tasks, but since <code class="filename">SConscript</code>
files are <span class="application">Python</span> scripts, you can use more flexible built-in <span class="application">Python</span>
services to perform these tasks. This appendix lists a number of these
tasks and how to implement them in <span class="application">Python</span> and <span class="application">SCons</span>.
</p><div class="example"><a name="id1489"></a><p class="title"><b>Example E.1. Wildcard globbing to create a list of filenames</b></p><div class="example-contents"><pre class="programlisting">
files = Glob(wildcard)
</pre></div></div><br class="example-break"><div class="example"><a name="id1490"></a><p class="title"><b>Example E.2. Filename extension substitution</b></p><div class="example-contents"><pre class="programlisting">
import os.path
filename = os.path.splitext(filename)[0]+extension
</pre></div></div><br class="example-break"><div class="example"><a name="id1491"></a><p class="title"><b>Example E.3. Appending a path prefix to a list of filenames</b></p><div class="example-contents"><pre class="programlisting">
import os.path
filenames = [os.path.join(prefix, x) for x in filenames]
</pre></div></div><br class="example-break"><div class="example"><a name="id1492"></a><p class="title"><b>Example E.4. Substituting a path prefix with another one</b></p><div class="example-contents"><pre class="programlisting">
if filename.find(old_prefix) == 0:
    filename = filename.replace(old_prefix, new_prefix)
</pre></div></div><br class="example-break"><div class="example"><a name="id1493"></a><p class="title"><b>Example E.5. Filtering a filename list to exclude/retain only a specific set
of extensions</b></p><div class="example-contents"><pre class="programlisting">
import os.path
filenames = [x for x in filenames if os.path.splitext(x)[1] in extensions]
</pre></div></div><br class="example-break"><div class="example"><a name="id1494"></a><p class="title"><b>Example E.6. The "backtick function": run a shell command and capture the
output</b></p><div class="example-contents"><pre class="programlisting">import subprocess
output = subprocess.check_output(command)
</pre></div></div><br class="example-break"><div class="example"><a name="id1495"></a><p class="title"><b>Example E.7. Generating source code: how code can be generated and used by SCons</b></p><div class="example-contents"><p>

The Copy builders here could be any arbitrary shell or python function
that produces one or more files.  This example shows how to create
those files and use them in <span class="application">SCons</span>.

</p><pre class="programlisting">
#### SConstruct
env = Environment()
env.Append(CPPPATH = "#")

## Header example
env.Append(BUILDERS =
   {'Copy1' : Builder(action = 'cat &lt; $SOURCE &gt; $TARGET',
                      suffix='.h', src_suffix='.bar')})
env.Copy1('test.bar') # produces test.h from test.bar.
env.Program('app','main.cpp') # indirectly depends on test.bar

## Source file example
env.Append(BUILDERS =
  {'Copy2' : Builder(action = 'cat &lt; $SOURCE &gt; $TARGET',
                     suffix='.cpp', src_suffix='.bar2')})
foo = env.Copy2('foo.bar2') # produces foo.cpp from foo.bar2.
env.Program('app2',['main2.cpp'] + foo) # compiles main2.cpp and foo.cpp into app2.
</pre><p>

Where main.cpp looks like this:

</p><pre class="programlisting">
#include "test.h"

</pre><p>
produces this:
</p><pre class="screen">% <strong class="userinput"><code>scons -Q</code></strong>
cat &lt; test.bar &gt; test.h
cc -o app main.cpp
cat &lt; foo.bar2 &gt; foo.cpp
cc -o app2 main2.cpp foo.cpp
</pre></div></div><br class="example-break"></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="apd.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top">Appendix D. Functions and Environment Methods </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
